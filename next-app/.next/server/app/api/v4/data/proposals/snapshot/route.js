(()=>{var t={};t.id=75,t.ids=[75],t.modules={20399:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:t=>{"use strict";t.exports=require("crypto")},57147:t=>{"use strict";t.exports=require("fs")},41808:t=>{"use strict";t.exports=require("net")},22037:t=>{"use strict";t.exports=require("os")},4074:t=>{"use strict";t.exports=require("perf_hooks")},12781:t=>{"use strict";t.exports=require("stream")},24404:t=>{"use strict";t.exports=require("tls")},72935:(t,e,r)=>{"use strict";r.r(e),r.d(e,{originalPathname:()=>m,patchFetch:()=>E,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{POST:()=>c});var s=r(34371),n=r(51947),a=r(56662),i=r(23542),p=r(25442),u=r.n(p);async function c(t){try{let t=await fetch("https://api.boardroom.info/v1/protocols?key=a9e2a08afc04b15bd17e20f05373b9e5",{method:"GET",headers:{Accept:"application/json"}}),e=await t.json();e=e.data;let r=[];for(let t=0;t<e.length;t++)e[t]&&void 0!==e[t].icons&&r.push((0,i.o)(e[t].cname));let o=new Set,s=r.map(async t=>{let e=`https://api.boardroom.info/v1/protocols/${t}/proposals?status=active&key=a9e2a08afc04b15bd17e20f05373b9e5`,r=await fetch(e,{method:"GET",headers:{Accept:"application/json"}}),s=await r.json();for(let e=0;e<s.data.length;e+=1){let r={},n=s.data[e],a=(0,i.o)(n.content).trim();a.slice(0,200),a.length,r.id=u()(n.id),r.protocol=t,r.proposer=n.proposer,r.title=(0,i.o)(n.title).trim(),r.starttime=parseInt(n.startTimestamp),r.endtime=parseInt(n.endTimestamp),r.url=n.externalUrl,r.summary=a,r.choices=n.choices,r.results=n.indexedResult,void 0!==r.title&&o.add(r)}});await Promise.allSettled(s);let n=new Set;o=Array.from(o).filter(({id:t})=>!n.has(t)&&(n.add(t),!0));let a=`
  INSERT INTO proposals (id, protocol, title, proposer, starttime, endtime, url, summary, choices, results)
  VALUES
    ${o.map(({id:t,protocol:e,title:r,proposer:o,starttime:s,endtime:n,url:a,summary:p,choices:u,results:c})=>`('${t}', '${e}', '${r}', '${o}', ${s}, ${n}, '${a}', '${p}', ARRAY[${u.map(t=>`'${(0,i.o)(t).trim()}'`).join(", ")}], '${JSON.stringify(c)}')`).join(",\n    ")}
  ON CONFLICT (id) DO UPDATE
  SET
    protocol = EXCLUDED.protocol,
    title = EXCLUDED.title,
    proposer = EXCLUDED.proposer,
    starttime = EXCLUDED.starttime,
    endtime = EXCLUDED.endtime,
    url = EXCLUDED.url,
    summary = EXCLUDED.summary,
    choices = EXCLUDED.choices,
    results = EXCLUDED.results
  WHERE proposals.protocol <> EXCLUDED.protocol
     OR proposals.title <> EXCLUDED.title
	 OR proposals.proposer <> EXCLUDED.proposer
     OR proposals.starttime <> EXCLUDED.starttime
     OR proposals.endtime <> EXCLUDED.endtime
     OR proposals.url <> EXCLUDED.url
     OR proposals.summary <> EXCLUDED.summary
	 OR proposals.choices <> EXCLUDED.choices
	 OR proposals.results <> EXCLUDED.results;
`;return await i.i.unsafe(a),Response.json({code:201,status:"success"})}catch(t){return console.log(t),Response.json({code:403,status:"error"})}}let l=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/v4/data/proposals/snapshot/route",pathname:"/api/v4/data/proposals/snapshot",filename:"route",bundlePath:"app/api/v4/data/proposals/snapshot/route"},resolvedPagePath:"C:\\Users\\17gua\\Desktop\\cryptos\\tribuni\\next-app\\app\\api\\v4\\data\\proposals\\snapshot\\route.jsx",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:f,serverHooks:h}=l,m="/api/v4/data/proposals/snapshot/route";function E(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},23542:(t,e,r)=>{"use strict";r.d(e,{o:()=>s,i:()=>o});let o=(0,r(71468).Z)({host:process.env.DB_HOST,port:process.env.DB_PORT,database:process.env.DB_NAME,username:process.env.DB_USERNAME,password:process.env.DB_PASSWORD,ssl:!1,max:20,max_lifetime:null,idle_timeout:60,connect_timeout:30});function s(t){return null==t?null:t.replace(/'/g,"''")}},17441:t=>{var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e},bytesToString:function(t){for(var e=[],r=0;r<t.length;r++)e.push(String.fromCharCode(t[r]));return e.join("")}}};t.exports=e},72486:t=>{!function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&r.rotl(t,8)|4278255360&r.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=r.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],r=0,o=0;r<t.length;r++,o+=8)e[o>>>5]|=t[r]<<24-o%32;return e},wordsToBytes:function(t){for(var e=[],r=0;r<32*t.length;r+=8)e.push(t[r>>>5]>>>24-r%32&255);return e},bytesToHex:function(t){for(var e=[],r=0;r<t.length;r++)e.push((t[r]>>>4).toString(16)),e.push((15&t[r]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],r=0;r<t.length;r+=2)e.push(parseInt(t.substr(r,2),16));return e},bytesToBase64:function(t){for(var r=[],o=0;o<t.length;o+=3)for(var s=t[o]<<16|t[o+1]<<8|t[o+2],n=0;n<4;n++)8*o+6*n<=8*t.length?r.push(e.charAt(s>>>6*(3-n)&63)):r.push("=");return r.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var r=[],o=0,s=0;o<t.length;s=++o%4)0!=s&&r.push((e.indexOf(t.charAt(o-1))&Math.pow(2,-2*s+8)-1)<<2*s|e.indexOf(t.charAt(o))>>>6-2*s);return r}};t.exports=r}()},34371:(t,e,r)=>{"use strict";t.exports=r(30517)},25442:(t,e,r)=>{!function(){var e=r(72486),o=r(17441).utf8,s=r(17441).bin,n=function(t){t.constructor==String?t=o.stringToBytes(t):"undefined"!=typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||(t=t.toString());var r=e.bytesToWords(t),s=8*t.length,n=[],a=1732584193,i=-271733879,p=-1732584194,u=271733878,c=-1009589776;r[s>>5]|=128<<24-s%32,r[(s+64>>>9<<4)+15]=s;for(var l=0;l<r.length;l+=16){for(var d=a,f=i,h=p,m=u,E=c,D=0;D<80;D++){if(D<16)n[D]=r[l+D];else{var v=n[D-3]^n[D-8]^n[D-14]^n[D-16];n[D]=v<<1|v>>>31}var g=(a<<5|a>>>27)+c+(n[D]>>>0)+(D<20?(i&p|~i&u)+1518500249:D<40?(i^p^u)+1859775393:D<60?(i&p|i&u|p&u)-1894007588:(i^p^u)-899497514);c=u,u=p,p=i<<30|i>>>2,i=a,a=g}a+=d,i+=f,p+=h,u+=m,c+=E}return[a,i,p,u,c]},a=function(t,r){var o=e.wordsToBytes(n(t));return r&&r.asBytes?o:r&&r.asString?s.bytesToString(o):e.bytesToHex(o)};a._blocksize=16,a._digestsize=20,t.exports=a}()}};var e=require("../../../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),o=e.X(0,[558,468],()=>r(72935));module.exports=o})();