(()=>{var exports={};exports.id=575,exports.ids=[575],exports.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},50852:e=>{"use strict";e.exports=require("async_hooks")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},4074:e=>{"use strict";e.exports=require("perf_hooks")},77282:e=>{"use strict";e.exports=require("process")},85477:e=>{"use strict";e.exports=require("punycode")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},33526:(e,t,n)=>{"use strict";let r,i,s,a,o,l,u,c;n.r(t),n.d(t,{originalPathname:()=>wL,patchFetch:()=>wB,requestAsyncStorage:()=>wO,routeModule:()=>wN,serverHooks:()=>wP,staticGenerationAsyncStorage:()=>wM});var h,d,f,p,g={};n.r(g),n.d(g,{GET:()=>wA,POST:()=>wR});var m=n(34371),y=n(51947),v=n(56662),b=n(63418),S=n(23542);let T=async e=>{let t=`
    SELECT
      (SELECT chatid FROM messages WHERE id = '${e}')::BIGINT AS chatid,
      (SELECT messageid FROM messages WHERE id = '${e}')::BIGINT AS messageid
    WHERE EXISTS (SELECT 1 FROM messages WHERE id = '${e}')
    UNION ALL
    SELECT
      NULL AS chatid,
      NULL AS messageid
    WHERE NOT EXISTS (SELECT 1 FROM messages WHERE id = '${e}');
  `;return(await S.i.unsafe(t))[0]},w=async({bot:e,id:t})=>{try{let{chatid:n,messageid:r}=await T(t);null!==n&&await e.deleteMessage(n,r)}catch(e){console.log(e)}},C=async({id:e,chatid:t,messageid:n})=>{let r=`
    INSERT INTO messages (id, chatid, messageid)
    VALUES ('${e}', ${t}, ${n})
    ON CONFLICT (id) DO UPDATE
    SET chatid = EXCLUDED.chatid,
        messageid = EXCLUDED.messageid;
  `;await S.i.unsafe(r)},E=async({bot:e,body:t})=>{try{let n=(0,S.o)(t.message.from.username),r=t.message.chat.id;await w({bot:e,id:n});let i=`
      SELECT EXISTS (SELECT 1 FROM telegram_users WHERE id='${(0,S.o)(n)}') AS result;
    `,s=await S.i.unsafe(i);console.log(s);let a=!0==!!s[0].result?`Hey there! ðŸ‘‹ 

I'm the governance bot -- your goto companion for all things governance. What's on your mind? ðŸ‘€`:`Hey there! ðŸ‘‹ 

Before we explore the world of governance, let's get you officially on board. Tap 'Register' to get started! ðŸ‘‡`,o=[[{text:"Register",web_app:{url:`${process.env.NGROK_URL}/register?username=${n}&chatid=${r}`}}]],l=[{text:"Browse Protocols",path:"protocols"},{text:"View Bookmarks",path:"bookmarks"},{text:"Edit Settings",path:"settings"}].map(e=>[{text:e.text,web_app:{url:`${process.env.NGROK_URL}/${e.path}?username=${n}&chatid=${r}`}}]),u={reply_markup:{inline_keyboard:!0==!!s[0].result?l:o}},c=await e.sendMessage(r,a,u);await C({id:n,chatid:c.chat.id,messageid:c.message_id})}catch(e){console.log(e)}},I={NODE_CLIENT:!1,SDK_VERSION:"${JSCORE_VERSION}"},_=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},k=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},D={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;o||(d=64,s||(h=64)),r.push(n[u],n[c],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(_(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):k(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new R;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class R extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let A=function(e){let t=_(e);return D.encodeByteArray(t,!0)},x=function(e){return A(e).replace(/\./g,"")},N=function(e){try{return D.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let M=()=>O().__FIREBASE_DEFAULTS__,P=()=>{if("undefined"==typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},L=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&N(e[1]);return t&&JSON.parse(t)},B=()=>{try{return M()||P()||L()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},F=e=>{var t,n;return null===(n=null===(t=B())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},j=e=>{let t=F(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},U=()=>{var e;return null===(e=B())||void 0===e?void 0:e.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n={alg:"none",type:"JWT"},r=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e),o="";return[x(JSON.stringify(n)),x(JSON.stringify(a)),o].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function $(){var e;let t=null===(e=B())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function G(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function H(){return!$()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function K(){try{return"object"==typeof indexedDB}catch(e){return!1}}function W(){return new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})}function Q(){return"undefined"!=typeof navigator&&!!navigator.cookieEnabled}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Y="FirebaseError";class J extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=Y,Object.setPrototypeOf(this,J.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,X.prototype.create)}}class X{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?Z(i,n):"Error",a=`${this.serviceName}: ${s} (${r}).`;return new J(r,a,n)}}function Z(e,t){return e.replace(ee,(e,n)=>{let r=t[n];return null!=r?String(r):`<${n}?>`})}let ee=/\{\$([^}]+)}/g;function et(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(en(n)&&en(s)){if(!et(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function en(e){return null!==e&&"object"==typeof e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let er=1e3,ei=2,es=144e5,ea=.5;function eo(e,t=er,n=ei){let r=t*Math.pow(n,e),i=Math.round(ea*r*(Math.random()-.5)*2);return Math.min(es,r+i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function el(e){return e&&e._delegate?e._delegate:e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */I.NODE_CLIENT=!0;class eu{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ec="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new V;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(ef(e))try{this.getOrInitializeService({instanceIdentifier:ec})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=ec){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ec){return this.instances.has(e)}getOptions(e=ec){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:ed(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}return n||null}normalizeInstanceIdentifier(e=ec){return this.component?this.component.multipleInstances?e:ec:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function ed(e){return e===ec?void 0:e}function ef(e){return"EAGER"===e.instantiationMode}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eh(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eg=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(rb||(rb={}));let em={debug:rb.DEBUG,verbose:rb.VERBOSE,info:rb.INFO,warn:rb.WARN,error:rb.ERROR,silent:rb.SILENT},ey=rb.INFO,ev={[rb.DEBUG]:"log",[rb.VERBOSE]:"log",[rb.INFO]:"info",[rb.WARN]:"warn",[rb.ERROR]:"error"},eb=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=ev[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eS{constructor(e){this.name=e,this._logLevel=ey,this._logHandler=eb,this._userLogHandler=null,eg.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in rb))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?em[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,rb.DEBUG,...e),this._logHandler(this,rb.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,rb.VERBOSE,...e),this._logHandler(this,rb.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,rb.INFO,...e),this._logHandler(this,rb.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,rb.WARN,...e),this._logHandler(this,rb.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,rb.ERROR,...e),this._logHandler(this,rb.ERROR,...e)}}let eT=(e,t)=>t.some(t=>e instanceof t);function ew(){return r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function eC(){return i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let eE=new WeakMap,eI=new WeakMap,e_=new WeakMap,ek=new WeakMap,eD=new WeakMap;function eR(e){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eP(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&eE.set(t,e)}).catch(()=>{}),eD.set(t,e),t}function eA(e){if(eI.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eI.set(e,t)}let ex={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eI.get(e);if("objectStoreNames"===t)return e.objectStoreNames||e_.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return eP(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eN(e){ex=e(ex)}function eO(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?eC().includes(e)?function(...t){return e.apply(eL(this),t),eP(eE.get(this))}:function(...t){return eP(e.apply(eL(this),t))}:function(t,...n){let r=e.call(eL(this),t,...n);return e_.set(r,t.sort?t.sort():[t]),eP(r)}}function eM(e){return"function"==typeof e?eO(e):(e instanceof IDBTransaction&&eA(e),eT(e,ew()))?new Proxy(e,ex):e}function eP(e){if(e instanceof IDBRequest)return eR(e);if(ek.has(e))return ek.get(e);let t=eM(e);return t!==e&&(ek.set(e,t),eD.set(t,e)),t}let eL=e=>eD.get(e);function eB(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=eP(a);return r&&a.addEventListener("upgradeneeded",e=>{r(eP(a.result),e.oldVersion,e.newVersion,eP(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let eF=["get","getKey","getAll","getAllKeys","count"],ej=["put","add","delete","clear"],eU=new Map;function eV(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eU.get(t))return eU.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=ej.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||eF.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return eU.set(t,s),s}eN(e=>({...e,get:(t,n,r)=>eV(t,n)||e.get(t,n,r),has:(t,n)=>!!eV(t,n)||e.has(t,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eq{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!ez(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}function ez(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}let e$="@firebase/app",eG="0.9.22",eH=new eS("@firebase/app"),eK="10.5.2",eW="[DEFAULT]",eQ={[e$]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},eY=new Map,eJ=new Map;function eX(e,t){try{e.container.addComponent(t)}catch(n){eH.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function eZ(e){let t=e.name;if(eJ.has(t))return eH.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(eJ.set(t,e),eY.values()))eX(n,e);return!0}function e0(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}let e1=new X("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e2{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new eu("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw e1.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e3=eK;function e4(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r=Object.assign({name:eW,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw e1.create("bad-app-name",{appName:String(i)});if(n||(n=U()),!n)throw e1.create("no-options");let s=eY.get(i);if(s){if(et(n,s.options)&&et(r,s.config))return s;throw e1.create("duplicate-app",{appName:i})}let a=new ep(i);for(let e of eJ.values())a.addComponent(e);let o=new e2(n,r,a);return eY.set(i,o),o}function e6(e=eW){let t=eY.get(e);if(!t&&e===eW&&U())return e4();if(!t)throw e1.create("no-app",{appName:e});return t}function e9(e,t,n){var r;let i=null!==(r=eQ[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);let s=i.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${i}" with version "${t}":`];s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eH.warn(e.join(" "));return}eZ(new eu(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e5="firebase-heartbeat-database",e7=1,e8="firebase-heartbeat-store",te=null;function tt(){return te||(te=eB(e5,e7,{upgrade:(e,t)=>{0===t&&e.createObjectStore(e8)}}).catch(e=>{throw e1.create("idb-open",{originalErrorMessage:e.message})})),te}async function tn(e){try{let t=await tt();return await t.transaction(e8).objectStore(e8).get(ti(e))}catch(e){if(e instanceof J)eH.warn(e.message);else{let t=e1.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});eH.warn(t.message)}}}async function tr(e,t){try{let n=(await tt()).transaction(e8,"readwrite"),r=n.objectStore(e8);await r.put(t,ti(e)),await n.done}catch(e){if(e instanceof J)eH.warn(e.message);else{let t=e1.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});eH.warn(t.message)}}}function ti(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ts=1024,ta=2592e6;class to{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new tc(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tl();return(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))?void 0:(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=ta}),this._storage.overwrite(this._heartbeatsCache))}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";let e=tl(),{heartbeatsToSend:t,unsentEntries:n}=tu(this._heartbeatsCache.heartbeats),r=x(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function tl(){return new Date().toISOString().substring(0,10)}function tu(e,t=ts){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),th(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),th(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class tc{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!K()&&W().then(()=>!0).catch(()=>!1)}async read(){return await this._canUseIndexedDBPromise&&await tn(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return tr(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return tr(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function th(e){return x(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(e){eZ(new eu("platform-logger",e=>new eq(e),"PRIVATE")),eZ(new eu("heartbeat",e=>new to(e),"PRIVATE")),e9(e$,eG,""),e9(e$,eG,"esm2017"),e9("fire-js","")})(0),/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */e9("firebase","10.5.2","app");let td=(e,t)=>t.some(t=>e instanceof t);function tf(){return s||(s=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tp(){return a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let tg=new WeakMap,tm=new WeakMap,ty=new WeakMap,tv=new WeakMap,tb=new WeakMap;function tS(e){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(t_(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&tg.set(t,e)}).catch(()=>{}),tb.set(t,e),t}function tT(e){if(tm.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});tm.set(e,t)}let tw={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return tm.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ty.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return t_(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function tC(e){tw=e(tw)}function tE(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?tp().includes(e)?function(...t){return e.apply(tk(this),t),t_(tg.get(this))}:function(...t){return t_(e.apply(tk(this),t))}:function(t,...n){let r=e.call(tk(this),t,...n);return ty.set(r,t.sort?t.sort():[t]),t_(r)}}function tI(e){return"function"==typeof e?tE(e):(e instanceof IDBTransaction&&tT(e),td(e,tf()))?new Proxy(e,tw):e}function t_(e){if(e instanceof IDBRequest)return tS(e);if(tv.has(e))return tv.get(e);let t=tI(e);return t!==e&&(tv.set(e,t),tb.set(t,e)),t}let tk=e=>tb.get(e);function tD(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=t_(a);return r&&a.addEventListener("upgradeneeded",e=>{r(t_(a.result),e.oldVersion,e.newVersion,t_(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),o}let tR=["get","getKey","getAll","getAllKeys","count"],tA=["put","add","delete","clear"],tx=new Map;function tN(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(tx.get(t))return tx.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=tA.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||tR.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return tx.set(t,s),s}tC(e=>({...e,get:(t,n,r)=>tN(t,n)||e.get(t,n,r),has:(t,n)=>!!tN(t,n)||e.has(t,n)}));let tO="@firebase/installations",tM="0.6.4",tP=1e4,tL=`w:${tM}`,tB="FIS_v2",tF="https://firebaseinstallations.googleapis.com/v1",tj=36e5,tU=new X("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function tV(e){return e instanceof J&&e.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tq({projectId:e}){return`${tF}/projects/${e}/installations`}function tz(e){return{token:e.token,requestStatus:2,expiresIn:tW(e.expiresIn),creationTime:Date.now()}}async function t$(e,t){let n=(await t.json()).error;return tU.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function tG({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function tH(e,{refreshToken:t}){let n=tG(e);return n.append("Authorization",tQ(t)),n}async function tK(e){let t=await e();return t.status>=500&&t.status<600?e():t}function tW(e){return Number(e.replace("s","000"))}function tQ(e){return`${tB} ${e}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tY({appConfig:e,heartbeatServiceProvider:t},{fid:n}){let r=tq(e),i=tG(e),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}let a={method:"POST",headers:i,body:JSON.stringify({fid:n,authVersion:tB,appId:e.appId,sdkVersion:tL})},o=await tK(()=>fetch(r,a));if(o.ok){let e=await o.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:tz(e.authToken)}}throw await t$("Create Installation",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tJ(e){return new Promise(t=>{setTimeout(t,e)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tX(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tZ=/^[cdef][\w-]{21}$/,t0="";function t1(){try{let e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;let t=t2(e);return tZ.test(t)?t:t0}catch(e){return t0}}function t2(e){return tX(e).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t3(e){return`${e.appName}!${e.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let t4=new Map;function t6(e,t){let n=t3(e);t9(n,t),t5(n,t)}function t9(e,t){let n=t4.get(e);if(n)for(let e of n)e(t)}function t5(e,t){let n=t8();n&&n.postMessage({key:e,fid:t}),ne()}let t7=null;function t8(){return!t7&&"BroadcastChannel"in self&&((t7=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{t9(e.data.key,e.data.fid)}),t7}function ne(){0===t4.size&&t7&&(t7.close(),t7=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nt="firebase-installations-database",nn=1,nr="firebase-installations-store",ni=null;function ns(){return ni||(ni=tD(nt,nn,{upgrade:(e,t)=>{0===t&&e.createObjectStore(nr)}})),ni}async function na(e,t){let n=t3(e),r=(await ns()).transaction(nr,"readwrite"),i=r.objectStore(nr),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||t6(e,t.fid),t}async function no(e){let t=t3(e),n=(await ns()).transaction(nr,"readwrite");await n.objectStore(nr).delete(t),await n.done}async function nl(e,t){let n=t3(e),r=(await ns()).transaction(nr,"readwrite"),i=r.objectStore(nr),s=await i.get(n),a=t(s);return void 0===a?await i.delete(n):await i.put(a,n),await r.done,a&&(!s||s.fid!==a.fid)&&t6(e,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nu(e){let t;let n=await nl(e.appConfig,n=>{let r=nh(e,nc(n));return t=r.registrationPromise,r.installationEntry});return n.fid===t0?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}function nc(e){return ng(e||{fid:t1(),registrationStatus:0})}function nh(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(tU.create("app-offline"))};let n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=nd(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:nf(e)}:{installationEntry:t}}async function nd(e,t){try{let n=await tY(e,t);return na(e.appConfig,n)}catch(n){throw tV(n)&&409===n.customData.serverCode?await no(e.appConfig):await na(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}async function nf(e){let t=await np(e.appConfig);for(;1===t.registrationStatus;)await tJ(100),t=await np(e.appConfig);if(0===t.registrationStatus){let{installationEntry:t,registrationPromise:n}=await nu(e);return n||t}return t}function np(e){return nl(e,e=>{if(!e)throw tU.create("installation-not-found");return ng(e)})}function ng(e){return nm(e)?{fid:e.fid,registrationStatus:0}:e}function nm(e){return 1===e.registrationStatus&&e.registrationTime+tP<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ny({appConfig:e,heartbeatServiceProvider:t},n){let r=nv(e,n),i=tH(e,n),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}let a={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:tL,appId:e.appId}})},o=await tK(()=>fetch(r,a));if(o.ok)return tz(await o.json());throw await t$("Generate Auth Token",o)}function nv(e,{fid:t}){return`${tq(e)}/${t}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nb(e,t=!1){let n;let r=await nl(e.appConfig,r=>{if(!nC(r))throw tU.create("not-registered");let i=r.authToken;if(!t&&nE(i))return r;if(1===i.requestStatus)return n=nS(e,t),r;{if(!navigator.onLine)throw tU.create("app-offline");let t=n_(r);return n=nw(e,t),t}});return n?await n:r.authToken}async function nS(e,t){let n=await nT(e.appConfig);for(;1===n.authToken.requestStatus;)await tJ(100),n=await nT(e.appConfig);let r=n.authToken;return 0===r.requestStatus?nb(e,t):r}function nT(e){return nl(e,e=>{if(!nC(e))throw tU.create("not-registered");return nk(e.authToken)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function nw(e,t){try{let n=await ny(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await na(e.appConfig,r),n}catch(n){if(tV(n)&&(401===n.customData.serverCode||404===n.customData.serverCode))await no(e.appConfig);else{let n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await na(e.appConfig,n)}throw n}}function nC(e){return void 0!==e&&2===e.registrationStatus}function nE(e){return 2===e.requestStatus&&!nI(e)}function nI(e){let t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+tj}function n_(e){let t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function nk(e){return 1===e.requestStatus&&e.requestTime+tP<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nD(e){let t=e,{installationEntry:n,registrationPromise:r}=await nu(t);return r?r.catch(console.error):nb(t).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nR(e,t=!1){let n=e;return await nA(n),(await nb(n,t)).token}async function nA(e){let{registrationPromise:t}=await nu(e);t&&await t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nx(e){if(!e||!e.options)throw nN("App Configuration");if(!e.name)throw nN("App Name");for(let t of["projectId","apiKey","appId"])if(!e.options[t])throw nN(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}function nN(e){return tU.create("missing-app-config-values",{valueName:e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nO="installations",nM="installations-internal",nP=e=>{let t=e.getProvider("app").getImmediate(),n=nx(t),r=e0(t,"heartbeat");return{app:t,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},nL=e=>{let t=e0(e.getProvider("app").getImmediate(),nO).getImmediate();return{getId:()=>nD(t),getToken:e=>nR(t,e)}};(function(){eZ(new eu(nO,nP,"PUBLIC")),eZ(new eu(nM,nL,"PRIVATE"))})(),e9(tO,tM),e9(tO,tM,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nB="analytics",nF="firebase_id",nj="origin",nU=6e4,nV="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",nq="https://www.googletagmanager.com/gtag/js",nz=new eS("@firebase/analytics"),n$=new X("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nG(e){if(!e.startsWith(nq)){let t=n$.create("invalid-gtag-resource",{gtagURL:e});return nz.warn(t.message),""}return e}function nH(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function nK(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(e,t)),n}function nW(e,t){let n=nK("firebase-js-sdk-policy",{createScriptURL:nG}),r=document.createElement("script"),i=`${nq}?l=${e}&id=${t}`;r.src=n?null==n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function nQ(e){let t=[];return Array.isArray(window[e])?t=window[e]:window[e]=t,t}async function nY(e,t,n,r,i,s){let a=r[i];try{if(a)await t[a];else{let e=(await nH(n)).find(e=>e.measurementId===i);e&&await t[e.appId]}}catch(e){nz.error(e)}e("config",i,s)}async function nJ(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);let r=await nH(n);for(let n of e){let e=r.find(e=>e.measurementId===n),i=e&&t[e.appId];if(i)s.push(i);else{s=[];break}}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",r,i||{})}catch(e){nz.error(e)}}function nX(e,t,n,r){return async function(i,...s){try{if("event"===i){let[r,i]=s;await nJ(e,t,n,r,i)}else if("config"===i){let[i,a]=s;await nY(e,t,n,r,i,a)}else if("consent"===i){let[t]=s;e("consent","update",t)}else if("get"===i){let[t,n,r]=s;e("get",t,n,r)}else if("set"===i){let[t]=s;e("set",t)}else e(i,...s)}catch(e){nz.error(e)}}}function nZ(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=nX(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}function n0(e){for(let t of Object.values(window.document.getElementsByTagName("script")))if(t.src&&t.src.includes(nq)&&t.src.includes(e))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let n1=30,n2=1e3;class n3{constructor(e={},t=n2){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}let n4=new n3;function n6(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function n9(e){var t;let{appId:n,apiKey:r}=e,i={method:"GET",headers:n6(r)},s=nV.replace("{app-id}",n),a=await fetch(s,i);if(200!==a.status&&304!==a.status){let e="";try{let n=await a.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw n$.create("config-fetch-failed",{httpStatus:a.status,responseMessage:e})}return a.json()}async function n5(e,t=n4,n){let{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw n$.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw n$.create("no-api-key")}let a=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new rt;return setTimeout(async()=>{o.abort()},void 0!==n?n:nU),n7({appId:r,apiKey:i,measurementId:s},a,o,t)}async function n7(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=n4){var s;let{appId:a,measurementId:o}=e;try{await n8(r,t)}catch(e){if(o)return nz.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:a,measurementId:o};throw e}try{let t=await n9(e);return i.deleteThrottleMetadata(a),t}catch(c){let t=c;if(!re(t)){if(i.deleteThrottleMetadata(a),o)return nz.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:a,measurementId:o};throw c}let l=503===Number(null===(s=null==t?void 0:t.customData)||void 0===s?void 0:s.httpStatus)?eo(n,i.intervalMillis,n1):eo(n,i.intervalMillis),u={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return i.setThrottleMetadata(a,u),nz.debug(`Calling attemptFetch again in ${l} millis`),n7(e,u,r,i)}}function n8(e,t){return new Promise((n,r)=>{let i=setTimeout(n,Math.max(t-Date.now(),0));e.addEventListener(()=>{clearTimeout(i),r(n$.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function re(e){if(!(e instanceof J)||!e.customData)return!1;let t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class rt{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function rn(e,t,n,r,i){if(i&&i.global){e("event",n,r);return}{let i=await t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}function rr(e){l=e}function ri(e){o=e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rs(){if(!K())return nz.warn(n$.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await W()}catch(e){return nz.warn(n$.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}async function ra(e,t,n,r,i,s,a){var u;let c=n5(e);c.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&nz.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>nz.error(e)),t.push(c);let h=rs().then(e=>e?r.getId():void 0),[d,f]=await Promise.all([c,h]);n0(s)||nW(s,d.measurementId),l&&(i("consent","default",l),rr(void 0)),i("js",new Date);let p=null!==(u=null==a?void 0:a.config)&&void 0!==u?u:{};return p[nj]="firebase",p.update=!0,null!=f&&(p[nF]=f),i("config",d.measurementId,p),o&&(i("set",o),ri(void 0)),d.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(e){this.app=e}_delete(){return delete rl[this.app.options.appId],Promise.resolve()}}let rl={},ru=[],rc={},rh="dataLayer",rd="gtag",rf=!1;function rp(){let e=[];if(G()&&e.push("This is a browser extension environment."),Q()||e.push("Cookies are not available."),e.length>0){let t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=n$.create("invalid-analytics-context",{errorInfo:t});nz.warn(n.message)}}function rg(e,t,n){rp();let r=e.options.appId;if(!r)throw n$.create("no-app-id");if(!e.options.apiKey){if(e.options.measurementId)nz.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw n$.create("no-api-key")}if(null!=rl[r])throw n$.create("already-exists",{id:r});if(!rf){nQ(rh);let{wrappedGtag:e,gtagCore:t}=nZ(rl,ru,rc,rh,rd);c=e,u=t,rf=!0}return rl[r]=ra(e,ru,rc,t,u,rh,n),new ro(e)}function rm(e,t,n,r){e=el(e),rn(c,rl[e.app.options.appId],t,n,r).catch(e=>nz.error(e))}let ry="@firebase/analytics",rv="0.10.0";(function(){function e(e){try{let t=e.getProvider(nB).getImmediate();return{logEvent:(e,n,r)=>rm(t,e,n,r)}}catch(e){throw n$.create("interop-component-reg-failed",{reason:e})}}eZ(new eu(nB,(e,{options:t})=>rg(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),eZ(new eu("analytics-internal",e,"PRIVATE")),e9(ry,rv),e9(ry,rv,"esm2017")})();var rb,rS,rT=n(73837),rw=n(6113),rC={},rE=rE||{},rI=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{})||self;function r_(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function rk(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function rD(e){return Object.prototype.hasOwnProperty.call(e,rR)&&e[rR]||(e[rR]=++rA)}var rR="closure_uid_"+(1e9*Math.random()>>>0),rA=0;function rx(e,t,n){return e.call.apply(e.bind,arguments)}function rN(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function rO(e,t,n){return(rO=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?rx:rN).apply(null,arguments)}function rM(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function rP(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function rL(){this.s=this.s,this.o=this.o}var rB=0;rL.prototype.s=!1,rL.prototype.sa=function(){this.s||(this.s=!0,this.N(),0==rB)||rD(this)},rL.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};let rF=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return -1};function rj(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function rU(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(r_(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function rV(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}rV.prototype.h=function(){this.defaultPrevented=!0};var rq=function(){if(!rI.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{rI.addEventListener("test",()=>{},t),rI.removeEventListener("test",()=>{},t)}catch(e){}return e}();function rz(e){return/^[\s\xa0]*$/.test(e)}function r$(){var e=rI.navigator;return e&&(e=e.userAgent)?e:""}function rG(e){return -1!=r$().indexOf(e)}function rH(e){return rH[" "](e),e}function rK(e,t){var n=a0;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}rH[" "]=function(){};var rW=rG("Opera"),rQ=rG("Trident")||rG("MSIE"),rY=rG("Edge"),rJ=rY||rQ,rX=rG("Gecko")&&!(-1!=r$().toLowerCase().indexOf("webkit")&&!rG("Edge"))&&!(rG("Trident")||rG("MSIE"))&&!rG("Edge"),rZ=-1!=r$().toLowerCase().indexOf("webkit")&&!rG("Edge");function r0(){var e=rI.document;return e?e.documentMode:void 0}e:{var r1="",r2=function(){var e=r$();return rX?/rv:([^\);]+)(\)|;)/.exec(e):rY?/Edge\/([\d\.]+)/.exec(e):rQ?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):rZ?/WebKit\/(\S+)/.exec(e):rW?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(r2&&(r1=r2?r2[1]:""),rQ){var r3=r0();if(null!=r3&&r3>parseFloat(r1)){h=String(r3);break e}}h=r1}var r4=d=rI.document&&rQ&&(r0()||parseInt(h,10))||void 0;function r6(e,t){if(rV.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(rX){e:{try{rH(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:r9[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&r6.$.h.call(this)}}rP(r6,rV);var r9={2:"touch",3:"pen",4:"mouse"};r6.prototype.h=function(){r6.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var r5="closure_listenable_"+(1e6*Math.random()|0),r7=0;function r8(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++r7,this.fa=this.ia=!1}function ie(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function it(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function ir(e,t){for(let n in e)t.call(void 0,e[n],n,e)}function ii(e){let t={};for(let n in e)t[n]=e[n];return t}let is="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ia(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<is.length;t++)n=is[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function io(e){this.src=e,this.g={},this.h=0}function il(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=rF(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(ie(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function iu(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&!!n==s.capture&&s.la==r)return i}return -1}io.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=iu(e,t,r,i);return -1<a?(t=e[a],n||(t.ia=!1)):((t=new r8(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var ic="closure_lm_"+(1e6*Math.random()|0),ih={};function id(e,t,n,r,i){if(r&&r.once)return im(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)id(e,t[s],n,r,i);return null}return n=iC(n),e&&e[r5]?e.O(t,n,rk(r)?!!r.capture:!!r,i):ip(e,t,n,!1,r,i)}function ip(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=rk(i)?!!i.capture:!!i,o=iT(e);if(o||(e[ic]=o=new io(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=ig(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)rq||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ib(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function ig(){function e(n){return t.call(e.src,e.listener,n)}let t=iS;return e}function im(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)im(e,t[s],n,r,i);return null}return n=iC(n),e&&e[r5]?e.P(t,n,rk(r)?!!r.capture:!!r,i):ip(e,t,n,!0,r,i)}function iy(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)iy(e,t[s],n,r,i);else(r=rk(r)?!!r.capture:!!r,n=iC(n),e&&e[r5])?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=iu(s=e.g[t],n,r,i))&&(ie(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=iT(e))&&(t=e.g[t.toString()],e=-1,t&&(e=iu(t,n,r,i)),(n=-1<e?t[e]:null)&&iv(n))}function iv(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[r5])il(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ib(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=iT(t))?(il(n,e),0==n.h&&(n.src=null,t[ic]=null)):ie(e)}}}function ib(e){return e in ih?ih[e]:ih[e]="on"+e}function iS(e,t){if(e.fa)e=!0;else{t=new r6(t,this);var n=e.listener,r=e.la||e.src;e.ia&&iv(e),e=n.call(r,t)}return e}function iT(e){return(e=e[ic])instanceof io?e:null}var iw="__closure_events_fn_"+(1e9*Math.random()>>>0);function iC(e){return"function"==typeof e?e:(e[iw]||(e[iw]=function(t){return e.handleEvent(t)}),e[iw])}function iE(){rL.call(this),this.i=new io(this),this.S=this,this.J=null}function iI(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new rV(t,e);else if(t instanceof rV)t.target=t.target||e;else{var i=t;ia(t=new rV(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=i_(a,r,!0,t)&&i}if(i=i_(a=t.g=e,r,!0,t)&&i,i=i_(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=i_(a=t.g=n[s],r,!1,t)&&i}function i_(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.fa&&a.capture==n){var o=a.listener,l=a.la||a.src;a.ia&&il(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}rP(iE,rL),iE.prototype[r5]=!0,iE.prototype.removeEventListener=function(e,t,n,r){iy(this,e,t,n,r)},iE.prototype.N=function(){if(iE.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)ie(n[r]);delete t.g[e],t.h--}}this.J=null},iE.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},iE.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var ik=rI.JSON.stringify;class iD{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function iR(){var e=iB;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}class iA{constructor(){this.h=this.g=null}add(e,t){let n=ix.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var ix=new iD(()=>new iN,e=>e.reset());class iN{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function iO(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function iM(e){rI.setTimeout(()=>{throw e},0)}let iP,iL=!1,iB=new iA,iF=()=>{let e=rI.Promise.resolve(void 0);iP=()=>{e.then(ij)}};var ij=()=>{for(var e;e=iR();){try{e.h.call(e.g)}catch(e){iM(e)}var t=ix;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}iL=!1};function iU(e,t){iE.call(this),this.h=e||1,this.g=t||rI,this.j=rO(this.qb,this),this.l=Date.now()}function iV(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function iq(e,t,n){if("function"==typeof e)n&&(e=rO(e,n));else if(e&&"function"==typeof e.handleEvent)e=rO(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:rI.setTimeout(e,t||0)}function iz(e){e.g=iq(()=>{e.g=null,e.i&&(e.i=!1,iz(e))},e.j);let t=e.h;e.h=null,e.m.apply(null,t)}rP(iU,iE),(rS=iU.prototype).ga=!1,rS.T=null,rS.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),iI(this,"tick"),this.ga&&(iV(this),this.start()))}},rS.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},rS.N=function(){iU.$.N.call(this),iV(this),delete this.g};class i$ extends rL{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:iz(this)}N(){super.N(),this.g&&(rI.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function iG(e){rL.call(this),this.h=e,this.g={}}rP(iG,rL);var iH=[];function iK(e,t,n,r){Array.isArray(n)||(n&&(iH[0]=n.toString()),n=iH);for(var i=0;i<n.length;i++){var s=id(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function iW(e){it(e.g,function(e,t){this.g.hasOwnProperty(t)&&iv(e)},e),e.g={}}function iQ(){this.g=!0}function iY(e,t,n,r,i,s){e.info(function(){if(e.g){if(s)for(var a="",o=s.split("&"),l=0;l<o.length;l++){var u=o[l].split("=");if(1<u.length){var c=u[0];u=u[1];var h=c.split("_");a=2<=h.length&&"type"==h[1]?a+(c+"=")+u+"&":a+(c+"=redacted&")}}else a=null}else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+a})}function iJ(e,t,n,r,i,s,a){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+a})}function iX(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+i0(e,n)+(r?" "+r:"")})}function iZ(e,t){e.info(function(){return"TIMEOUT: "+t})}function i0(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return ik(n)}catch(e){return t}}iG.prototype.N=function(){iG.$.N.call(this),iW(this)},iG.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},iQ.prototype.Ea=function(){this.g=!1},iQ.prototype.info=function(){};var i1={},i2=null;function i3(){return i2=i2||new iE}function i4(e){rV.call(this,i1.Ta,e)}function i6(e){let t=i3();iI(t,new i4(t))}function i9(e,t){rV.call(this,i1.STAT_EVENT,e),this.stat=t}function i5(e){let t=i3();iI(t,new i9(t,e))}function i7(e,t){rV.call(this,i1.Ua,e),this.size=t}function i8(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return rI.setTimeout(function(){e()},t)}i1.Ta="serverreachability",rP(i4,rV),i1.STAT_EVENT="statevent",rP(i9,rV),i1.Ua="timingevent",rP(i7,rV);var se={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},st={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function sn(){}function sr(e){return e.h||(e.h=e.i())}function si(){}sn.prototype.h=null;var ss={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function sa(){rV.call(this,"d")}function so(){rV.call(this,"c")}function sl(){}function su(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new iG(this),this.P=sh,e=rJ?125:void 0,this.V=new iU(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new sc}function sc(){this.i=null,this.g="",this.h=!1}rP(sa,rV),rP(so,rV),rP(sl,sn),sl.prototype.g=function(){return new XMLHttpRequest},sl.prototype.i=function(){return{}},f=new sl;var sh=45e3,sd={},sf={};function sp(e,t,n){e.L=1,e.v=sL(sx(t)),e.s=n,e.S=!0,sg(e,null)}function sg(e,t){e.G=Date.now(),sb(e),e.A=sx(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),sQ(n.i,"t",r),e.C=0,n=e.l.J,e.h=new sc,e.g=a$(e.l,n?t:null,!e.s),0<e.O&&(e.M=new i$(rO(e.Pa,e,e.g),e.O)),iK(e.U,e.g,"readystatechange",e.nb),t=e.I?ii(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),i6(),iY(e.j,e.u,e.A,e.m,e.W,e.s)}function sm(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function sy(e,t,n){let r=!0,i;for(;!e.J&&e.C<n.length;)if((i=sv(e,n))==sf){4==t&&(e.o=4,i5(14),r=!1),iX(e.j,e.m,null,"[Incomplete Response]");break}else if(i==sd){e.o=4,i5(15),iX(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else iX(e.j,e.m,i,null),sE(e,i);sm(e)&&i!=sf&&i!=sd&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,i5(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),aL(t),t.M=!0,i5(11))):(iX(e.j,e.m,n,"[Invalid Chunked Response]"),sC(e),sw(e))}function sv(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?sf:isNaN(n=Number(t.substring(n,r)))?sd:(r+=1)+n>t.length?sf:(t=t.slice(r,r+n),e.C=r+n,t)}function sb(e){e.Y=Date.now()+e.P,sS(e,e.P)}function sS(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=i8(rO(e.lb,e),t)}function sT(e){e.B&&(rI.clearTimeout(e.B),e.B=null)}function sw(e){0==e.l.H||e.J||aj(e.l,e)}function sC(e){sT(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,iV(e.V),iW(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function sE(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||s3(n.i,e))){if(!e.K&&s3(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(n.g.G+3e3<e.G)aF(n),ak(n);else break e}aP(n),i5(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=i8(rO(n.ib,n),6e3));if(1>=s2(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else aV(n,11)}else if((e.K||n.g==e)&&aF(n),!rz(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H){if("c"==u[0]){n.K=u[1],n.pa=u[2];let t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));let i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));let c=u[5];null!=c&&"number"==typeof c&&0<c&&(r=1.5*c,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(s4(s,s.h),s.h=null))}if(r.F){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,sP(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var a=e;if(r.wa=az(r,r.J?r.pa:null,r.Y),a.K){s6(r.i,a);var o=a,l=r.L;l&&o.setTimeout(l),o.B&&(sT(o),sb(o)),r.g=a}else aM(r);0<n.j.length&&aR(n)}else"stop"!=u[0]&&"close"!=u[0]||aV(n,7)}else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?aV(n,7):a_(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}}i6(4)}catch(e){}}function sI(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(r_(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}function s_(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(r_(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}function sk(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(r_(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=s_(e),r=sI(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(rS=su.prototype).setTimeout=function(e){this.P=e},rS.nb=function(e){e=e.target;let t=this.M;t&&3==ab(e)?t.l():this.Pa(e)},rS.Pa=function(e){try{if(e==this.g)e:{let c=ab(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>c)&&(3!=c||rJ||this.g&&(this.h.h||this.g.ja()||aS(this.g)))){this.J||4!=c||7==t||(8==t||0>=h?i6(3):i6(2)),sT(this);var n=this.g.da();this.ca=n;t:if(sm(this)){var r=aS(this.g);e="";var i=r.length,s=4==ab(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){sC(this),sw(this);var a="";break t}this.h.i=new rI.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ja();if(this.i=200==n,iJ(this.j,this.u,this.A,this.m,this.W,c,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var o,l=this.g;if((o=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!rz(o)){var u=o;break t}}u=null}if(n=u)iX(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,sE(this,n);else{this.i=!1,this.o=3,i5(12),sC(this),sw(this);break e}}this.S?(sy(this,c,a),rJ&&this.i&&3==c&&(iK(this.U,this.V,"tick",this.mb),this.V.start())):(iX(this.j,this.m,a,null),sE(this,a)),4==c&&sC(this),this.i&&!this.J&&(4==c?aj(this.l,this):(this.i=!1,sb(this)))}else aT(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.o=3,i5(12)):(this.o=0,i5(13)),sC(this),sw(this)}}}catch(e){}finally{}},rS.mb=function(){if(this.g){var e=ab(this.g),t=this.g.ja();this.C<t.length&&(sT(this),sy(this,e,t),this.i&&4!=e&&sb(this))}},rS.cancel=function(){this.J=!0,sC(this)},rS.lb=function(){this.B=null;let e=Date.now();0<=e-this.Y?(iZ(this.j,this.A),2!=this.L&&(i6(),i5(17)),sC(this),this.o=2,sw(this)):sS(this,this.Y-e)};var sD=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function sR(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function sA(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof sA){this.h=e.h,sN(this,e.j),this.s=e.s,this.g=e.g,sO(this,e.m),this.l=e.l;var t=e.i,n=new sG;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),sM(this,n),this.o=e.o}else e&&(t=String(e).match(sD))?(this.h=!1,sN(this,t[1]||"",!0),this.s=sB(t[2]||""),this.g=sB(t[3]||"",!0),sO(this,t[4]),this.l=sB(t[5]||"",!0),sM(this,t[6]||"",!0),this.o=sB(t[7]||"")):(this.h=!1,this.i=new sG(null,this.h))}function sx(e){return new sA(e)}function sN(e,t,n){e.j=n?sB(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function sO(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function sM(e,t,n){t instanceof sG?(e.i=t,sJ(e.i,e.h)):(n||(t=sF(t,sz)),e.i=new sG(t,e.h))}function sP(e,t,n){e.i.set(t,n)}function sL(e){return sP(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function sB(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function sF(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,sj),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function sj(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}sA.prototype.toString=function(){var e=[],t=this.j;t&&e.push(sF(t,sU,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(sF(t,sU,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(sF(n,"/"==n.charAt(0)?sq:sV,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",sF(n,s$)),e.join("")};var sU=/[#\/\?@]/g,sV=/[#\?:]/g,sq=/[#\?]/g,sz=/[#\?@]/g,s$=/#/g;function sG(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function sH(e){e.g||(e.g=new Map,e.h=0,e.i&&sR(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function sK(e,t){sH(e),t=sY(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function sW(e,t){return sH(e),t=sY(e,t),e.g.has(t)}function sQ(e,t,n){sK(e,t),0<n.length&&(e.i=null,e.g.set(sY(e,t),rj(n)),e.h+=n.length)}function sY(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function sJ(e,t){t&&!e.j&&(sH(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(sK(this,t),sQ(this,n,e))},e)),e.j=t}(rS=sG.prototype).add=function(e,t){sH(this),this.i=null,e=sY(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},rS.forEach=function(e,t){sH(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},rS.ta=function(){sH(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},rS.Z=function(e){sH(this);let t=[];if("string"==typeof e)sW(this,e)&&(t=t.concat(this.g.get(sY(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},rS.set=function(e,t){return sH(this),this.i=null,sW(this,e=sY(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},rS.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},rS.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")};var sX=class{constructor(e,t){this.g=e,this.map=t}};function sZ(e){this.l=e||s0,e=rI.PerformanceNavigationTiming?0<(e=rI.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(rI.g&&rI.g.Ka&&rI.g.Ka()&&rI.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var s0=10;function s1(e){return!!e.h||!!e.g&&e.g.size>=e.j}function s2(e){return e.h?1:e.g?e.g.size:0}function s3(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function s4(e,t){e.g?e.g.add(t):e.h=t}function s6(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function s9(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return rj(e.i)}sZ.prototype.cancel=function(){if(this.i=s9(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var s5=class{stringify(e){return rI.JSON.stringify(e,void 0)}parse(e){return rI.JSON.parse(e,void 0)}};function s7(){this.g=new s5}function s8(e,t,n){let r=n||"";try{sk(e,function(e,n){let i=e;rk(e)&&(i=ik(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function ae(e,t){let n=new iQ;if(rI.Image){let r=new Image;r.onload=rM(at,n,r,"TestLoadImage: loaded",!0,t),r.onerror=rM(at,n,r,"TestLoadImage: error",!1,t),r.onabort=rM(at,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=rM(at,n,r,"TestLoadImage: timeout",!1,t),rI.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function at(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function an(e){this.l=e.ec||null,this.j=e.ob||!1}function ar(e,t){iE.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=ai,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}rP(an,sn),an.prototype.g=function(){return new ar(this.l,this.j)},an.prototype.i=function(e){return function(){return e}}({}),rP(ar,iE);var ai=0;function as(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function aa(e){e.readyState=4,e.l=null,e.j=null,e.A=null,ao(e)}function ao(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(rS=ar.prototype).open=function(e,t){if(this.readyState!=ai)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,ao(this)},rS.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||rI).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},rS.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,aa(this)),this.readyState=ai},rS.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,ao(this)),this.g&&(this.readyState=3,ao(this),this.g))){if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==rI.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;as(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))}},rS.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?aa(this):ao(this),3==this.readyState&&as(this)}},rS.Za=function(e){this.g&&(this.response=this.responseText=e,aa(this))},rS.Ya=function(e){this.g&&(this.response=e,aa(this))},rS.ka=function(){this.g&&aa(this)},rS.setRequestHeader=function(e,t){this.v.append(e,t)},rS.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},rS.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(ar.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var al=rI.JSON.parse;function au(e){iE.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=ac,this.L=this.M=!1}rP(au,iE);var ac="",ah=/^https?$/i,ad=["POST","PUT"];function af(e){return rQ&&"number"==typeof e.timeout&&void 0!==e.ontimeout}function ap(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,ag(e),ay(e)}function ag(e){e.F||(e.F=!0,iI(e,"complete"),iI(e,"error"))}function am(e){if(e.h&&void 0!==rE&&(!e.C[1]||4!=ab(e)||2!=e.da())){if(e.v&&4==ab(e))iq(e.La,0,e);else if(iI(e,"readystatechange"),4==ab(e)){e.h=!1;try{let a=e.da();switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===a){var i=String(e.I).match(sD)[1]||null;!i&&rI.self&&rI.self.location&&(i=rI.self.location.protocol.slice(0,-1)),n=!ah.test(i?i.toLowerCase():"")}t=n}if(t)iI(e,"complete"),iI(e,"success");else{e.m=6;try{var s=2<ab(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",ag(e)}}finally{ay(e)}}}}function ay(e,t){if(e.g){av(e);let n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||iI(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function av(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(rI.clearTimeout(e.A),e.A=null)}function ab(e){return e.g?e.g.readyState:0}function aS(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case ac:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function aT(e){let t={};e=(e.g&&2<=ab(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(rz(e[r]))continue;var n=iO(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}ir(t,function(e){return e.join(", ")})}function aw(e){let t="";return it(e,function(e,n){t+=n+":"+e+"\r\n"}),t}function aC(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=aw(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):sP(e,t,n))}function aE(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function aI(e){this.Ga=0,this.j=[],this.l=new iQ,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=aE("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=aE("baseRetryDelayMs",5e3,e),this.hb=aE("retryDelaySeedMs",1e4,e),this.eb=aE("forwardChannelMaxRetries",2,e),this.xa=aE("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new sZ(e&&e.concurrentRequestLimit),this.Ja=new s7,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function a_(e){if(aD(e),3==e.H){var t=e.W++,n=sx(e.I);if(sP(n,"SID",e.K),sP(n,"RID",t),sP(n,"TYPE","terminate"),aN(e,n),(t=new su(e,e.l,t)).L=2,t.v=sL(sx(n)),n=!1,rI.navigator&&rI.navigator.sendBeacon)try{n=rI.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&rI.Image&&((new Image).src=t.v,n=!0),n||(t.g=a$(t.l,null),t.g.ha(t.v)),t.G=Date.now(),sb(t)}aq(e)}function ak(e){e.g&&(aL(e),e.g.cancel(),e.g=null)}function aD(e){ak(e),e.u&&(rI.clearTimeout(e.u),e.u=null),aF(e),e.i.cancel(),e.m&&("number"==typeof e.m&&rI.clearTimeout(e.m),e.m=null)}function aR(e){if(!s1(e.i)&&!e.m){e.m=!0;var t=e.Na;iP||iF(),iL||(iP(),iL=!0),iB.add(t,e),e.C=0}}function aA(e,t){return!(s2(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.j=t.F.concat(e.j),!0):1!=e.H&&2!=e.H&&!(e.C>=(e.cb?0:e.eb))&&(e.m=i8(rO(e.Na,e,t),aU(e,e.C)),e.C++,!0))}function ax(e,t){var n;n=t?t.m:e.W++;let r=sx(e.I);sP(r,"SID",e.K),sP(r,"RID",n),sP(r,"AID",e.V),aN(e,r),e.o&&e.s&&aC(r,e.o,e.s),n=new su(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=aO(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),s4(e.i,n),sp(n,r,t)}function aN(e,t){e.na&&it(e.na,function(e,n){sP(t,n,e)}),e.h&&sk({},function(e,n){sP(t,n,e)})}function aO(e,t,n){n=Math.min(e.j.length,n);var r=e.h?rO(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{s8(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function aM(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;iP||iF(),iL||(iP(),iL=!0),iB.add(t,e),e.A=0}}function aP(e){return!e.g&&!e.u&&!(3<=e.A)&&(e.ba++,e.u=i8(rO(e.Ma,e),aU(e,e.A)),e.A++,!0)}function aL(e){null!=e.B&&(rI.clearTimeout(e.B),e.B=null)}function aB(e){e.g=new su(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=sx(e.wa);sP(t,"RID","rpc"),sP(t,"SID",e.K),sP(t,"AID",e.V),sP(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&sP(t,"TO",e.qa),sP(t,"TYPE","xmlhttp"),aN(e,t),e.o&&e.s&&aC(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=sL(sx(t)),n.s=null,n.S=!0,sg(n,e)}function aF(e){null!=e.v&&(rI.clearTimeout(e.v),e.v=null)}function aj(e,t){var n=null;if(e.g==t){aF(e),aL(e),e.g=null;var r=2}else{if(!s3(e.i,t))return;n=t.F,s6(e.i,t),r=1}if(0!=e.H){if(t.i){if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var i=e.C;iI(r=i3(),new i7(r,n)),aR(e)}else aM(e)}else if(3==(i=t.o)||0==i&&0<t.ca||!(1==r&&aA(e,t)||2==r&&aP(e)))switch(n&&0<n.length&&((t=e.i).i=t.i.concat(n)),i){case 1:aV(e,5);break;case 4:aV(e,10);break;case 3:aV(e,6);break;default:aV(e,2)}}}function aU(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function aV(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=rO(e.pb,e);n||(n=new sA("//www.google.com/images/cleardot.gif"),rI.location&&"http"==rI.location.protocol||sN(n,"https"),sL(n)),ae(n.toString(),r)}else i5(2);e.H=0,e.h&&e.h.za(t),aq(e),aD(e)}function aq(e){if(e.H=0,e.ma=[],e.h){let t=s9(e.i);(0!=t.length||0!=e.j.length)&&(rU(e.ma,t),rU(e.ma,e.j),e.i.i.length=0,rj(e.j),e.j.length=0),e.h.ya()}}function az(e,t,n){var r=n instanceof sA?sx(n):new sA(n);if(""!=r.g)t&&(r.g=t+"."+r.g),sO(r,r.m);else{var i=rI.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new sA(null);r&&sN(s,r),t&&(s.g=t),i&&sO(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&sP(r,n,t),sP(r,"VER",e.ra),aN(e,r),r}function a$(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new au(n&&e.Ha&&!e.va?new an({ob:!0}):e.va)).Oa(e.J),t}function aG(){}function aH(){if(rQ&&!(10<=Number(r4)))throw Error("Environmental error: no available transport.")}function aK(e,t){iE.call(this),this.g=new aI(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!rz(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!rz(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new aY(this)}function aW(e){sa.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function aQ(){so.call(this),this.status=1}function aY(e){this.g=e}function aJ(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function aX(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+3614090360&4294967295;a=s+(i^(t=n+(a<<7&4294967295|a>>>25))&(n^i))+r[1]+3905402710&4294967295,a=i+(n^(s=t+(a<<12&4294967295|a>>>20))&(t^n))+r[2]+606105819&4294967295,a=n+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+r[3]+3250441966&4294967295,a=t+(s^(n=i+(a<<22&4294967295|a>>>10))&(i^s))+r[4]+4118548399&4294967295,a=s+(i^(t=n+(a<<7&4294967295|a>>>25))&(n^i))+r[5]+1200080426&4294967295,a=i+(n^(s=t+(a<<12&4294967295|a>>>20))&(t^n))+r[6]+2821735955&4294967295,a=n+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+r[7]+4249261313&4294967295,a=t+(s^(n=i+(a<<22&4294967295|a>>>10))&(i^s))+r[8]+1770035416&4294967295,a=s+(i^(t=n+(a<<7&4294967295|a>>>25))&(n^i))+r[9]+2336552879&4294967295,a=i+(n^(s=t+(a<<12&4294967295|a>>>20))&(t^n))+r[10]+4294925233&4294967295,a=n+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+r[11]+2304563134&4294967295,a=t+(s^(n=i+(a<<22&4294967295|a>>>10))&(i^s))+r[12]+1804603682&4294967295,a=s+(i^(t=n+(a<<7&4294967295|a>>>25))&(n^i))+r[13]+4254626195&4294967295,a=i+(n^(s=t+(a<<12&4294967295|a>>>20))&(t^n))+r[14]+2792965006&4294967295,a=n+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+r[15]+1236535329&4294967295,n=i+(a<<22&4294967295|a>>>10),a=t+(i^s&(n^i))+r[1]+4129170786&4294967295,t=n+(a<<5&4294967295|a>>>27),a=s+(n^i&(t^n))+r[6]+3225465664&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^n&(s^t))+r[11]+643717713&4294967295,i=s+(a<<14&4294967295|a>>>18),a=n+(s^t&(i^s))+r[0]+3921069994&4294967295,n=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(n^i))+r[5]+3593408605&4294967295,t=n+(a<<5&4294967295|a>>>27),a=s+(n^i&(t^n))+r[10]+38016083&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^n&(s^t))+r[15]+3634488961&4294967295,i=s+(a<<14&4294967295|a>>>18),a=n+(s^t&(i^s))+r[4]+3889429448&4294967295,n=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(n^i))+r[9]+568446438&4294967295,t=n+(a<<5&4294967295|a>>>27),a=s+(n^i&(t^n))+r[14]+3275163606&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^n&(s^t))+r[3]+4107603335&4294967295,i=s+(a<<14&4294967295|a>>>18),a=n+(s^t&(i^s))+r[8]+1163531501&4294967295,n=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(n^i))+r[13]+2850285829&4294967295,t=n+(a<<5&4294967295|a>>>27),a=s+(n^i&(t^n))+r[2]+4243563512&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^n&(s^t))+r[7]+1735328473&4294967295,i=s+(a<<14&4294967295|a>>>18),a=n+(s^t&(i^s))+r[12]+2368359562&4294967295,a=t+((n=i+(a<<20&4294967295|a>>>12))^i^s)+r[5]+4294588738&4294967295,a=s+((t=n+(a<<4&4294967295|a>>>28))^n^i)+r[8]+2272392833&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^n)+r[11]+1839030562&4294967295,a=n+((i=s+(a<<16&4294967295|a>>>16))^s^t)+r[14]+4259657740&4294967295,a=t+((n=i+(a<<23&4294967295|a>>>9))^i^s)+r[1]+2763975236&4294967295,a=s+((t=n+(a<<4&4294967295|a>>>28))^n^i)+r[4]+1272893353&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^n)+r[7]+4139469664&4294967295,a=n+((i=s+(a<<16&4294967295|a>>>16))^s^t)+r[10]+3200236656&4294967295,a=t+((n=i+(a<<23&4294967295|a>>>9))^i^s)+r[13]+681279174&4294967295,a=s+((t=n+(a<<4&4294967295|a>>>28))^n^i)+r[0]+3936430074&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^n)+r[3]+3572445317&4294967295,a=n+((i=s+(a<<16&4294967295|a>>>16))^s^t)+r[6]+76029189&4294967295,a=t+((n=i+(a<<23&4294967295|a>>>9))^i^s)+r[9]+3654602809&4294967295,a=s+((t=n+(a<<4&4294967295|a>>>28))^n^i)+r[12]+3873151461&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^n)+r[15]+530742520&4294967295,a=n+((i=s+(a<<16&4294967295|a>>>16))^s^t)+r[2]+3299628645&4294967295,n=i+(a<<23&4294967295|a>>>9),a=t+(i^(n|~s))+r[0]+4096336452&4294967295,t=n+(a<<6&4294967295|a>>>26),a=s+(n^(t|~i))+r[7]+1126891415&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~n))+r[14]+2878612391&4294967295,i=s+(a<<15&4294967295|a>>>17),a=n+(s^(i|~t))+r[5]+4237533241&4294967295,n=i+(a<<21&4294967295|a>>>11),a=t+(i^(n|~s))+r[12]+1700485571&4294967295,t=n+(a<<6&4294967295|a>>>26),a=s+(n^(t|~i))+r[3]+2399980690&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~n))+r[10]+4293915773&4294967295,i=s+(a<<15&4294967295|a>>>17),a=n+(s^(i|~t))+r[1]+2240044497&4294967295,n=i+(a<<21&4294967295|a>>>11),a=t+(i^(n|~s))+r[8]+1873313359&4294967295,t=n+(a<<6&4294967295|a>>>26),a=s+(n^(t|~i))+r[15]+4264355552&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~n))+r[6]+2734768916&4294967295,i=s+(a<<15&4294967295|a>>>17),a=n+(s^(i|~t))+r[13]+1309151649&4294967295,n=i+(a<<21&4294967295|a>>>11),a=t+(i^(n|~s))+r[4]+4149444226&4294967295,t=n+(a<<6&4294967295|a>>>26),a=s+(n^(t|~i))+r[11]+3174756917&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~n))+r[2]+718787259&4294967295,i=s+(a<<15&4294967295|a>>>17),a=n+(s^(i|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function aZ(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(rS=au.prototype).Oa=function(e){this.M=e},rS.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():f.g(),this.C=this.u?sr(this.u):sr(f),this.g.onreadystatechange=rO(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){ap(this,e);return}if(e=n||"",n=new Map(this.headers),r){if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if("function"==typeof r.keys&&"function"==typeof r.get)for(let e of r.keys())n.set(e,r.get(e));else throw Error("Unknown input type for opt_headers: "+String(r))}for(let[s,a]of(r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=rI.FormData&&e instanceof rI.FormData,!(0<=rF(ad,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{av(this),0<this.B&&((this.L=af(this.g))?(this.g.timeout=this.B,this.g.ontimeout=rO(this.ua,this)):this.A=iq(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){ap(this,e)}},rS.ua=function(){void 0!==rE&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,iI(this,"timeout"),this.abort(8))},rS.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,iI(this,"complete"),iI(this,"abort"),ay(this))},rS.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ay(this,!0)),au.$.N.call(this)},rS.La=function(){this.s||(this.G||this.v||this.l?am(this):this.kb())},rS.kb=function(){am(this)},rS.isActive=function(){return!!this.g},rS.da=function(){try{return 2<ab(this)?this.g.status:-1}catch(e){return -1}},rS.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},rS.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),al(t)}},rS.Ia=function(){return this.m},rS.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(rS=aI.prototype).ra=8,rS.H=1,rS.Na=function(e){if(this.m){if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let i=new su(this,this.l,e),s=this.s;if(this.U&&(s?ia(s=ii(s),this.U):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=aO(this,i,t),sP(n=sx(this.I),"RID",e),sP(n,"CVER",22),this.F&&sP(n,"X-HTTP-Session-Id",this.F),aN(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(aw(s)))+"&"+t:this.o&&aC(n,this.o,s)),s4(this.i,i),this.bb&&sP(n,"TYPE","init"),this.P?(sP(n,"$req",t),sP(n,"SID","null"),i.aa=!0,sp(i,n,null)):sp(i,n,t),this.H=2}}else 3==this.H&&(e?ax(this,e):0==this.j.length||s1(this.i)||ax(this))}},rS.Ma=function(){if(this.u=null,aB(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=i8(rO(this.jb,this),e)}},rS.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,i5(10),ak(this),aB(this))},rS.ib=function(){null!=this.v&&(this.v=null,ak(this),aP(this),i5(19))},rS.pb=function(e){e?(this.l.info("Successfully pinged google.com"),i5(2)):(this.l.info("Failed to ping google.com"),i5(1))},rS.isActive=function(){return!!this.h&&this.h.isActive(this)},(rS=aG.prototype).Ba=function(){},rS.Aa=function(){},rS.za=function(){},rS.ya=function(){},rS.isActive=function(){return!0},rS.Va=function(){},aH.prototype.g=function(e,t){return new aK(e,t)},rP(aK,iE),aK.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;i5(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=az(e,null,e.Y),aR(e)},aK.prototype.close=function(){a_(this.g)},aK.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=ik(e),e=n);t.j.push(new sX(t.fb++,e)),3==t.H&&aR(t)},aK.prototype.N=function(){this.g.h=null,delete this.j,a_(this.g),delete this.g,aK.$.N.call(this)},rP(aW,sa),rP(aQ,so),rP(aY,aG),aY.prototype.Ba=function(){iI(this.g,"a")},aY.prototype.Aa=function(e){iI(this.g,new aW(e))},aY.prototype.za=function(e){iI(this.g,new aQ)},aY.prototype.ya=function(){iI(this.g,"b")},rP(aJ,function(){this.blockSize=-1}),aJ.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},aJ.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)aX(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){aX(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){aX(this,r),i=0;break}}this.h=i,this.i+=t},aJ.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var a0={};function a1(e){return -128<=e&&128>e?rK(e,function(e){return new aZ([0|e],0>e?-1:0)}):new aZ([0|e],0>e?-1:0)}function a2(e){if(isNaN(e)||!isFinite(e))return a6;if(0>e)return oe(a2(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=a4;return new aZ(t,0)}function a3(e,t){if(0==e.length)throw Error("number format error: empty string");if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return oe(a3(e.substring(1),t));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=a2(Math.pow(t,8)),r=a6,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+s),t);8>s?(s=a2(Math.pow(t,s)),r=r.R(s).add(a2(a))):r=(r=r.R(n)).add(a2(a))}return r}var a4=4294967296,a6=a1(0),a9=a1(1),a5=a1(16777216);function a7(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function a8(e){return -1==e.h}function oe(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new aZ(n,~e.h).add(a9)}function ot(e,t){return e.add(oe(t))}function on(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function or(e,t){this.g=e,this.h=t}function oi(e,t){if(a7(t))throw Error("division by zero");if(a7(e))return new or(a6,a6);if(a8(e))return t=oi(oe(e),t),new or(oe(t.g),oe(t.h));if(a8(t))return t=oi(e,oe(t)),new or(oe(t.g),t.h);if(30<e.g.length){if(a8(e)||a8(t))throw Error("slowDivide_ only works with positive integers.");for(var n=a9,r=t;0>=r.X(e);)n=os(n),r=os(r);var i=oa(n,1),s=oa(r,1);for(r=oa(r,2),n=oa(n,2);!a7(r);){var a=s.add(r);0>=a.X(e)&&(i=i.add(n),s=a),r=oa(r,1),n=oa(n,1)}return t=ot(e,i.R(t)),new or(i,t)}for(i=a6;0<=e.X(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.ea()/t.ea())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=a2(n)).R(t);a8(a)||0<a.X(e);)n-=r,a=(s=a2(n)).R(t);a7(s)&&(s=a9),i=i.add(s),e=ot(e,a)}return new or(i,e)}function os(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new aZ(n,e.h)}function oa(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new aZ(i,e.h)}(rS=aZ.prototype).ea=function(){if(a8(this))return-oe(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:a4+r)*t,t*=a4}return e},rS.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(a7(this))return"0";if(a8(this))return"-"+oe(this).toString(e);for(var t=a2(Math.pow(e,6)),n=this,r="";;){var i=oi(n,t).g,s=((0<(n=ot(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(a7(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},rS.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},rS.X=function(e){return a8(e=ot(this,e))?-1:a7(e)?0:1},rS.abs=function(){return a8(this)?oe(this):this},rS.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),a=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=a>>>16,s&=65535,a&=65535,n[i]=a<<16|s}return new aZ(n,-2147483648&n[n.length-1]?-1:0)},rS.R=function(e){if(a7(this)||a7(e))return a6;if(a8(this))return a8(e)?oe(this).R(oe(e)):oe(oe(this).R(e));if(a8(e))return oe(this.R(oe(e)));if(0>this.X(a5)&&0>e.X(a5))return a2(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,a=65535&this.D(r),o=e.D(i)>>>16,l=65535&e.D(i);n[2*r+2*i]+=a*l,on(n,2*r+2*i),n[2*r+2*i+1]+=s*l,on(n,2*r+2*i+1),n[2*r+2*i+1]+=a*o,on(n,2*r+2*i+1),n[2*r+2*i+2]+=s*o,on(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new aZ(n,0)},rS.gb=function(e){return oi(this,e).h},rS.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new aZ(n,this.h&e.h)},rS.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new aZ(n,this.h|e.h)},rS.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new aZ(n,this.h^e.h)},aH.prototype.createWebChannel=aH.prototype.g,aK.prototype.send=aK.prototype.u,aK.prototype.open=aK.prototype.m,aK.prototype.close=aK.prototype.close,se.NO_ERROR=0,se.TIMEOUT=8,se.HTTP_ERROR=6,st.COMPLETE="complete",si.EventType=ss,ss.OPEN="a",ss.CLOSE="b",ss.ERROR="c",ss.MESSAGE="d",iE.prototype.listen=iE.prototype.O,au.prototype.listenOnce=au.prototype.P,au.prototype.getLastError=au.prototype.Sa,au.prototype.getLastErrorCode=au.prototype.Ia,au.prototype.getStatus=au.prototype.da,au.prototype.getResponseJson=au.prototype.Wa,au.prototype.getResponseText=au.prototype.ja,au.prototype.send=au.prototype.ha,au.prototype.setWithCredentials=au.prototype.Oa,aJ.prototype.digest=aJ.prototype.l,aJ.prototype.reset=aJ.prototype.reset,aJ.prototype.update=aJ.prototype.j,aZ.prototype.add=aZ.prototype.add,aZ.prototype.multiply=aZ.prototype.R,aZ.prototype.modulo=aZ.prototype.gb,aZ.prototype.compare=aZ.prototype.X,aZ.prototype.toNumber=aZ.prototype.ea,aZ.prototype.toString=aZ.prototype.toString,aZ.prototype.getBits=aZ.prototype.D,aZ.fromNumber=a2,aZ.fromString=a3,rC.createWebChannelTransport=function(){return new aH},rC.getStatEventTarget=function(){return i3()},rC.ErrorCode=se,rC.EventType=st,rC.Event=i1,rC.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},rC.FetchXmlHttpFactory=an,rC.WebChannel=si,rC.XhrIo=au;var oo=rC.Md5=aJ,ol=rC.Integer=aZ;n(94415),n(9256);let ou="@firebase/firestore",oc="4.3.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}oh.UNAUTHENTICATED=new oh(null),oh.GOOGLE_CREDENTIALS=new oh("google-credentials-uid"),oh.FIRST_PARTY=new oh("first-party-uid"),oh.MOCK_USER=new oh("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let od="10.5.2";function of(e){od=e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function op(e){return(0,rT.inspect)(e,{depth:100})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let og=new eS("@firebase/firestore");function om(){return og.logLevel}function oy(e,...t){if(og.logLevel<=rb.DEBUG){let n=t.map(oS);og.debug(`Firestore (${od}): ${e}`,...n)}}function ov(e,...t){if(og.logLevel<=rb.ERROR){let n=t.map(oS);og.error(`Firestore (${od}): ${e}`,...n)}}function ob(e,...t){if(og.logLevel<=rb.WARN){let n=t.map(oS);og.warn(`Firestore (${od}): ${e}`,...n)}}function oS(e){if("string"==typeof e)return e;try{return op(e)}catch(t){return e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oT(e="Unexpected state"){let t=`FIRESTORE (${od}) INTERNAL ASSERTION FAILED: `+e;throw ov(t),Error(t)}function ow(e,t){e||oT()}function oC(e,t){return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oE={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class oI extends J{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o_{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ok{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class oD{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(oh.UNAUTHENTICATED))}shutdown(){}}class oR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class oA{constructor(e){this.authProvider=e,this.currentUser=oh.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.tokenCounter,r=e=>this.tokenCounter!==n?(n=this.tokenCounter,t(e)):Promise.resolve(),i=new o_;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new o_,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{oy("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.tokenListener),s()};this.authProvider.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.authProvider.getImmediate({optional:!0});e?a(e):(oy("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new o_)}},0),s()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(oy("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ow("string"==typeof t.accessToken),new ok(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return ow(null===e||"string"==typeof e),new oh(e)}}class ox{constructor(e,t,n){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=n,this.type="FirstParty",this.user=oh.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class oN{constructor(e,t,n){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=n}getToken(){return Promise.resolve(new ox(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(oh.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class oO{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class oM{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let n=e=>{null!=e.error&&oy("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,oy("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{oy("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.appCheckProvider.getImmediate({optional:!0});e?r(e):oy("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(ow("string"==typeof e.token),this.latestAppCheckToken=e.token,new oO(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}}function oP(e){if(!e)return new oD;switch(e.type){case"firstParty":return new oN(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new oI(oE.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oL(e){return(0,rw.randomBytes)(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oB{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="",r=20;for(;n.length<r;){let i=oL(40);for(let s=0;s<i.length;++s)n.length<r&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}}function oF(e,t){return e<t?-1:e>t?1:0}function oj(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}function oU(e){return e+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oV=-62135596800,oq=1e6;class oz{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new oI(oE.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<oV||e>=253402300800)throw new oI(oE.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return oz.fromMillis(Date.now())}static fromDate(e){return oz.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*oq);return new oz(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/oq}_compareTo(e){return this.seconds===e.seconds?oF(this.nanoseconds,e.nanoseconds):oF(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds-oV).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o${constructor(e){this.timestamp=e}static fromTimestamp(e){return new o$(e)}static min(){return new o$(new oz(0,0))}static max(){return new o$(new oz(253402300799,1e9-1))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oG="__name__";class oH{constructor(e,t,n){void 0===t?t=0:t>e.length&&oT(),void 0===n?n=e.length-t:n>e.length-t&&oT(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===oH.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof oH?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.get(r),i=t.get(r);if(n<i)return -1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class oK extends oH{construct(e,t,n){return new oK(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new oI(oE.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new oK(t)}static emptyPath(){return new oK([])}}let oW=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class oQ extends oH{construct(e,t,n){return new oQ(e,t,n)}static isValidIdentifier(e){return oW.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),oQ.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===oG}static keyField(){return new oQ([oG])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new oI(oE.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new oI(oE.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if(!("\\"===t||"."===t||"`"===t))throw new oI(oE.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new oI(oE.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new oQ(t)}static emptyPath(){return new oQ([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oY{constructor(e){this.path=e}static fromPath(e){return new oY(oK.fromString(e))}static fromName(e){return new oY(oK.fromString(e).popFirst(5))}static empty(){return new oY(oK.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===oK.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return oK.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new oY(new oK(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oJ=-1,oX=0;class oZ{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function o0(e){return e.fields.find(e=>2===e.kind)}function o1(e){return e.fields.filter(e=>2!==e.kind)}function o2(e){let t=o1(e);return 0===t.length?0:t[t.length-1].kind}function o3(e,t){let n=oF(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=o9(e.fields[r],t.fields[r])))return n;return oF(e.fields.length,t.fields.length)}function o4(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}oZ.UNKNOWN_ID=-1;class o6{constructor(e,t){this.fieldPath=e,this.kind=t}}function o9(e,t){let n=oQ.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:oF(e.kind,t.kind)}class o5{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new o5(oX,le.min())}}function o7(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new le(o$.fromTimestamp(1e9===r?new oz(n+1,0):new oz(n,r)),oY.empty(),t)}function o8(e){return new le(e.readTime,e.key,oJ)}class le{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new le(o$.min(),oY.empty(),oJ)}static max(){return new le(o$.max(),oY.empty(),oJ)}}function lt(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=oY.comparator(e.documentKey,t.documentKey))?n:oF(e.largestBatchId,t.largestBatchId)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ln="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class lr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function li(e){if(e.code===oE.FAILED_PRECONDITION&&e.message===ln)oy("LocalStore","Unexpectedly lost primary lease");else throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&oT(),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ls((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();if(t instanceof ls)return t;return ls.resolve(t)}catch(e){return ls.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ls.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ls.reject(t)}static resolve(e){return new ls((t,n)=>{t(e)})}static reject(e){return new ls((t,n)=>{n(e)})}static waitFor(e){return new ls((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=ls.resolve(!1);for(let n of e)t=t.next(e=>e?ls.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new ls((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new ls((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let la="SimpleDb",lo=3;class ll{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new o_,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new lh(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{let n=lm(t.target.error);this.completionDeferred.reject(new lh(e,n))}}static open(e,t,n,r){try{return new ll(t,e.transaction(r,n))}catch(e){throw new lh(t,e)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(oy(la,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new lf(this.transaction.objectStore(e))}}class lu{constructor(e,t,n){this.name=e,this.version=t,this.schemaConverter=n,12.2===lu.getIOSVersion(z())&&ov("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return oy(la,"Removing database:",e),lp(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!K())return!1;if(lu.isMockPersistence())return!0;let e=z(),t=lu.getIOSVersion(e),n=0<t&&t<10,r=lu.getAndroidVersion(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!n&&!i}static isMockPersistence(){var e;return"undefined"!=typeof process&&(null===(e=process.env)||void 0===e?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}static getAndroidVersion(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}async ensureDb(e){return this.db||(oy(la,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new lh(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new oI(oE.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new oI(oE.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new lh(e,r))},r.onupgradeneeded=e=>{oy(la,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.schemaConverter.createOrUpgrade(t,r.transaction,e.oldVersion,this.version).next(()=>{oy(la,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=e=>this.versionchangelistener(e)),this.db}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);let t=ll.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),ls.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(n){let e=n,t="FirebaseError"!==e.name&&s<lo;if(oy(la,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class lc{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return lp(this.dbCursor.delete())}}class lh extends oI{constructor(e,t){super(oE.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ld(e){return"IndexedDbTransactionError"===e.name}class lf{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(oy(la,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(oy(la,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),lp(n)}add(e){return oy(la,"ADD",this.store.name,e,e),lp(this.store.add(e))}get(e){return lp(this.store.get(e)).next(t=>(void 0===t&&(t=null),oy(la,"GET",this.store.name,e,t),t))}delete(e){return oy(la,"DELETE",this.store.name,e),lp(this.store.delete(e))}count(){return oy(la,"COUNT",this.store.name),lp(this.store.count())}loadAll(e,t){let n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){let e=this.cursor(n),t=[];return this.iterateCursor(e,(e,n)=>{t.push(n)}).next(()=>t)}{let e=this.store.getAll(n.range);return new ls((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}loadFirst(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new ls((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){oy(la,"DELETE ALL",this.store.name);let n=this.options(e,t);n.keysOnly=!1;let r=this.cursor(n);return this.iterateCursor(r,(e,t,n)=>n.delete())}iterate(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.iterateCursor(r,t)}iterateSerial(e){let t=this.cursor({});return new ls((n,r)=>{t.onerror=e=>{r(lm(e.target.error))},t.onsuccess=t=>{let r=t.target.result;if(!r){n();return}e(r.primaryKey,r.value).next(e=>{e?r.continue():n()})}})}iterateCursor(e,t){let n=[];return new ls((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i){r();return}let s=new lc(i),a=t(i.primaryKey,i.value,s);if(a instanceof ls){let e=a.catch(e=>(s.done(),ls.reject(e)));n.push(e)}s.isDone?r():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>ls.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{let n=this.store.index(e.index);return e.keysOnly?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}}}function lp(e){return new ls((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(lm(e.target.error))}})}let lg=!1;function lm(e){let t=lu.getIOSVersion(z());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new oI("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return lg||(lg=!0,setTimeout(()=>{throw e},0)),e}}return e}let ly="IndexBackiller",lv=15e3,lb=6e4,lS=50;class lT{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(lv)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){oy(ly,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.backfiller.backfill();oy(ly,`Documents written: ${e}`)}catch(e){ld(e)?oy(ly,"Ignoring IndexedDB error during index backfill: ",e):await li(e)}await this.schedule(lb)})}}class lw{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=lS){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let n=new Set,r=t,i=!0;return ls.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||n.has(t)))return oy(ly,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}writeEntriesForCollectionGroup(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(r,n)).next(n=>(oy(ly,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}getNewOffset(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=o8(t);lt(r,n)>0&&(n=r)}),new le(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lC{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}lC.INVALID=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lE="\x01",lI="\x01",l_="\x10",lk="\x11";function lD(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=lA(t)),t=lR(e.get(n),t);return lA(t)}function lR(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+=lE+l_;break;case lE:n+=lE+lk;break;default:n+=r}}return n}function lA(e){return e+lE+lI}function lx(e){let t=e.length;if(ow(t>=2),2===t)return ow(e.charAt(0)===lE&&e.charAt(1)===lI),oK.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf(lE,s);switch((t<0||t>n)&&oT(),e.charAt(t+1)){case lI:let a;let o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case l_:i+=e.substring(s,t)+"\0";break;case lk:i+=e.substring(s,t+1);break;default:oT()}s=t+2}return new oK(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lN="remoteDocuments",lO="owner",lM="owner",lP="mutationQueues",lL="userId",lB="mutations",lF="batchId",lj="userMutationsIndex",lU=["userId","batchId"];function lV(e){return[e]}function lq(e,t){return[e,lD(t)]}function lz(e,t,n){return[e,lD(t),n]}let l$={},lG="documentMutations",lH="remoteDocumentsV14",lK=["prefixPath","collectionGroup","readTime","documentId"],lW="documentKeyIndex",lQ=["prefixPath","collectionGroup","documentId"],lY="collectionGroupIndex",lJ=["collectionGroup","readTime","prefixPath","documentId"],lX="remoteDocumentGlobal",lZ="remoteDocumentGlobalKey",l0="targets",l1="targetId",l2="queryTargetsIndex",l3=["canonicalId","targetId"],l4="targetDocuments",l6=["targetId","path"],l9="documentTargetsIndex",l5=["path","targetId"],l7="targetGlobalKey",l8="targetGlobal",ue="collectionParents",ut=["collectionId","parent"],un="clientMetadata",ur="clientId",ui="bundles",us="bundleId",ua="namedQueries",uo="name",ul="indexConfiguration",uu="indexId",uc="collectionGroupIndex",uh="collectionGroup",ud="indexState",uf=["indexId","uid"],up="sequenceNumberIndex",ug=["uid","sequenceNumber"],um="indexEntries",uy=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],uv="documentKeyIndex",ub=["indexId","uid","orderedDocumentKey"],uS="documentOverlays",uT=["userId","collectionPath","documentId"],uw="collectionPathOverlayIndex",uC=["userId","collectionPath","largestBatchId"],uE="collectionGroupOverlayIndex",uI=["userId","collectionGroup","largestBatchId"],u_=[lP,lB,lG,lN,l0,lO,l8,l4,un,lX,ue,ui,ua],uk=[...u_,uS],uD=[lP,lB,lG,lH,l0,lO,l8,l4,un,lX,ue,ui,ua,uS],uR=uD,uA=[...uR,ul,ud,um];function ux(e){return 15===e?uA:14===e?uR:13===e?uD:12===e?uk:11===e?u_:void oT()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uN extends lr{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function uO(e,t){let n=oC(e);return lu.getStore(n.simpleDbTransaction,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uM(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function uP(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function uL(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uB{constructor(e,t){this.comparator=e,this.root=t||uj.EMPTY}insert(e,t){return new uB(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,uj.BLACK,null,null))}remove(e){return new uB(this.comparator,this.root.remove(e,this.comparator).copy(null,null,uj.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new uF(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new uF(this.root,e,this.comparator,!1)}getReverseIterator(){return new uF(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new uF(this.root,e,this.comparator,!0)}}class uF{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class uj{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:uj.RED,this.left=null!=r?r:uj.EMPTY,this.right=null!=i?i:uj.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new uj(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return uj.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n;let r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return uj.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,uj.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,uj.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw oT();let e=this.left.check();if(e===this.right.check())return e+(this.isRed()?0:1);throw oT()}}uj.EMPTY=null,uj.RED=!0,uj.BLACK=!1;class uU{constructor(){this.size=0}get key(){throw oT()}get value(){throw oT()}get color(){throw oT()}get left(){throw oT()}get right(){throw oT()}copy(e,t,n,r,i){return this}insert(e,t,n){return new uj(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}uj.EMPTY=new uU;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uV{constructor(e){this.comparator=e,this.data=new uB(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new uq(this.data.getIterator())}getIteratorFrom(e){return new uq(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof uV)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new uV(this.comparator);return t.data=e,t}}class uq{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function uz(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=u$(s),l=u$(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=u$(a)):t?(i(o),o=u$(s)):(o=u$(s),l=u$(a))}}function u$(e){return e.hasNext()?e.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uG{constructor(e){this.fields=e,e.sort(oQ.comparator)}static empty(){return new uG([])}unionWith(e){let t=new uV(oQ.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new uG(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return oj(this.fields,e.fields,(e,t)=>e.isEqual(t))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uH(e){return Buffer.from(e,"base64").toString("binary")}function uK(e){return Buffer.from(e,"binary").toString("base64")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uW{constructor(e){this.binaryString=e}static fromBase64String(e){return new uW(uH(e))}static fromUint8Array(e){return new uW(uQ(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return uK(this.binaryString)}toUint8Array(){return uY(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return oF(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function uQ(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}function uY(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}uW.EMPTY_BYTE_STRING=new uW("");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uJ=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function uX(e){if(ow(!!e),"string"==typeof e){let t=0,n=uJ.exec(e);if(ow(!!n),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:uZ(e.seconds),nanos:uZ(e.nanos)}}function uZ(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function u0(e){return"string"==typeof e?uW.fromBase64String(e):uW.fromUint8Array(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let u1="server_timestamp",u2="__type__",u3="__previous_value__",u4="__local_write_time__";function u6(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[u2])||void 0===n?void 0:n.stringValue)===u1}function u9(e,t){let n={fields:{[u2]:{stringValue:u1},[u4]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&u6(t)&&(t=u5(t)),t&&(n.fields[u3]=t),{mapValue:n}}function u5(e){let t=e.mapValue.fields[u3];return u6(t)?u5(t):t}function u7(e){let t=uX(e.mapValue.fields[u4].timestampValue);return new oz(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u8{constructor(e,t,n,r,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}let ce="(default)";class ct{constructor(e,t){this.projectId=e,this.database=t||ce}static empty(){return new ct("","")}get isDefaultDatabase(){return this.database===ce}isEqual(e){return e instanceof ct&&e.projectId===this.projectId&&e.database===this.database}}function cn(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new oI(oE.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ct(e.options.projectId,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cr=-1;function ci(e){return null==e}function cs(e){return 0===e&&1/e==-1/0}function ca(e){return"number"==typeof e&&Number.isInteger(e)&&!cs(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let co="__max__",cl={mapValue:{fields:{__type__:{stringValue:co}}}},cu={nullValue:"NULL_VALUE"};function cc(e){if("nullValue"in e)return 0;if("booleanValue"in e)return 1;if("integerValue"in e||"doubleValue"in e)return 2;if("timestampValue"in e)return 3;if("stringValue"in e)return 5;if("bytesValue"in e)return 6;if("referenceValue"in e)return 7;else if("geoPointValue"in e)return 8;else if("arrayValue"in e)return 9;else if(!("mapValue"in e))return oT();else return u6(e)?4:cH(e)?9007199254740991:10}function ch(e,t){if(e===t)return!0;let n=cc(e);if(n!==cc(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return u7(e).isEqual(u7(t));case 3:return cd(e,t);case 5:return e.stringValue===t.stringValue;case 6:return cp(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return cf(e,t);case 2:return cg(e,t);case 9:return oj(e.arrayValue.values||[],t.arrayValue.values||[],ch);case 10:return cm(e,t);default:return oT()}}function cd(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=uX(e.timestampValue),r=uX(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}function cf(e,t){return uZ(e.geoPointValue.latitude)===uZ(t.geoPointValue.latitude)&&uZ(e.geoPointValue.longitude)===uZ(t.geoPointValue.longitude)}function cp(e,t){return u0(e.bytesValue).isEqual(u0(t.bytesValue))}function cg(e,t){if("integerValue"in e&&"integerValue"in t)return uZ(e.integerValue)===uZ(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=uZ(e.doubleValue),r=uZ(t.doubleValue);return n===r?cs(n)===cs(r):isNaN(n)&&isNaN(r)}return!1}function cm(e,t){let n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(uM(n)!==uM(r))return!1;for(let e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!ch(n[e],r[e])))return!1;return!0}function cy(e,t){return void 0!==(e.values||[]).find(e=>ch(e,t))}function cv(e,t){if(e===t)return 0;let n=cc(e),r=cc(t);if(n!==r)return oF(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return oF(e.booleanValue,t.booleanValue);case 2:return cb(e,t);case 3:return cS(e.timestampValue,t.timestampValue);case 4:return cS(u7(e),u7(t));case 5:return oF(e.stringValue,t.stringValue);case 6:return cC(e.bytesValue,t.bytesValue);case 7:return cT(e.referenceValue,t.referenceValue);case 8:return cw(e.geoPointValue,t.geoPointValue);case 9:return cE(e.arrayValue,t.arrayValue);case 10:return cI(e.mapValue,t.mapValue);default:throw oT()}}function cb(e,t){let n=uZ(e.integerValue||e.doubleValue),r=uZ(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}function cS(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return oF(e,t);let n=uX(e),r=uX(t),i=oF(n.seconds,r.seconds);return 0!==i?i:oF(n.nanos,r.nanos)}function cT(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=oF(n[e],r[e]);if(0!==t)return t}return oF(n.length,r.length)}function cw(e,t){let n=oF(uZ(e.latitude),uZ(t.latitude));return 0!==n?n:oF(uZ(e.longitude),uZ(t.longitude))}function cC(e,t){let n=u0(e),r=u0(t);return n.compareTo(r)}function cE(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=cv(n[e],r[e]);if(t)return t}return oF(n.length,r.length)}function cI(e,t){if(e===cl.mapValue&&t===cl.mapValue)return 0;if(e===cl.mapValue)return 1;if(t===cl.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=oF(r[e],s[e]);if(0!==t)return t;let a=cv(n[r[e]],i[s[e]]);if(0!==a)return a}return oF(r.length,s.length)}function c_(e){return ck(e)}function ck(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return cR(e.timestampValue);if("stringValue"in e)return e.stringValue;if("bytesValue"in e)return cD(e.bytesValue);else if("referenceValue"in e)return cx(e.referenceValue);else if("geoPointValue"in e)return cA(e.geoPointValue);else if("arrayValue"in e)return cO(e.arrayValue);else if("mapValue"in e)return cN(e.mapValue);else return oT()}function cD(e){return u0(e).toBase64()}function cR(e){let t=uX(e);return`time(${t.seconds},${t.nanos})`}function cA(e){return`geo(${e.latitude},${e.longitude})`}function cx(e){return oY.fromName(e).toString()}function cN(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${ck(e.fields[i])}`;return n+"}"}function cO(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=ck(r);return t+"]"}function cM(e){switch(cc(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=u5(e);return t?16+cM(t):16;case 5:return 2*e.stringValue.length;case 6:return u0(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return cL(e.arrayValue);case 10:return cP(e.mapValue);default:throw oT()}}function cP(e){let t=0;return uP(e.fields,(e,n)=>{t+=e.length+cM(n)}),t}function cL(e){return(e.values||[]).reduce((e,t)=>e+cM(t),0)}function cB(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function cF(e){return!!e&&"integerValue"in e}function cj(e){return!!e&&"doubleValue"in e}function cU(e){return cF(e)||cj(e)}function cV(e){return!!e&&"arrayValue"in e}function cq(e){return!!e&&"nullValue"in e}function cz(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function c$(e){return!!e&&"mapValue"in e}function cG(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return uP(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=cG(n)),t}{if(!e.arrayValue)return Object.assign({},e);let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=cG(e.arrayValue.values[n]);return t}}function cH(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===co}function cK(e){if("nullValue"in e)return cu;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};if("bytesValue"in e)return{bytesValue:""};if("referenceValue"in e)return cB(ct.empty(),oY.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if("mapValue"in e)return{mapValue:{}};else return oT()}function cW(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};if("bytesValue"in e)return cB(ct.empty(),oY.empty());if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return{mapValue:{}};else if("mapValue"in e)return cl;else return oT()}function cQ(e,t){let n=cv(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function cY(e,t){let n=cv(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cJ{constructor(e){this.value=e}static empty(){return new cJ({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!c$(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=cG(t)}setAll(e){let t=oQ.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=cG(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());c$(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ch(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];c$(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(uP(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new cJ(cG(this.value))}}function cX(e){let t=[];return uP(e.fields,(e,n)=>{let r=new oQ([e]);if(c$(n)){let e=cX(n.mapValue).fields;if(0===e.length)t.push(r);else for(let n of e)t.push(r.child(n))}else t.push(r)}),new uG(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cZ{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new cZ(e,0,o$.min(),o$.min(),o$.min(),cJ.empty(),0)}static newFoundDocument(e,t,n,r){return new cZ(e,1,t,o$.min(),n,r,0)}static newNoDocument(e,t){return new cZ(e,2,t,o$.min(),o$.min(),cJ.empty(),0)}static newUnknownDocument(e,t){return new cZ(e,3,t,o$.min(),o$.min(),cJ.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(o$.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=cJ.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=cJ.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=o$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof cZ&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new cZ(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function c0(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?cv(r,i):oT()}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c1{constructor(e,t){this.position=e,this.inclusive=t}}function c2(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?oY.comparator(oY.fromName(a.referenceValue),n.key):cv(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function c3(e,t,n){let r=c2(e,t,n);return e.inclusive?r>=0:r>0}function c4(e,t,n){let r=c2(e,t,n);return e.inclusive?r<=0:r<0}function c6(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ch(e.position[n],t.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c9{constructor(e,t="asc"){this.field=e,this.dir=t}}function c5(e){return e.field.canonicalString()+e.dir}function c7(e){return`${e.field.canonicalString()} (${e.dir})`}function c8(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he{}class ht extends he{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new hg(e,t,n):"array-contains"===t?new hb(e,n):"in"===t?new hS(e,n):"not-in"===t?new hT(e,n):"array-contains-any"===t?new hw(e,n):new ht(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new hm(e,n):new hy(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(cv(t,this.value)):null!==t&&cc(this.value)===cc(t)&&this.matchesComparison(cv(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return oT()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class hn extends he{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new hn(e,t)}matches(e){return hr(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function hr(e){return"and"===e.op}function hi(e){return"or"===e.op}function hs(e){return ha(e)&&hr(e)}function ha(e){for(let t of e.filters)if(t instanceof hn)return!1;return!0}function ho(e){if(e instanceof ht)return e.field.canonicalString()+e.op.toString()+c_(e.value);if(hs(e))return e.filters.map(e=>ho(e)).join(",");{let t=e.filters.map(e=>ho(e)).join(",");return`${e.op}(${t})`}}function hl(e,t){return e instanceof ht?hu(e,t):e instanceof hn?hc(e,t):void oT()}function hu(e,t){return t instanceof ht&&e.op===t.op&&e.field.isEqual(t.field)&&ch(e.value,t.value)}function hc(e,t){return t instanceof hn&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&hl(n,t.filters[r]),!0)}function hh(e,t){let n=e.filters.concat(t);return hn.create(n,e.op)}function hd(e){return e instanceof ht?hp(e):e instanceof hn?hf(e):"Filter"}function hf(e){return e.op.toString()+" {"+e.getFilters().map(hd).join(" ,")+"}"}function hp(e){return`${e.field.canonicalString()} ${e.op} ${c_(e.value)}`}class hg extends ht{constructor(e,t,n){super(e,t,n),this.key=oY.fromName(n.referenceValue)}matches(e){let t=oY.comparator(e.key,this.key);return this.matchesComparison(t)}}class hm extends ht{constructor(e,t){super(e,"in",t),this.keys=hv("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class hy extends ht{constructor(e,t){super(e,"not-in",t),this.keys=hv("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function hv(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>oY.fromName(e.referenceValue))}class hb extends ht{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return cV(t)&&cy(t.arrayValue,this.value)}}class hS extends ht{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&cy(this.value.arrayValue,t)}}class hT extends ht{constructor(e,t){super(e,"not-in",t)}matches(e){if(cy(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!cy(this.value.arrayValue,t)}}class hw extends ht{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!!cV(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>cy(this.value.arrayValue,e))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hC{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.memoizedCanonicalId=null}}function hE(e,t=null,n=[],r=[],i=null,s=null,a=null){return new hC(e,t,n,r,i,s,a)}function hI(e){let t=oC(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:"+t.filters.map(e=>ho(e)).join(",")+"|ob:"+t.orderBy.map(e=>c5(e)).join(","),ci(t.limit)||(e+="|l:"+t.limit),t.startAt&&(e+="|lb:"+(t.startAt.inclusive?"b:":"a:")+t.startAt.position.map(e=>c_(e)).join(",")),t.endAt&&(e+="|ub:"+(t.endAt.inclusive?"a:":"b:")+t.endAt.position.map(e=>c_(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function h_(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>hd(e)).join(", ")}]`),ci(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>c7(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+(e.startAt.inclusive?"b:":"a:")+e.startAt.position.map(e=>c_(e)).join(",")),e.endAt&&(t+=", endAt: "+(e.endAt.inclusive?"a:":"b:")+e.endAt.position.map(e=>c_(e)).join(",")),`Target(${t})`}function hk(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!c8(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!hl(e.filters[n],t.filters[n]))return!1;return!!(e.collectionGroup===t.collectionGroup&&e.path.isEqual(t.path)&&c6(e.startAt,t.startAt))&&c6(e.endAt,t.endAt)}function hD(e){return oY.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function hR(e,t){return e.filters.filter(e=>e instanceof ht&&e.field.isEqual(t))}function hA(e,t){let n=o0(t);if(void 0===n)return null;for(let t of hR(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function hx(e,t){let n=new Map;for(let r of o1(t))for(let t of hR(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}function hN(e,t){let n=[],r=!0;for(let i of o1(t)){let t=0===i.kind?hM(e,i.fieldPath,e.startAt):hP(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new c1(n,r)}function hO(e,t){let n=[],r=!0;for(let i of o1(t)){let t=0===i.kind?hP(e,i.fieldPath,e.endAt):hM(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new c1(n,r)}function hM(e,t,n){let r=cu,i=!0;for(let n of hR(e,t)){let e=cu,t=!0;switch(n.op){case"<":case"<=":e=cK(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=cu}0>cQ({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>cQ({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function hP(e,t,n){let r=cl,i=!0;for(let n of hR(e,t)){let e=cl,t=!0;switch(n.op){case">=":case">":e=cW(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=cl}cY({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];cY({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function hL(e){let t=new uV(oQ.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}function hB(e){return null!==e.limit}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hF{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function hj(e,t,n,r,i,s,a,o){return new hF(e,t,n,r,i,s,a,o)}function hU(e){return new hF(e)}function hV(e,t){return new hF(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function hq(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function hz(e){let t=new uV(oQ.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}function h$(e){return oY.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function hG(e){return null!==e.collectionGroup}function hH(e){let t=oC(e);if(null===t.memoizedNormalizedOrderBy){t.memoizedNormalizedOrderBy=[];let e=new Set;for(let n of t.explicitOrderBy)t.memoizedNormalizedOrderBy.push(n),e.add(n.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";hz(t).forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.memoizedNormalizedOrderBy.push(new c9(r,n))}),e.has(oQ.keyField().canonicalString())||t.memoizedNormalizedOrderBy.push(new c9(oQ.keyField(),n))}return t.memoizedNormalizedOrderBy}function hK(e){let t=oC(e);return t.memoizedTarget||(t.memoizedTarget=hQ(t,hH(e))),t.memoizedTarget}function hW(e){let t=oC(e);return t.memoizedAggregateTarget||(t.memoizedAggregateTarget=hQ(t,e.explicitOrderBy)),t.memoizedAggregateTarget}function hQ(e,t){if("F"===e.limitType)return hE(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new c9(e.field,t)});let n=e.endAt?new c1(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new c1(e.startAt.position,e.startAt.inclusive):null;return hE(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function hY(e,t){let n=e.filters.concat([t]);return new hF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function hJ(e,t){let n=e.explicitOrderBy.concat([t]);return new hF(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function hX(e,t,n){return new hF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function hZ(e,t){return new hF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function h0(e,t){return new hF(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function h1(e,t){return hk(hK(e),hK(t))&&e.limitType===t.limitType}function h2(e){return`${hI(hK(e))}|lt:${e.limitType}`}function h3(e){return`Query(target=${h_(hK(e))}; limitType=${e.limitType})`}function h4(e,t){return t.isFoundDocument()&&h6(e,t)&&h9(e,t)&&h5(e,t)&&h7(e,t)}function h6(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):oY.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}function h9(e,t){for(let n of hH(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}function h5(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}function h7(e,t){return(!e.startAt||!!c4(e.startAt,hH(e),t))&&(!e.endAt||!!c3(e.endAt,hH(e),t))}function h8(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function de(e){return(t,n)=>{let r=!1;for(let i of hH(e)){let e=dt(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function dt(e,t,n){let r=e.field.isKeyField()?oY.comparator(t.key,n.key):c0(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return oT()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r){this.inner[n]=[[e,t]],this.innerSize++;return}for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e)){r[n]=[e,t];return}r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){uP(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return uL(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dr=new uB(oY.comparator);function di(){return dr}let ds=new uB(oY.comparator);function da(...e){let t=ds;for(let n of e)t=t.insert(n.key,n);return t}function dl(){return dd()}function du(e){let t=ds;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function dc(){return dd()}function dh(){return dd()}function dd(){return new dn(e=>e.toString(),(e,t)=>e.isEqual(t))}let df=new uB(oY.comparator);function dp(){return df}let dg=new uV(oY.comparator);function dm(...e){let t=dg;for(let n of e)t=t.add(n);return t}let dy=new uV(oF);function dv(){return dy}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function db(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:cs(t)?"-0":t}}function dS(e){return{integerValue:""+e}}function dT(e,t){return ca(t)?dS(t):db(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dw{constructor(){this._=void 0}}function dC(e,t,n){return e instanceof dk?u9(n,t):e instanceof dD?dR(e,t):e instanceof dA?dx(e,t):dO(e,t)}function dE(e,t,n){return e instanceof dD?dR(e,t):e instanceof dA?dx(e,t):n}function dI(e,t){return e instanceof dN?cU(t)?t:{integerValue:0}:null}function d_(e,t){return e instanceof dD&&t instanceof dD||e instanceof dA&&t instanceof dA?oj(e.elements,t.elements,ch):e instanceof dN&&t instanceof dN?ch(e.operand,t.operand):e instanceof dk&&t instanceof dk}class dk extends dw{}class dD extends dw{constructor(e){super(),this.elements=e}}function dR(e,t){let n=dP(t);for(let t of e.elements)n.some(e=>ch(e,t))||n.push(t);return{arrayValue:{values:n}}}class dA extends dw{constructor(e){super(),this.elements=e}}function dx(e,t){let n=dP(t);for(let t of e.elements)n=n.filter(e=>!ch(e,t));return{arrayValue:{values:n}}}class dN extends dw{constructor(e,t){super(),this.serializer=e,this.operand=t}}function dO(e,t){let n=dI(e,t),r=dM(n)+dM(e.operand);return cF(n)&&cF(e.operand)?dS(r):db(e.serializer,r)}function dM(e){return uZ(e.integerValue||e.doubleValue)}function dP(e){return cV(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dL{constructor(e,t){this.field=e,this.transform=t}}function dB(e,t){return e.field.isEqual(t.field)&&d_(e.transform,t.transform)}function dF(e,t){return void 0===e&&void 0===t||!!e&&!!t&&oj(e,t,(e,t)=>dB(e,t))}class dj{constructor(e,t){this.version=e,this.transformResults=t}}class dU{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new dU}static exists(e){return new dU(void 0,e)}static updateTime(e){return new dU(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function dV(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class dq{}function dz(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new d3(e.key,dU.none()):new dW(e.key,e.data,dU.none());{let n=e.data,r=cJ.empty(),i=new uV(oQ.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new dJ(e.key,r,new uG(i.toArray()),dU.none())}}function d$(e,t,n){e instanceof dW?dQ(e,t,n):e instanceof dJ?dX(e,t,n):d4(e,t,n)}function dG(e,t,n,r){return e instanceof dW?dY(e,t,n,r):e instanceof dJ?dZ(e,t,n,r):d6(e,t,n)}function dH(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=dI(r.transform,e||null);null!=i&&(null===n&&(n=cJ.empty()),n.set(r.field,i))}return n||null}function dK(e,t){return!!(e.type===t.type&&e.key.isEqual(t.key)&&e.precondition.isEqual(t.precondition)&&dF(e.fieldTransforms,t.fieldTransforms))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class dW extends dq{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}function dQ(e,t,n){let r=e.value.clone(),i=d1(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}function dY(e,t,n,r){if(!dV(e.precondition,t))return n;let i=e.value.clone(),s=d2(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class dJ extends dq{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function dX(e,t,n){if(!dV(e.precondition,t)){t.convertToUnknownDocument(n.version);return}let r=d1(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(d0(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}function dZ(e,t,n,r){if(!dV(e.precondition,t))return n;let i=d2(e.fieldTransforms,r,t),s=t.data;return(s.setAll(d0(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function d0(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function d1(e,t,n){let r=new Map;ow(e.length===n.length);for(let i=0;i<n.length;i++){let s=e[i],a=s.transform,o=t.data.field(s.field);r.set(s.field,dE(a,o,n[i]))}return r}function d2(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,dC(e,s,t))}return r}class d3 extends dq{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function d4(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}function d6(e,t,n){return dV(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}class d9 extends dq{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d5{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&d$(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=dG(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=dG(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=dh();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=dz(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(o$.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),dm())}isEqual(e){return this.batchId===e.batchId&&oj(this.mutations,e.mutations,(e,t)=>dK(e,t))&&oj(this.baseMutations,e.baseMutations,(e,t)=>dK(e,t))}}class d7{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){ow(e.mutations.length===n.length);let r=dp(),i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new d7(e,t,n,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d8{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fe{constructor(e,t){this.count=e,this.unchangedNames=t}}function ft(e){switch(e){case oE.OK:return oT();case oE.CANCELLED:case oE.UNKNOWN:case oE.DEADLINE_EXCEEDED:case oE.RESOURCE_EXHAUSTED:case oE.INTERNAL:case oE.UNAVAILABLE:case oE.UNAUTHENTICATED:return!1;case oE.INVALID_ARGUMENT:case oE.NOT_FOUND:case oE.ALREADY_EXISTS:case oE.PERMISSION_DENIED:case oE.FAILED_PRECONDITION:case oE.ABORTED:case oE.OUT_OF_RANGE:case oE.UNIMPLEMENTED:case oE.DATA_LOSS:return!0;default:return oT()}}function fn(e){return ft(e)&&e!==oE.ABORTED}function fr(e){if(void 0===e)return ov("GRPC error has no .code"),oE.UNKNOWN;switch(e){case p.OK:return oE.OK;case p.CANCELLED:return oE.CANCELLED;case p.UNKNOWN:return oE.UNKNOWN;case p.DEADLINE_EXCEEDED:return oE.DEADLINE_EXCEEDED;case p.RESOURCE_EXHAUSTED:return oE.RESOURCE_EXHAUSTED;case p.INTERNAL:return oE.INTERNAL;case p.UNAVAILABLE:return oE.UNAVAILABLE;case p.UNAUTHENTICATED:return oE.UNAUTHENTICATED;case p.INVALID_ARGUMENT:return oE.INVALID_ARGUMENT;case p.NOT_FOUND:return oE.NOT_FOUND;case p.ALREADY_EXISTS:return oE.ALREADY_EXISTS;case p.PERMISSION_DENIED:return oE.PERMISSION_DENIED;case p.FAILED_PRECONDITION:return oE.FAILED_PRECONDITION;case p.ABORTED:return oE.ABORTED;case p.OUT_OF_RANGE:return oE.OUT_OF_RANGE;case p.UNIMPLEMENTED:return oE.UNIMPLEMENTED;case p.DATA_LOSS:return oE.DATA_LOSS;default:return oT()}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(p||(p={}));/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fs=null;function fa(e){if(fs)throw Error("a TestingHooksSpi instance is already set");fs=e}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fo(){return new rT.TextEncoder}function fl(){return new TextDecoder("utf-8")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fu=new ol([4294967295,4294967295],0);function fc(e){let t=fo().encode(e),n=new oo;return n.update(t),new Uint8Array(n.digest())}function fh(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new ol([n,r],0),new ol([i,s],0)]}class fd{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ff(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new ff(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new ff(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=ol.fromNumber(this.bitCount)}getBitIndex(e,t,n){let r=e.add(t.multiply(ol.fromNumber(n)));return 1===r.compare(fu)&&(r=new ol([r.getBits(0),r.getBits(1)],0)),r.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;let[t,n]=fh(fc(e));for(let e=0;e<this.hashCount;e++){let r=this.getBitIndex(t,n,e);if(!this.isBitSet(r))return!1}return!0}static create(e,t,n){let r=e%8==0?0:8-e%8,i=new fd(new Uint8Array(Math.ceil(e/8)),r,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;let[t,n]=fh(fc(e));for(let e=0;e<this.hashCount;e++){let r=this.getBitIndex(t,n,e);this.setBit(r)}}setBit(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class ff extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fp{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,fg.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new fp(o$.min(),r,new uB(oF),di(),dm())}}class fg{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new fg(n,t,dm(),dm(),dm())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm{constructor(e,t,n,r){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=n,this.newDoc=r}}class fy{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class fv{constructor(e,t,n=uW.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class fb{constructor(){this.pendingResponses=0,this.documentChanges=fC(),this._resumeToken=uW.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=dm(),t=dm(),n=dm();return this.documentChanges.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:oT()}}),new fg(this._resumeToken,this._current,e,t,n)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=fC()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let fS="WatchChangeAggregator";class fT{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=di(),this.pendingDocumentTargetMapping=fw(),this.pendingTargetResets=new uB(oF)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let n=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&n.updateResumeToken(e.resumeToken);break;case 1:n.recordTargetResponse(),n.isPending||n.clearPendingChanges(),n.updateResumeToken(e.resumeToken);break;case 2:n.recordTargetResponse(),n.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(n.markCurrent(),n.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),n.updateResumeToken(e.resumeToken));break;default:oT()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,n)=>{this.isActiveTarget(n)&&t(n)})}handleExistenceFilter(e){let t=e.targetId,n=e.existenceFilter.count,r=this.targetDataForActiveTarget(t);if(r){let i=r.target;if(hD(i)){if(0===n){let e=new oY(i.path);this.removeDocumentFromTarget(t,e,cZ.newNoDocument(e,o$.min()))}else ow(1===n)}else{let r=this.getCurrentDocumentCountForTarget(t);if(r!==n){let n=this.parseBloomFilter(e),i=n?this.applyBloomFilter(n,e,r):1;if(0!==i){this.resetTarget(t);let e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,e)}null==fs||fs.notifyOnExistenceFilterMismatch(fE(r,e.existenceFilter,this.metadataProvider.getDatabaseId(),n,i))}}}}parseBloomFilter(e){let t,n;let r=e.existenceFilter.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=u0(i).toUint8Array()}catch(e){if(e instanceof fi)return ob("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new fd(t,s,a)}catch(e){return e instanceof ff?ob("BloomFilter error: ",e):ob("Applying bloom filter failed: ",e),null}return 0===n.bitCount?null:n}applyBloomFilter(e,t,n){return t.existenceFilter.count===n-this.filterRemovedDocuments(e,t.targetId)?0:2}filterRemovedDocuments(e,t){let n=this.metadataProvider.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;!e.mightContain(s)&&(this.removeDocumentFromTarget(t,n,null),r++)}),r}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((n,r)=>{let i=this.targetDataForActiveTarget(r);if(i){if(n.current&&hD(i.target)){let t=new oY(i.target.path);null!==this.pendingDocumentUpdates.get(t)||this.targetContainsDocument(r,t)||this.removeDocumentFromTarget(r,t,cZ.newNoDocument(t,e))}n.hasPendingChanges&&(t.set(r,n.toTargetChange()),n.clearPendingChanges())}});let n=dm();this.pendingDocumentTargetMapping.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.pendingDocumentUpdates.forEach((t,n)=>n.setReadTime(e));let r=new fp(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,n);return this.pendingDocumentUpdates=di(),this.pendingDocumentTargetMapping=fw(),this.pendingTargetResets=new uB(oF),r}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let n=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,n){if(!this.isActiveTarget(e))return;let r=this.ensureTargetState(e);this.targetContainsDocument(e,t)?r.addDocumentChange(t,1):r.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,n))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new fb,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new uV(oF),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=null!==this.targetDataForActiveTarget(e);return t||oy(fS,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new fb),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function fw(){return new uB(oY.comparator)}function fC(){return new uB(oY.comparator)}function fE(e,t,n,r,i){var s,a,o,l,u,c;let h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===i,hashCount:null!==(s=null==d?void 0:d.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(l=null===(o=null===(a=null==d?void 0:d.bits)||void 0===a?void 0:a.bitmap)||void 0===o?void 0:o.length)&&void 0!==l?l:0,padding:null!==(c=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==c?c:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),h}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fI=(()=>{let e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),f_=(()=>{let e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),fk=(()=>{let e={};return e.and="AND",e.or="OR",e})();class fD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function fR(e){return new oI(void 0===e.code?oE.UNKNOWN:fr(e.code),e.message||"")}function fA(e,t){return e.useProto3Json||ci(t)?t:{value:t}}function fx(e){let t;return ci(t="object"==typeof e?e.value:e)?null:t}function fN(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{let e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),n=("000000000"+t.nanoseconds).slice(-9);return`${e}.${n}Z`}}function fO(e){let t=uX(e);return new oz(t.seconds,t.nanos)}function fM(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function fP(e,t){return e.useProto3Json?(ow(void 0===t||"string"==typeof t),uW.fromBase64String(t||"")):(ow(void 0===t||t instanceof Uint8Array),uW.fromUint8Array(t||new Uint8Array))}function fL(e,t){return fN(e,t.toTimestamp())}function fB(e){return ow(!!e),o$.fromTimestamp(fO(e))}function fF(e,t){return fG(e).child("documents").child(t).canonicalString()}function fj(e){let t=oK.fromString(e);return ow(pL(t)),t}function fU(e,t){return fF(e.databaseId,t.path)}function fV(e,t){let n=fj(t);if(n.get(1)!==e.databaseId.projectId)throw new oI(oE.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new oI(oE.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new oY(fH(n))}function fq(e,t){return fF(e.databaseId,t)}function fz(e){let t=fj(e);return 4===t.length?oK.emptyPath():fH(t)}function f$(e){return new oK(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function fG(e){return new oK(["projects",e.projectId,"databases",e.database])}function fH(e){return ow(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function fK(e,t,n){return{name:fU(e,t),fields:n.value.mapValue.fields}}function fW(e,t){return{name:fU(e,t.key),fields:t.data.value.mapValue.fields,updateTime:fN(e,t.version.toTimestamp()),createTime:fN(e,t.createTime.toTimestamp())}}function fQ(e,t,n){let r=fV(e,t.name),i=fB(t.updateTime),s=t.createTime?fB(t.createTime):o$.min(),a=new cJ({mapValue:{fields:t.fields}}),o=cZ.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function fY(e,t){ow(!!t.found),t.found.name,t.found.updateTime;let n=fV(e,t.found.name),r=fB(t.found.updateTime),i=t.found.createTime?fB(t.found.createTime):o$.min(),s=new cJ({mapValue:{fields:t.found.fields}});return cZ.newFoundDocument(n,r,i,s)}function fJ(e,t){ow(!!t.missing),ow(!!t.readTime);let n=fV(e,t.missing),r=fB(t.readTime);return cZ.newNoDocument(n,r)}function fX(e,t){return"found"in t?fY(e,t):"missing"in t?fJ(e,t):oT()}function fZ(e,t){let n;if("targetChange"in t){t.targetChange;let r=f0(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=fP(e,t.targetChange.resumeToken),a=t.targetChange.cause;n=new fv(r,i,s,a&&fR(a)||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=fV(e,r.document.name),s=fB(r.document.updateTime),a=r.document.createTime?fB(r.document.createTime):o$.min(),o=new cJ({mapValue:{fields:r.document.fields}}),l=cZ.newFoundDocument(i,s,a,o);n=new fm(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=fV(e,r.document),s=r.readTime?fB(r.readTime):o$.min(),a=cZ.newNoDocument(i,s);n=new fm([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=fV(e,r.document);n=new fm([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return oT();t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new fe(r,i);n=new fy(e.targetId,s)}return n}function f0(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:oT()}function f1(e){if(!("targetChange"in e))return o$.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?o$.min():fB(t.readTime)}function f2(e,t){let n;if(t instanceof dW)n={update:fK(e,t.key,t.value)};else if(t instanceof d3)n={delete:fU(e,t.key)};else if(t instanceof dJ)n={update:fK(e,t.key,t.data),updateMask:pM(t.fieldMask)};else{if(!(t instanceof d9))return oT();n={verify:fU(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(t=>f7(e,t))),t.precondition.isNone||(n.currentDocument=f4(e,t.precondition)),n}function f3(e,t){let n=t.currentDocument?f6(t.currentDocument):dU.none(),r=t.updateTransforms?t.updateTransforms.map(t=>f8(e,t)):[];if(t.update){t.update.name;let i=fV(e,t.update.name),s=new cJ({mapValue:{fields:t.update.fields}});return t.updateMask?new dJ(i,s,pP(t.updateMask),n,r):new dW(i,s,n,r)}return t.delete?new d3(fV(e,t.delete),n):t.verify?new d9(fV(e,t.verify),n):oT()}function f4(e,t){return void 0!==t.updateTime?{updateTime:fL(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:oT()}function f6(e){return void 0!==e.updateTime?dU.updateTime(fB(e.updateTime)):void 0!==e.exists?dU.exists(e.exists):dU.none()}function f9(e,t){let n=e.updateTime?fB(e.updateTime):fB(t);return n.isEqual(o$.min())&&(n=fB(t)),new dj(n,e.transformResults||[])}function f5(e,t){return e&&e.length>0?(ow(void 0!==t),e.map(e=>f9(e,t))):[]}function f7(e,t){let n=t.transform;if(n instanceof dk)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof dD)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof dA)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof dN)return{fieldPath:t.field.canonicalString(),increment:n.operand};throw oT()}function f8(e,t){let n=null;return"setToServerValue"in t?(ow("REQUEST_TIME"===t.setToServerValue),n=new dk):"appendMissingElements"in t?n=new dD(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new dA(t.removeAllFromArray.values||[]):"increment"in t?n=new dN(e,t.increment):oT(),new dL(oQ.fromServerFormat(t.fieldPath),n)}function pe(e,t){return{documents:[fq(e,t.path)]}}function pt(e){return ow(1===e.documents.length),hK(hU(fz(e.documents[0])))}function pn(e,t){let n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=fq(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=fq(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);let i=pu(t.filters);i&&(n.structuredQuery.where=i);let s=pd(t.orderBy);s&&(n.structuredQuery.orderBy=s);let a=fA(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=pp(t.startAt)),t.endAt&&(n.structuredQuery.endAt=pg(t.endAt)),n}function pr(e,t,n){let r=pn(e,t),i={},s=[],a=0;return n.forEach(e=>{let t=`aggregate_${a++}`;i[t]=e.alias,"count"===e.aggregateType?s.push({alias:t,count:{}}):"avg"===e.aggregateType?s.push({alias:t,avg:{field:pE(e.fieldPath)}}):"sum"===e.aggregateType&&s.push({alias:t,sum:{field:pE(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:s,structuredQuery:r.structuredQuery},parent:r.parent},aliasMap:i}}function pi(e){let t=fz(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){ow(1===r);let e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=pc(n.where));let a=[];n.orderBy&&(a=pf(n.orderBy));let o=null;n.limit&&(o=fx(n.limit));let l=null;n.startAt&&(l=pm(n.startAt));let u=null;return n.endAt&&(u=py(n.endAt)),hj(t,i,a,s,o,"F",l,u)}function ps(e){return hK(pi(e))}function pa(e,t){let n=po(t.purpose);return null==n?null:{"goog-listen-tags":n}}function po(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return oT()}}function pl(e,t){let n;let r=t.target;if((n=hD(r)?{documents:pe(e,r)}:{query:pn(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=fM(e,t.resumeToken);let r=fA(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(o$.min())>0){n.readTime=fN(e,t.snapshotVersion.toTimestamp());let r=fA(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}function pu(e){if(0!==e.length)return pD(hn.create(e,"and"))}function pc(e){let t=ph(e);return t instanceof hn&&hs(t)?t.getFilters():[t]}function ph(e){return void 0!==e.unaryFilter?px(e):void 0!==e.fieldFilter?pN(e):void 0!==e.compositeFilter?pO(e):oT()}function pd(e){if(0!==e.length)return e.map(e=>p_(e))}function pf(e){return e.map(e=>pk(e))}function pp(e){return{before:e.inclusive,values:e.position}}function pg(e){return{before:!e.inclusive,values:e.position}}function pm(e){let t=!!e.before;return new c1(e.values||[],t)}function py(e){let t=!e.before;return new c1(e.values||[],t)}function pv(e){return fI[e]}function pb(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function pS(e){return f_[e]}function pT(e){return fk[e]}function pw(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return oT()}}function pC(e){switch(e){case"AND":return"and";case"OR":return"or";default:return oT()}}function pE(e){return{fieldPath:e.canonicalString()}}function pI(e){return oQ.fromServerFormat(e.fieldPath)}function p_(e){return{field:pE(e.field),direction:pv(e.dir)}}function pk(e){return new c9(pI(e.field),pb(e.direction))}function pD(e){return e instanceof ht?pA(e):e instanceof hn?pR(e):oT()}function pR(e){let t=e.getFilters().map(e=>pD(e));return 1===t.length?t[0]:{compositeFilter:{op:pT(e.op),filters:t}}}function pA(e){if("=="===e.op){if(cz(e.value))return{unaryFilter:{field:pE(e.field),op:"IS_NAN"}};if(cq(e.value))return{unaryFilter:{field:pE(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(cz(e.value))return{unaryFilter:{field:pE(e.field),op:"IS_NOT_NAN"}};if(cq(e.value))return{unaryFilter:{field:pE(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:pE(e.field),op:pS(e.op),value:e.value}}}function px(e){switch(e.unaryFilter.op){case"IS_NAN":let t=pI(e.unaryFilter.field);return ht.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=pI(e.unaryFilter.field);return ht.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=pI(e.unaryFilter.field);return ht.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=pI(e.unaryFilter.field);return ht.create(i,"!=",{nullValue:"NULL_VALUE"});default:return oT()}}function pN(e){return ht.create(pI(e.fieldFilter.field),pw(e.fieldFilter.op),e.fieldFilter.value)}function pO(e){return hn.create(e.compositeFilter.filters.map(e=>ph(e)),pC(e.compositeFilter.op))}function pM(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function pP(e){return new uG((e.fieldPaths||[]).map(e=>oQ.fromServerFormat(e)))}function pL(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pB{constructor(e,t,n,r,i=o$.min(),s=o$.min(),a=uW.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new pB(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new pB(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new pB(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new pB(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pF{constructor(e){this.remoteSerializer=e}}function pj(e,t){let n;if(t.document)n=fQ(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=oY.fromSegments(t.noDocument.path),r=p$(t.noDocument.readTime);n=cZ.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return oT();let e=oY.fromSegments(t.unknownDocument.path),r=p$(t.unknownDocument.version);n=cZ.newUnknownDocument(e,r)}return t.readTime&&n.setReadTime(pq(t.readTime)),n}function pU(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:pV(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=fW(e.remoteSerializer,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:pz(t.version)};else{if(!t.isUnknownDocument())return oT();r.unknownDocument={path:n.path.toArray(),version:pz(t.version)}}return r}function pV(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function pq(e){let t=new oz(e[0],e[1]);return o$.fromTimestamp(t)}function pz(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function p$(e){let t=new oz(e.seconds,e.nanoseconds);return o$.fromTimestamp(t)}function pG(e,t,n){let r=n.baseMutations.map(t=>f2(e.remoteSerializer,t)),i=n.mutations.map(t=>f2(e.remoteSerializer,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function pH(e,t){let n=(t.baseMutations||[]).map(t=>f3(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){let r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}let r=t.mutations.map(t=>f3(e.remoteSerializer,t)),i=oz.fromMillis(t.localWriteTimeMs);return new d5(t.batchId,i,n,r)}function pK(e){let t;let n=p$(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?p$(e.lastLimboFreeSnapshotVersion):o$.min();return new pB(t=pQ(e.query)?pt(e.query):ps(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,uW.fromBase64String(e.resumeToken))}function pW(e,t){let n;let r=pz(t.snapshotVersion),i=pz(t.lastLimboFreeSnapshotVersion);n=hD(t.target)?pe(e.remoteSerializer,t.target):pn(e.remoteSerializer,t.target);let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:hI(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function pQ(e){return void 0!==e.documents}function pY(e){return{id:e.bundleId,createTime:p$(e.createTime),version:e.version}}function pJ(e){return{bundleId:e.id,createTime:pz(fB(e.createTime)),version:e.version}}function pX(e){return{name:e.name,query:p0(e.bundledQuery),readTime:p$(e.readTime)}}function pZ(e){return{name:e.name,readTime:pz(fB(e.readTime)),bundledQuery:e.bundledQuery}}function p0(e){let t=pi({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?hX(t,t.limit,"L"):t}function p1(e){return{name:e.name,query:p0(e.bundledQuery),readTime:fB(e.readTime)}}function p2(e){return{id:e.id,version:e.version,createTime:fB(e.createTime)}}function p3(e,t){return new d8(t.largestBatchId,f3(e.remoteSerializer,t.overlayMutation))}function p4(e,t,n){let[r,i,s]=p6(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:f2(e.remoteSerializer,n.mutation)}}function p6(e,t){let n=t.path.lastSegment();return[e,lD(t.path.popLast()),n]}function p9(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function p5(e,t){let n=t?new o5(t.sequenceNumber,new le(p$(t.readTime),new oY(lx(t.documentKey)),t.largestBatchId)):o5.empty(),r=e.fields.map(([e,t])=>new o6(oQ.fromServerFormat(e),t));return new oZ(e.indexId,e.collectionGroup,r,n)}function p7(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:pz(r.readTime),documentKey:lD(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p8{getBundleMetadata(e,t){return ge(e).get(t).next(e=>{if(e)return pY(e)})}saveBundleMetadata(e,t){return ge(e).put(pJ(t))}getNamedQuery(e,t){return gt(e).get(t).next(e=>{if(e)return pX(e)})}saveNamedQuery(e,t){return gt(e).put(pZ(t))}}function ge(e){return uO(e,ui)}function gt(e){return uO(e,ua)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new gn(e,t.uid||"")}getOverlay(e,t){return gr(e).get(p6(this.userId,t)).next(e=>e?p3(this.serializer,e):null)}getOverlays(e,t){let n=dc();return ls.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new d8(t,i);r.push(this.saveOverlay(e,s))}),ls.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(lD(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(gr(e).deleteAll(uw,r))}),ls.waitFor(i)}getOverlaysForCollection(e,t,n){let r=dc(),i=lD(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return gr(e).loadAll(uw,s).next(e=>{for(let t of e){let e=p3(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i;let s=dc(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return gr(e).iterate({index:uE,range:a},(e,t,n)=>{let a=p3(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}saveOverlay(e,t){return gr(e).put(p4(this.serializer,this.userId,t))}}function gr(e){return uO(e,uS)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gi=5,gs=10,ga=13,go=15,gl=20,gu=25,gc=30,gh=37,gd=45,gf=50,gp=55,gg=60,gm=2;class gy{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,gi);else if("booleanValue"in e)this.writeValueTypeLabel(t,gs),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,go),t.writeNumber(uZ(e.integerValue));else if("doubleValue"in e){let n=uZ(e.doubleValue);isNaN(n)?this.writeValueTypeLabel(t,ga):(this.writeValueTypeLabel(t,go),cs(n)?t.writeNumber(0):t.writeNumber(n))}else if("timestampValue"in e){let n=e.timestampValue;this.writeValueTypeLabel(t,gl),"string"==typeof n?t.writeString(n):(t.writeString(`${n.seconds||""}`),t.writeNumber(n.nanos||0))}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,gc),t.writeBytes(u0(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.writeValueTypeLabel(t,gd),t.writeNumber(n.latitude||0),t.writeNumber(n.longitude||0)}else"mapValue"in e?cH(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):oT()}writeIndexString(e,t){this.writeValueTypeLabel(t,gu),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let n=e.fields||{};for(let e of(this.writeValueTypeLabel(t,gp),Object.keys(n)))this.writeIndexString(e,t),this.writeIndexValueAux(n[e],t)}writeIndexArray(e,t){let n=e.values||[];for(let e of(this.writeValueTypeLabel(t,gf),n))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,gh),oY.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,gg),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(gm)}}gy.INSTANCE=new gy;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gv="\uD800",gb="\uDBFF",gS=0,gT=255,gw=1,gC=255,gE=255,gI=0,g_=64,gk=8,gD=1024;function gR(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function gA(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function gx(e){let t=0;for(let n=0;n<8;++n){let r=gA(255&e[n]);if(t+=r,8!==r)break}return t}function gN(e){return Math.ceil((g_-gx(e))/gk)}class gO{constructor(){this.buffer=new Uint8Array(gD),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.writeByteAscending(n.value),n=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.writeByteDescending(n.value),n=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<gv||gb<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{let e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<gv||gb<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{let e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),n=gN(t);this.ensureAvailable(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){let t=this.toOrderedBits(e),n=gN(t);this.ensureAvailable(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(gC),this.writeEscapedByteAscending(gE)}writeInfinityDescending(){this.writeEscapedByteDescending(gC),this.writeEscapedByteDescending(gE)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=gR(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}writeByteAscending(e){let t=255&e;t===gS?(this.writeEscapedByteAscending(gS),this.writeEscapedByteAscending(gT)):t===gC?(this.writeEscapedByteAscending(gC),this.writeEscapedByteAscending(gI)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=255&e;t===gS?(this.writeEscapedByteDescending(gS),this.writeEscapedByteDescending(gT)):t===gC?(this.writeEscapedByteDescending(gC),this.writeEscapedByteDescending(gI)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(gS),this.writeEscapedByteAscending(gw)}writeSeparatorDescending(){this.writeEscapedByteDescending(gS),this.writeEscapedByteDescending(gw)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class gM{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class gP{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class gL{constructor(){this.orderedCode=new gO,this.ascending=new gM(this.orderedCode),this.descending=new gP(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gB{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}successor(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new gB(this.indexId,this.documentKey,this.arrayValue,n)}}function gF(e,t){let n=e.indexId-t.indexId;return 0!==n||0!==(n=gj(e.arrayValue,t.arrayValue))||0!==(n=gj(e.directionalValue,t.directionalValue))?n:oY.comparator(e.documentKey,t.documentKey)}function gj(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gU{constructor(e){for(let t of(this.inequalityFilters=new uV((e,t)=>oQ.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){let e=t;e.isInequality()?this.inequalityFilters=this.inequalityFilters.add(e):this.equalityFilters.push(e)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(ow(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=o0(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let n=o1(e),r=new Set,i=0,s=0;for(;i<n.length;++i)if(this.hasMatchingEqualityFilter(n[i]))r=r.add(n[i].fieldPath.canonicalString());else break;if(i===n.length)return!0;if(this.inequalityFilters.size>0){let e=this.inequalityFilters.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.matchesFilter(e,t)||!this.matchesOrderBy(this.orderBys[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new uV(oQ.comparator),t=[];for(let n of this.equalityFilters)if(!n.field.isKeyField()){if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new o6(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new o6(n.field,0))}}for(let n of this.orderBys)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new o6(n.field,"asc"===n.dir?0:1)));return new oZ(oZ.UNKNOWN_ID,this.collectionId,t,o5.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gV(e){var t,n;if(ow(e instanceof ht||e instanceof hn),e instanceof ht){if(!(e instanceof hS))return e;{let r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map(t=>ht.create(e.field,"==",t)))||[];return hn.create(r,"or")}}let r=e.filters.map(e=>gV(e));return hn.create(r,e.op)}function gq(e){if(0===e.getFilters().length)return[];let t=gK(gV(e));return(ow(gG(t)),gz(t)||g$(t))?[t]:t.getFilters()}function gz(e){return e instanceof ht}function g$(e){return e instanceof hn&&hs(e)}function gG(e){return gz(e)||g$(e)||gH(e)}function gH(e){if(e instanceof hn&&hi(e)){for(let t of e.getFilters())if(!gz(t)&&!g$(t))return!1;return!0}return!1}function gK(e){if(ow(e instanceof ht||e instanceof hn),e instanceof ht)return e;if(1===e.filters.length)return gK(e.filters[0]);let t=e.filters.map(e=>gK(e)),n=hn.create(t,e.op);return gG(n=gX(n))?n:(ow(n instanceof hn),ow(hr(n)),ow(n.filters.length>1),n.filters.reduce((e,t)=>gW(e,t)))}function gW(e,t){let n;return ow(e instanceof ht||e instanceof hn),ow(t instanceof ht||t instanceof hn),gX(n=e instanceof ht?t instanceof ht?gQ(e,t):gJ(e,t):t instanceof ht?gJ(t,e):gY(e,t))}function gQ(e,t){return hn.create([e,t],"and")}function gY(e,t){if(ow(e.filters.length>0&&t.filters.length>0),hr(e)&&hr(t))return hh(e,t.getFilters());let n=hi(e)?e:t,r=hi(e)?t:e,i=n.filters.map(e=>gW(e,r));return hn.create(i,"or")}function gJ(e,t){if(hr(t))return hh(t,e.getFilters());{let n=t.filters.map(t=>gW(e,t));return hn.create(n,"or")}}function gX(e){if(ow(e instanceof ht||e instanceof hn),e instanceof ht)return e;let t=e.getFilters();if(1===t.length)return gX(t[0]);if(ha(e))return e;let n=t.map(e=>gX(e)),r=[];return(n.forEach(t=>{t instanceof ht?r.push(t):t instanceof hn&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length)?r[0]:hn.create(r,e.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gZ{constructor(){this.collectionParentIndex=new g0}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),ls.resolve()}getCollectionParents(e,t){return ls.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return ls.resolve()}deleteFieldIndex(e,t){return ls.resolve()}deleteAllFieldIndexes(e){return ls.resolve()}createTargetIndexes(e,t){return ls.resolve()}getDocumentsMatchingTarget(e,t){return ls.resolve(null)}getIndexType(e,t){return ls.resolve(0)}getFieldIndexes(e,t){return ls.resolve([])}getNextCollectionGroupToUpdate(e){return ls.resolve(null)}getMinOffset(e,t){return ls.resolve(le.min())}getMinOffsetFromCollectionGroup(e,t){return ls.resolve(le.min())}updateCollectionGroup(e,t,n){return ls.resolve()}updateIndexEntries(e,t){return ls.resolve()}}class g0{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new uV(oK.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new uV(oK.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let g1="IndexedDbIndexManager",g2=new Uint8Array(0);class g3{constructor(e,t){this.user=e,this.databaseId=t,this.collectionParentsCache=new g0,this.targetToDnfSubTargets=new dn(e=>hI(e),(e,t)=>hk(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let i={collectionId:n,parent:lD(r)};return g4(e).put(i)}return ls.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[oU(t),""],!1,!0);return g4(e).loadAll(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(lx(r.parent))}return n})}addFieldIndex(e,t){let n=g9(e),r=p9(t);delete r.indexId;let i=n.add(r);if(!t.indexState)return i.next();{let n=g5(e);return i.next(e=>{n.put(p7(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){let n=g9(e),r=g5(e),i=g6(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=g9(e),n=g6(e),r=g5(e);return t.deleteAll().next(()=>n.deleteAll()).next(()=>r.deleteAll())}createTargetIndexes(e,t){return ls.forEach(this.getSubTargets(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new gU(t).buildTargetIndex();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=g6(e),r=!0,i=new Map;return ls.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(!r)return ls.resolve(null);{let e=dm(),r=[];return ls.forEach(i,(i,s)=>{oy(g1,`Using index ${o4(i)} to execute ${hI(t)}`);let a=hA(s,i),o=hx(s,i),l=hN(s,i),u=hO(s,i),c=this.encodeBound(i,s,l),h=this.encodeBound(i,s,u),d=this.encodeValues(i,s,o),f=this.generateIndexRanges(i.indexId,a,c,l.inclusive,h,u.inclusive,d);return ls.forEach(f,i=>n.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{let n=oY.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:gq(hn.create(e.filters,"and")).map(t=>hE(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let c=0;c<o;++c){let o=t?this.encodeSingleElement(t[c/l]):g2,h=this.generateLowerBound(e,o,n[c%l],r),d=this.generateUpperBound(e,o,i[c%l],s),f=a.map(t=>this.generateLowerBound(e,o,t,!0));u.push(...this.createRange(h,d,f))}return u}generateLowerBound(e,t,n,r){let i=new gB(e,oY.empty(),t,n);return r?i:i.successor()}generateUpperBound(e,t,n,r){let i=new gB(e,oY.empty(),t,n);return r?i.successor():i}getFieldIndex(e,t){let n=new gU(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.servedByIndex(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.getSubTargets(t);return ls.forEach(r,t=>this.getFieldIndex(e,t).next(e=>{e?0!==n&&e.fields.length<hL(t)&&(n=1):n=0})).next(()=>hB(t)&&r.length>1&&2===n?1:n)}encodeDirectionalElements(e,t){let n=new gL;for(let r of o1(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.forKind(r.kind);gy.INSTANCE.writeIndexValue(e,i)}return n.encodedBytes()}encodeSingleElement(e){let t=new gL;return gy.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let n=new gL;return gy.INSTANCE.writeIndexValue(cB(this.databaseId,t),n.forKind(o2(e))),n.encodedBytes()}encodeValues(e,t,n){if(null===n)return[];let r=[];r.push(new gL);let i=0;for(let s of o1(e)){let e=n[i++];for(let n of r)if(this.isInFilter(t,s.fieldPath)&&cV(e))r=this.expandIndexValues(r,s,e);else{let t=n.forKind(s.kind);gy.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(r)}encodeBound(e,t,n){return this.encodeValues(e,t,n.position)}getEncodedBytes(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].encodedBytes();return t}expandIndexValues(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new gL;r.seed(n.encodedBytes()),gy.INSTANCE.writeIndexValue(e,r.forKind(t.kind)),i.push(r)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof ht&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=g9(e),r=g5(e);return(t?n.loadAll(uc,IDBKeyRange.bound(t,t)):n.loadAll()).next(e=>{let t=[];return ls.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(p5(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:oF(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=g9(e),i=g5(e);return this.getNextSequenceNumber(e).next(e=>r.loadAll(uc,IDBKeyRange.bound(t,t)).next(t=>ls.forEach(t,t=>i.put(p7(t.indexId,this.user,e,n)))))}updateIndexEntries(e,t){let n=new Map;return ls.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?ls.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),ls.forEach(i,n=>this.getExistingIndexEntries(e,t,n).next(t=>{let i=this.computeIndexEntries(r,n);return t.isEqual(i)?ls.resolve():this.updateEntries(e,r,n,t,i)}))))})}addIndexEntry(e,t,n,r){return g6(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(n,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,n,r){return g6(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.encodeDirectionalKey(n,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,n){let r=g6(e),i=new uV(gF);return r.iterate({index:uv,range:IDBKeyRange.only([n.indexId,this.uid,this.encodeDirectionalKey(n,t)])},(e,r)=>{i=i.add(new gB(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}computeIndexEntries(e,t){let n=new uV(gF),r=this.encodeDirectionalElements(t,e);if(null==r)return n;let i=o0(t);if(null!=i){let s=e.data.field(i.fieldPath);if(cV(s))for(let i of s.arrayValue.values||[])n=n.add(new gB(t.indexId,e.key,this.encodeSingleElement(i),r))}else n=n.add(new gB(t.indexId,e.key,g2,r));return n}updateEntries(e,t,n,r,i){oy(g1,"Updating index entries for document '%s'",t.key);let s=[];return uz(r,i,gF,r=>{s.push(this.addIndexEntry(e,t,n,r))},r=>{s.push(this.deleteIndexEntry(e,t,n,r))}),ls.waitFor(s)}getNextSequenceNumber(e){let t=1;return g5(e).iterate({index:up,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>gF(e,t)).filter((e,t,n)=>!t||0!==gF(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=gF(i,e),s=gF(i,t);if(0===n)r[0]=e.successor();else if(n>0&&s<0)r.push(i),r.push(i.successor());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.isRangeMatchable(r[e],r[e+1]))return[];let t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,g2,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,g2,[]];i.push(IDBKeyRange.bound(t,n))}return i}isRangeMatchable(e,t){return gF(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(g7)}getMinOffset(e,t){return ls.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||oT())).next(g7)}}function g4(e){return uO(e,ue)}function g6(e){return uO(e,um)}function g9(e){return uO(e,ul)}function g5(e){return uO(e,ud)}function g7(e){ow(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>lt(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new le(t.readTime,t.documentKey,n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g8(e,t,n){let r=e.store(lB),i=e.store(lG),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.iterate({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{ow(1===o)}));let u=[];for(let e of n.mutations){let r=lz(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return ls.waitFor(s).next(()=>u)}function me(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw oT();return JSON.stringify(t).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}static forUser(e,t,n,r){return ow(""!==e.uid),new mt(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mi(e).iterate({index:lj,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=ms(e),s=mi(e);return s.add({}).next(a=>{ow("number"==typeof a);let o=new d5(a,t,n,r),l=pG(this.serializer,this.userId,o),u=[],c=new uV((e,t)=>oF(e.canonicalString(),t.canonicalString()));for(let e of r){let t=lz(this.userId,e.key.path,a);c=c.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,l$))}return c.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=o.keys()}),ls.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return mi(e).get(t).next(e=>e?(ow(e.userId===this.userId),pH(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?ls.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{let n=e.keys();return this.documentKeysByBatchId[t]=n,n}})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return mi(e).iterate({index:lj,range:r},(e,t,r)=>{t.userId===this.userId&&(ow(t.batchId>=n),i=pH(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=cr;return mi(e).iterate({index:lj,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,cr],[this.userId,Number.POSITIVE_INFINITY]);return mi(e).loadAll(lj,t).next(e=>e.map(e=>pH(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=lq(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return ms(e).iterate({range:r},(n,r,s)=>{let[a,o,l]=n,u=lx(o);if(a!==this.userId||!t.path.isEqual(u)){s.done();return}return mi(e).get(l).next(e=>{if(!e)throw oT();ow(e.userId===this.userId),i.push(pH(this.serializer,e))})}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new uV(oF),r=[];return t.forEach(t=>{let i=lq(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=ms(e).iterate({range:s},(e,r,i)=>{let[s,a,o]=e,l=lx(a);if(s!==this.userId||!t.path.isEqual(l)){i.done();return}n=n.add(o)});r.push(a)}),ls.waitFor(r).next(()=>this.lookupMutationBatches(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=lq(this.userId,n),s=IDBKeyRange.lowerBound(i),a=new uV(oF);return ms(e).iterate({range:s},(e,t,i)=>{let[s,o,l]=e,u=lx(o);if(s!==this.userId||!n.isPrefixOf(u)){i.done();return}u.length===r&&(a=a.add(l))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let n=[],r=[];return t.forEach(t=>{r.push(mi(e).get(t).next(e=>{if(null===e)throw oT();ow(e.userId===this.userId),n.push(pH(this.serializer,e))}))}),ls.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return g8(e.simpleDbTransaction,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),ls.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return ls.resolve();let n=IDBKeyRange.lowerBound(lV(this.userId)),r=[];return ms(e).iterate({range:n},(e,t,n)=>{if(e[0]!==this.userId){n.done();return}{let t=lx(e[1]);r.push(t)}}).next(()=>{ow(0===r.length)})})}containsKey(e,t){return mn(e,this.userId,t)}getMutationQueueMetadata(e){return ma(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:cr,lastStreamToken:""})}}function mn(e,t,n){let r=lq(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return ms(e).iterate({range:s,keysOnly:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function mr(e,t){let n=!1;return ma(e).iterateSerial(r=>mn(e,r,t).next(e=>(e&&(n=!0),ls.resolve(!e)))).next(()=>n)}function mi(e){return uO(e,lB)}function ms(e){return uO(e,lG)}function ma(e){return uO(e,lP)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mo=2;class ml{constructor(e){this.lastId=e}next(){return this.lastId+=mo,this.lastId}static forTargetCache(){return new ml(2-mo)}static forSyncEngine(){return new ml(1-mo)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mu{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let n=new ml(t.highestTargetId);return t.highestTargetId=n.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>o$.fromTimestamp(new oz(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.retrieveMetadata(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.saveMetadata(e,r)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(n=>(n.targetCount+=1,this.updateMetadataFromTargetData(t,n),this.saveMetadata(e,n))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>mc(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(ow(t.targetCount>0),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,n){let r=0,i=[];return mc(e).iterate((s,a)=>{let o=pK(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>ls.waitFor(i)).next(()=>r)}forEachTarget(e,t){return mc(e).iterate((e,n)=>{t(pK(n))})}retrieveMetadata(e){return mh(e).get(l7).next(e=>(ow(null!==e),e))}saveMetadata(e,t){return mh(e).put(l7,t)}saveTargetData(e,t){return mc(e).put(pW(this.serializer,t))}updateMetadataFromTargetData(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let n=hI(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return mc(e).iterate({range:r,index:l2},(e,n,r)=>{let s=pK(n);hk(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=md(e);return t.forEach(t=>{let s=lD(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),ls.waitFor(r)}removeMatchingKeys(e,t,n){let r=md(e);return ls.forEach(t,t=>{let i=lD(t.path);return ls.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=md(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=md(e),i=dm();return r.iterate({range:n,keysOnly:!0},(e,t,n)=>{let r=new oY(lx(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=lD(t.path),r=IDBKeyRange.bound([n],[oU(n)],!1,!0),i=0;return md(e).iterate({index:l9,keysOnly:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return mc(e).get(t).next(e=>e?pK(e):null)}}function mc(e){return uO(e,l0)}function mh(e){return uO(e,l8)}function md(e){return uO(e,l4)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},mp=-1,mg=41943040;class mm{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new mm(e,mm.DEFAULT_COLLECTION_PERCENTILE,mm.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}mm.DEFAULT_COLLECTION_PERCENTILE=10,mm.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,mm.DEFAULT=new mm(mg,mm.DEFAULT_COLLECTION_PERCENTILE,mm.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),mm.DISABLED=new mm(mp,0,0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let my="LruGarbageCollector",mv=1048576,mb=6e4,mS=3e5;function mT([e,t],[n,r]){let i=oF(e,n);return 0===i?oF(t,r):i}class mw{constructor(e){this.maxElements=e,this.buffer=new uV(mT),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>mT(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class mC{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==mp&&this.scheduleGC(mb)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){oy(my,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ld(e)?oy(my,"Ignoring IndexedDB error during garbage collection: ",e):await li(e)}await this.scheduleGC(mS)})}}class mE{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ls.resolve(lC.INVALID);let n=new mw(t);return this.delegate.forEachTarget(e,e=>n.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>n.addElement(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.delegate.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===mp?(oy("LruGarbageCollector","Garbage collection skipped; disabled"),ls.resolve(mf)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(oy("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),mf):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let n,r,i,s,a,o,l;let u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(oy("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),om()<=rb.DEBUG&&oy("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in ${a-s}ms
	Removed ${i} targets in ${o-a}ms
	Removed ${e} documents in ${l-o}ms
Total Duration: ${l-u}ms`),ls.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}function mI(e,t){return new mE(e,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m_{constructor(e,t){this.db=e,this.garbageCollector=mI(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,n)=>t(n))}addReference(e,t,n){return mR(e,n)}removeReference(e,t,n){return mR(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return mR(e,t)}isPinned(e,t){return mr(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.forEachOrphanedDocument(e,(s,a)=>{if(a<=t){let t=this.isPinned(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,o$.min()),md(e).delete(mk(s))))});r.push(t)}}).next(()=>ls.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return mR(e,t)}forEachOrphanedDocument(e,t){let n;let r=md(e),i=lC.INVALID;return r.iterate({index:l9},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==lC.INVALID&&t(new oY(lx(n)),i),i=a,n=s):i=lC.INVALID}).next(()=>{i!==lC.INVALID&&t(new oY(lx(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function mk(e){return[0,lD(e.path)]}function mD(e,t){return{targetId:0,path:lD(e.path),sequenceNumber:t}}function mR(e,t){return md(e).put(mD(t,e.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mA{constructor(){this.changes=new dn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,cZ.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?ls.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mx{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return mP(e).put(n)}removeEntry(e,t,n){return mP(e).delete(mB(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.setMetadata(e,n)))}getEntry(e,t){let n=cZ.newInvalidDocument(t);return mP(e).iterate({index:lW,range:IDBKeyRange.only(mL(t))},(e,r)=>{n=this.maybeDecodeDocument(t,r)}).next(()=>n)}getSizedEntry(e,t){let n={size:0,document:cZ.newInvalidDocument(t)};return mP(e).iterate({index:lW,range:IDBKeyRange.only(mL(t))},(e,r)=>{n={document:this.maybeDecodeDocument(t,r),size:me(r)}}).next(()=>n)}getEntries(e,t){let n=di();return this.forEachDbEntry(e,t,(e,t)=>{let r=this.maybeDecodeDocument(e,t);n=n.insert(e,r)}).next(()=>n)}getSizedEntries(e,t){let n=di(),r=new uB(oY.comparator);return this.forEachDbEntry(e,t,(e,t)=>{let i=this.maybeDecodeDocument(e,t);n=n.insert(e,i),r=r.insert(e,me(t))}).next(()=>({documents:n,sizeMap:r}))}forEachDbEntry(e,t,n){if(t.isEmpty())return ls.resolve();let r=new uV(mj);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(mL(r.first()),mL(r.last())),s=r.getIterator(),a=s.getNext();return mP(e).iterate({index:lW,range:i},(e,t,r)=>{let i=oY.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>mj(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.skip(mL(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),pV(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return mP(e).loadAll(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=di();for(let i of e){let e=this.maybeDecodeDocument(oY.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(h4(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=di(),s=mF(t,n),a=mF(t,le.max());return mP(e).iterate({index:lY,range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.maybeDecodeDocument(oY.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new mO(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return mM(e).get(lZ).next(e=>(ow(!!e),e))}setMetadata(e,t){return mM(e).put(lZ,t)}maybeDecodeDocument(e,t){if(t){let e=pj(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(o$.min())))return e}return cZ.newInvalidDocument(e)}}function mN(e){return new mx(e)}class mO extends mA{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new dn(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new uV((e,t)=>oF(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=pU(this.documentCache.serializer,s);r=r.add(i.path.popLast());let l=me(o);n+=l-a.size,t.push(this.documentCache.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=pU(this.documentCache.serializer,s.convertToNoDocument(o$.min()));t.push(this.documentCache.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.documentCache.updateMetadata(e,n)),ls.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,n)=>{this.documentStates.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function mM(e){return uO(e,lX)}function mP(e){return uO(e,lH)}function mL(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function mB(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],pV(t),n[n.length-1]]}function mF(e,t){let n=t.documentKey.path.toArray();return[e,pV(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function mj(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=oF(n[e],r[e]))return i;return(i=oF(n.length,r.length))||(i=oF(n[n.length-2],r[r.length-2]))?i:oF(n[n.length-1],r[r.length-1])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mU=15;/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mV{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mq{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&dG(n.mutation,e,uG.empty(),oz.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,dm()).next(()=>t))}getLocalViewOfDocuments(e,t,n=dm()){let r=dc();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=da();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=dc();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,dm()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=di(),s=dd(),a=dl();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof dJ)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),dG(a.mutation,t,a.mutation.getFieldMask(),oz.now())):s.set(t.key,uG.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new mV(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=dd(),r=new uB((e,t)=>e-t),i=dm();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||uG.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||dm()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=dh();l.forEach(e=>{if(!i.has(e)){let r=dz(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return ls.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return h$(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):hG(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ls.resolve(dc()),a=oJ,o=i;return s.next(t=>ls.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t))?ls.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,dm())).next(e=>({batchId:a,changes:du(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new oY(t)).next(e=>{let t=da();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=da();return this.indexManager.getCollectionParents(e,i).next(a=>ls.forEach(a,a=>{let o=hV(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,cZ.newInvalidDocument(r)))});let n=da();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&dG(s.mutation,r,uG.empty(),oz.now()),h4(t,r)&&(n=n.insert(e,r))}),n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mz{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return ls.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,p2(t)),ls.resolve()}getNamedQuery(e,t){return ls.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,p1(t)),ls.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m${constructor(){this.overlays=new uB(oY.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return ls.resolve(this.overlays.get(t))}getOverlays(e,t){let n=dc();return ls.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.saveOverlay(e,t,r)}),ls.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.overlayByBatchId.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(n)),ls.resolve()}getOverlaysForCollection(e,t,n){let r=dc(),i=t.length+1,s=new oY(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ls.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new uB((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=dc(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=dc(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return ls.resolve(a)}saveOverlay(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.overlayByBatchId.get(r.largestBatchId).delete(n.key);this.overlayByBatchId.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new d8(t,n));let i=this.overlayByBatchId.get(t);void 0===i&&(i=dm(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(n.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mG{constructor(){this.refsByKey=new uV(mH.compareByKey),this.refsByTarget=new uV(mH.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let n=new mH(e,t);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new mH(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){let t=new oY(new oK([])),n=new mH(t,e),r=new mH(t,e+1),i=[];return this.refsByTarget.forEachInRange([n,r],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new oY(new oK([])),n=new mH(t,e),r=new mH(t,e+1),i=dm();return this.refsByTarget.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new mH(e,0),n=this.refsByKey.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class mH{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return oY.comparator(e.key,t.key)||oF(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return oF(e.targetOrBatchId,t.targetOrBatchId)||oY.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mK{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new uV(mH.compareByKey)}checkEmpty(e){return ls.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new d5(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new mH(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ls.resolve(s)}lookupMutationBatch(e,t){return ls.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=this.indexOfBatchId(n),i=r<0?0:r;return ls.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ls.resolve(0===this.mutationQueue.length?cr:this.nextBatchId-1)}getAllMutationBatches(e){return ls.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new mH(t,0),r=new mH(t,Number.POSITIVE_INFINITY),i=[];return this.batchesByDocumentKey.forEachInRange([n,r],e=>{let t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),ls.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new uV(oF);return t.forEach(e=>{let t=new mH(e,0),r=new mH(e,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([t,r],e=>{n=n.add(e.targetOrBatchId)})}),ls.resolve(this.findMutationBatches(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;oY.isDocumentKey(i)||(i=i.child(""));let s=new mH(new oY(i),0),a=new uV(oF);return this.batchesByDocumentKey.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.targetOrBatchId)),!0)},s),ls.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(e=>{let n=this.findMutationBatch(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){ow(0===this.indexOfExistingBatchId(t.batchId,"removed")),this.mutationQueue.shift();let n=this.batchesByDocumentKey;return ls.forEach(t.mutations,r=>{let i=new mH(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.batchesByDocumentKey=n})}removeCachedMutationKeys(e){}containsKey(e,t){let n=new mH(t,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return ls.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ls.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mW(){return new uB(oY.comparator)}class mQ{constructor(e){this.sizer=e,this.docs=mW(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.sizer(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return ls.resolve(n?n.document.mutableCopy():cZ.newInvalidDocument(t))}getEntries(e,t){let n=di();return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():cZ.newInvalidDocument(e))}),ls.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=di(),s=t.path,a=new oY(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=lt(o8(a),n))&&(r.has(a.key)||h4(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return ls.resolve(i)}getAllFromCollectionGroup(e,t,n,r){oT()}forEachDocumentKey(e,t){return ls.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new mJ(this)}getSize(e){return ls.resolve(this.size)}}function mY(e){return new mQ(e)}class mJ extends mA{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.documentCache.addEntry(e,r)):this.documentCache.removeEntry(n)}),ls.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mX{constructor(e){this.persistence=e,this.targets=new dn(e=>hI(e),hk),this.lastRemoteSnapshotVersion=o$.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new mG,this.targetCount=0,this.targetIdGenerator=ml.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,n)=>t(n)),ls.resolve()}getLastRemoteSnapshotVersion(e){return ls.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ls.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),ls.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),ls.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new ml(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,ls.resolve()}updateTargetData(e,t){return this.saveTargetData(t),ls.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,ls.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.targets.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),ls.waitFor(i).next(()=>r)}getTargetCount(e){return ls.resolve(this.targetCount)}getTargetData(e,t){let n=this.targets.get(t)||null;return ls.resolve(n)}addMatchingKeys(e,t,n){return this.references.addReferences(t,n),ls.resolve()}removeMatchingKeys(e,t,n){this.references.removeReferences(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),ls.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),ls.resolve()}getMatchingKeysForTargetId(e,t){let n=this.references.referencesForId(t);return ls.resolve(n)}containsKey(e,t){return ls.resolve(this.references.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mZ="MemoryPersistence";class m0{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new lC(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new mX(this);let n=e=>this.referenceDelegate.documentSize(e);this.indexManager=new gZ,this.remoteDocumentCache=mY(n),this.serializer=new pF(t),this.bundleCache=new mz(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new m$,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.mutationQueues[e.toKey()];return n||(n=new mK(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=n),n}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,n){oy(mZ,"Starting transaction:",e);let r=new m1(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(r).next(e=>this.referenceDelegate.onTransactionCommitted(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return ls.or(Object.values(this.mutationQueues).map(n=>()=>n.containsKey(e,t)))}}class m1 extends lr{constructor(e){super(),this.currentSequenceNumber=e}}class m2{constructor(e){this.persistence=e,this.localViewReferences=new mG,this._orphanedDocuments=null}static factory(e){return new m2(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw oT()}addReference(e,t,n){return this.localViewReferences.addReference(n,t),this.orphanedDocuments.delete(n.toString()),ls.resolve()}removeReference(e,t,n){return this.localViewReferences.removeReference(n,t),this.orphanedDocuments.add(n.toString()),ls.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),ls.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ls.forEach(this.orphanedDocuments,n=>{let r=oY.fromPath(n);return this.isReferenced(e,r).next(e=>{e||t.removeEntry(r,o$.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return ls.or([()=>ls.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class m3{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new dn(e=>lD(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=mI(this,t)}static factory(e,t){return new m3(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return ls.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return ls.forEach(this.orphanedSequenceNumbers,(n,r)=>this.isPinned(e,n,r).next(e=>e?ls.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.forEachDocumentKey(e,r=>this.isPinned(e,r,t).next(e=>{e||(n++,i.removeEntry(r,o$.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),ls.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.orphanedSequenceNumbers.set(n,e.currentSequenceNumber),ls.resolve()}removeReference(e,t,n){return this.orphanedSequenceNumbers.set(n,e.currentSequenceNumber),ls.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),ls.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=cM(e.data.value)),t}isPinned(e,t,n){return ls.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.orphanedSequenceNumbers.get(t);return ls.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m4{constructor(e){this.serializer=e}createOrUpgrade(e,t,n,r){let i=new ll("createOrUpgrade",t);n<1&&r>=1&&(m9(e),m5(e),yn(e),m8(e));let s=ls.resolve();return n<3&&r>=3&&(0!==n&&(yr(e),yn(e)),s=s.next(()=>ys(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>m7(e,i))),s=s.next(()=>{ya(e)})),n<5&&r>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),n<6&&r>=6&&(s=s.next(()=>(yt(e),this.addDocumentGlobal(i)))),n<7&&r>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),n<8&&r>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),n<9&&r>=9&&(s=s.next(()=>{yi(e)})),n<10&&r>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),n<11&&r>=11&&(s=s.next(()=>{yo(e),yl(e)})),n<12&&r>=12&&(s=s.next(()=>{yc(e)})),n<13&&r>=13&&(s=s.next(()=>ye(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(lN))),n<14&&r>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),n<15&&r>=15&&(s=s.next(()=>yu(e))),s}addDocumentGlobal(e){let t=0;return e.store(lN).iterate((e,n)=>{t+=me(n)}).next(()=>{let n={byteSize:t};return e.store(lX).put(lZ,n)})}removeAcknowledgedMutations(e){let t=e.store(lP),n=e.store(lB);return t.loadAll().next(t=>ls.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,cr],[t.userId,t.lastAcknowledgedBatchId]);return n.loadAll(lj,r).next(n=>ls.forEach(n,n=>{ow(n.userId===t.userId);let r=pH(this.serializer,n);return g8(e,t.userId,r).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(l4),n=e.store(lN);return e.store(l8).get(l7).next(e=>{let r=n=>t.put({targetId:0,path:lD(n),sequenceNumber:e.highestListenSequenceNumber}),i=[];return n.iterate((e,n)=>{let s=new oK(e),a=m6(s);i.push(t.get(a).next(e=>e?ls.resolve():r(s)))}).next(()=>ls.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(ue,{keyPath:ut});let n=t.store(ue),r=new g0,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:lD(r)})}};return t.store(lN).iterate({keysOnly:!0},(e,t)=>i(new oK(e).popLast())).next(()=>t.store(lG).iterate({keysOnly:!0},([e,t,n],r)=>i(lx(t).popLast())))}rewriteCanonicalIds(e){let t=e.store(l0);return t.iterate((e,n)=>{let r=pK(n),i=pW(this.serializer,r);return t.put(i)})}rewriteRemoteDocumentCache(e,t){let n=t.store(lN),r=[];return n.iterate((e,n)=>{let i=t.store(lH),s=yh(n).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>ls.waitFor(r))}runOverlayMigration(e,t){let n=t.store(lB),r=mN(this.serializer),i=new m0(m2.factory,this.serializer.remoteSerializer);return n.loadAll().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:dm();pH(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),ls.forEach(n,(e,n)=>{let s=new oh(n),a=gn.forUser(this.serializer,s),o=i.getIndexManager(s);return new mq(r,mt.forUser(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new uN(t,lC.INVALID),e).next()})})}}function m6(e){return[0,lD(e)]}function m9(e){e.createObjectStore(lO)}function m5(e){e.createObjectStore(lP,{keyPath:lL}),e.createObjectStore(lB,{keyPath:lF,autoIncrement:!0}).createIndex(lj,lU,{unique:!0}),e.createObjectStore(lG)}function m7(e,t){return t.store(lB).loadAll().next(n=>{e.deleteObjectStore(lB),e.createObjectStore(lB,{keyPath:lF,autoIncrement:!0}).createIndex(lj,lU,{unique:!0});let r=t.store(lB),i=n.map(e=>r.put(e));return ls.waitFor(i)})}function m8(e){e.createObjectStore(lN)}function ye(e){let t=e.createObjectStore(lH,{keyPath:lK});t.createIndex(lW,lQ),t.createIndex(lY,lJ)}function yt(e){e.createObjectStore(lX)}function yn(e){e.createObjectStore(l4,{keyPath:l6}).createIndex(l9,l5,{unique:!0}),e.createObjectStore(l0,{keyPath:l1}).createIndex(l2,l3,{unique:!0}),e.createObjectStore(l8)}function yr(e){e.deleteObjectStore(l4),e.deleteObjectStore(l0),e.deleteObjectStore(l8)}function yi(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function ys(e){let t=e.store(l8),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:o$.min().toTimestamp(),targetCount:0};return t.put(l7,n)}function ya(e){e.createObjectStore(un,{keyPath:ur})}function yo(e){e.createObjectStore(ui,{keyPath:us})}function yl(e){e.createObjectStore(ua,{keyPath:uo})}function yu(e){e.createObjectStore(ul,{keyPath:uu,autoIncrement:!0}).createIndex(uc,uh,{unique:!1}),e.createObjectStore(ud,{keyPath:uf}).createIndex(up,ug,{unique:!1}),e.createObjectStore(um,{keyPath:uy}).createIndex(uv,ub,{unique:!1})}function yc(e){let t=e.createObjectStore(uS,{keyPath:uT});t.createIndex(uw,uC,{unique:!1}),t.createIndex(uE,uI,{unique:!1})}function yh(e){return e.document?new oY(oK.fromString(e.document.name).popFirst(5)):e.noDocument?oY.fromSegments(e.noDocument.path):e.unknownDocument?oY.fromSegments(e.unknownDocument.path):oT()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yd="IndexedDbPersistence",yf=18e5,yp=5e3,yg=4e3,ym="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",yy="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",yv="firestore_zombie",yb="main";class yS{constructor(e,t,n,r,i,s,a,o,l,u,c=mU){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.queue=i,this.window=s,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=u,this.schemaVersion=c,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=e=>Promise.resolve(),!yS.isAvailable())throw new oI(oE.UNIMPLEMENTED,yy);this.referenceDelegate=new m_(this,r),this.dbName=t+yb,this.serializer=new pF(o),this.simpleDb=new lu(this.dbName,this.schemaVersion,new m4(this.serializer)),this.targetCache=new mu(this.referenceDelegate,this.serializer),this.remoteDocumentCache=mN(this.serializer),this.bundleCache=new p8,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===u&&ov(yd,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new oI(oE.FAILED_PRECONDITION,ym);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new lC(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>yw(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(ld(e))return oy(yd,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return oy(yd,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return yT(e).get(lM).next(e=>ls.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return yw(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,yf)){this.lastGarbageCollectionTime=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=uO(e,un);return t.loadAll().next(e=>{let n=this.filterActiveClients(e,yf),r=e.filter(e=>-1===n.indexOf(e));return ls.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",yg,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?ls.resolve(!0):yT(e).get(lM).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,yp)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new oI(oE.FAILED_PRECONDITION,ym);return!1}}return!!this.networkEnabled&&!!this.inForeground||yw(e).loadAll().next(e=>void 0===this.filterActiveClients(e,yp).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&oy(yd,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[lO,un],e=>{let t=new uN(e,lC.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>yw(e).loadAll().next(e=>this.filterActiveClients(e,yf).map(e=>e.clientId)))}get started(){return this._started}getMutationQueue(e,t){return mt.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new g3(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return gn.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,n){let r;oy(yd,"Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=ux(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(r=new uN(i,this.listenSequence?this.listenSequence.next():lC.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(r).next(e=>!!e||this.canActAsPrimary(r)).next(t=>{if(!t)throw ov(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new oI(oE.FAILED_PRECONDITION,ln);return n(r)}).next(e=>this.acquireOrExtendPrimaryLease(r).next(()=>e)):this.verifyAllowTabSynchronization(r).next(()=>n(r))).then(e=>(r.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return yT(e).get(lM).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,yp)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new oI(oE.FAILED_PRECONDITION,ym)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return yT(e).put(lM,t)}static isAvailable(){return lu.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=yT(e);return t.get(lM).next(e=>this.isLocalClient(e)?(oy(yd,"Releasing primary lease."),t.delete(lM)):ls.resolve())}isWithinAge(e,t){let n=Date.now(),r=n-t,i=n;return!(e<r)&&(!(e>i)||(ov(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.windowUnloadHandler=()=>{this.markClientZombied();let e=/(?:Version|Mobile)\/1[456]/;H()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let n=(null===(t=this.webStorage)||void 0===t?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return oy(yd,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return ov(yd,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){ov("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${yv}_${this.persistenceKey}_${e}`}}function yT(e){return uO(e,lO)}function yw(e){return uO(e,un)}function yC(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yE(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=n(e[l],t[o]);s<0?i(e[l++]):s>0?r(t[o++]):(o++,l++)}for(;o<a;)r(t[o++]);for(;l<s;)i(e[l++])}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yI="LocalStore",y_=3e8;class yk{constructor(e,t,n,r){this.persistence=e,this.queryEngine=t,this.serializer=r,this.targetDataByTarget=new uB(oF),this.targetIdByTarget=new dn(e=>hI(e),hk),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(n)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mq(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function yD(e,t,n,r){return new yk(e,t,n,r)}async function yR(e,t){let n=oC(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.initializeUserComponents(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=dm();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return n.localDocuments.getDocuments(e,a).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function yA(e,t){let n,r;let i=oC(e),s=oz.now(),a=t.reduce((e,t)=>e.add(t.key),dm());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=di(),l=dm();return i.remoteDocuments.getEntries(e,a).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,o)).next(r=>{n=r;let a=[];for(let e of t){let t=dH(e,n.get(e.key).overlayedDocument);null!=t&&a.push(new dJ(e.key,t,cX(t.value.mapValue),dU.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{r=t;let s=t.applyToLocalDocumentSet(n,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:r.batchId,changes:du(n)}))}function yx(e,t){let n=oC(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.remoteDocuments.newChangeBuffer({trackRemovals:!0});return yH(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,yN(t))).next(()=>n.localDocuments.getDocuments(e,r))})}function yN(e){let t=dm();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}function yO(e,t){let n=oC(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(ow(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}function yM(e){let t=oC(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}function yP(e){let t=oC(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function yL(e,t){let n=oC(e),r=t.snapshotVersion,i=n.targetDataByTarget;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=n.targetDataByTarget;let a=[];t.targetChanges.forEach((s,o)=>{let l=i.get(o);if(!l)return;a.push(n.targetCache.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.targetCache.addMatchingKeys(e,s.addedDocuments,o)));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?u=u.withResumeToken(uW.EMPTY_BYTE_STRING,o$.min()).withLastLimboFreeSnapshotVersion(o$.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(o,u),yF(l,u,s)&&a.push(n.targetCache.updateTargetData(e,u))});let o=di(),l=dm();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(yB(e,s,t.documentUpdates).next(e=>{o=e.changedDocuments,l=e.existenceChangedKeys})),!r.isEqual(o$.min())){let t=n.targetCache.getLastRemoteSnapshotVersion(e).next(t=>n.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return ls.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.targetDataByTarget=i,e))}function yB(e,t,n){let r=dm(),i=dm();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=di();return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(o$.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):oy(yI,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{changedDocuments:r,existenceChangedKeys:i}})}function yF(e,t,n){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=y_)||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}async function yj(e,t){let n=oC(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>ls.forEach(t,t=>ls.forEach(t.addedKeys,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>ls.forEach(t.removedKeys,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(ld(e))oy(yI,"Failed to update sequence numbers: "+e);else throw e}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=n.targetDataByTarget.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.targetDataByTarget=n.targetDataByTarget.insert(t,i)}}}function yU(e,t){let n=oC(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=cr),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function yV(e,t){let n=oC(e);return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}function yq(e,t){let n=oC(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.targetCache.getTargetData(e,t).next(i=>i?(r=i,ls.resolve(r)):n.targetCache.allocateTargetId(e).next(i=>(r=new pB(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.targetCache.addTargetData(e,r).next(()=>r))))}).then(e=>{let r=n.targetDataByTarget.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.targetDataByTarget=n.targetDataByTarget.insert(e.targetId,e),n.targetIdByTarget.set(t,e.targetId)),e})}function yz(e,t,n){let r=oC(e),i=r.targetIdByTarget.get(n);return void 0!==i?ls.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(t,n)}async function y$(e,t,n){let r=oC(e),i=r.targetDataByTarget.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(ld(e))oy(yI,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}r.targetDataByTarget=r.targetDataByTarget.remove(t),r.targetIdByTarget.delete(i.target)}function yG(e,t,n){let r=oC(e),i=o$.min(),s=dm();return r.persistence.runTransaction("Execute query","readwrite",e=>yz(r,e,hK(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(e,t,n?i:o$.min(),n?s:dm())).next(e=>(yX(r,h8(t),e),{documents:e,remoteKeys:s})))}function yH(e,t,n,r){let i=n.batch,s=i.keys(),a=ls.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);ow(null!==s),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function yK(e,t){let n=oC(e),r=oC(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",e=>r.lookupMutationKeys(e,t).next(t=>t?n.localDocuments.getDocuments(e,t):ls.resolve(null)))}function yW(e,t){oC(oC(e,yk).mutationQueue).removeCachedMutationKeys(t)}function yQ(e){return oC(oC(e,yk).persistence).getActiveClients()}function yY(e,t){let n=oC(e),r=oC(n.targetCache),i=n.targetDataByTarget.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function yJ(e,t){let n=oC(e),r=n.collectionGroupReadTime.get(t)||o$.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.remoteDocuments.getAllFromCollectionGroup(e,t,o7(r,oJ),Number.MAX_SAFE_INTEGER)).then(e=>(yX(n,t,e),e))}function yX(e,t,n){let r=e.collectionGroupReadTime.get(t)||o$.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.collectionGroupReadTime.set(t,r)}function yZ(e){return hK(hU(oK.fromString(`__bundle__/docs/${e}`)))}async function y0(e,t,n,r){let i=oC(e),s=dm(),a=di();for(let e of n){let n=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(n));let r=t.toMutableDocument(e);r.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),a=a.insert(n,r)}let o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await yq(i,yZ(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>yB(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function y1(e,t){let n=oC(e),r=fB(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(r)>=0)}function y2(e,t){let n=oC(e);return n.persistence.runTransaction("Save bundle","readwrite",e=>n.bundleCache.saveBundleMetadata(e,t))}async function y3(e,t,n=dm()){let r=await yq(e,hK(p0(t.bundledQuery))),i=oC(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=fB(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);let a=r.withResumeToken(uW.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(a.targetId,a),i.targetCache.updateTargetData(e,a).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,r.targetId)).next(()=>i.targetCache.addMatchingKeys(e,n,r.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}function y4(e,t){oC(e).queryEngine.indexAutoCreationEnabled=t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y6{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let y9=100,y5=8;class y7{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=y9,this.relativeIndexReadCostPerDocument=y5}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.performQueryUsingIndex(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.performQueryUsingRemoteKeys(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new y6;return this.executeFullCollectionScan(e,t,n).next(r=>{if(i.result=r,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,n,r.size)})}).next(()=>i.result)}createCacheIndexes(e,t,n,r){return n.documentReadCount<this.indexAutoCreationMinCollectionSize?(om()<=rb.DEBUG&&oy("QueryEngine","SDK will not create cache indexes for query:",h3(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),ls.resolve()):(om()<=rb.DEBUG&&oy("QueryEngine","Query:",h3(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.relativeIndexReadCostPerDocument*r)?(om()<=rb.DEBUG&&oy("QueryEngine","The SDK decides to create cache indexes for query:",h3(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,hK(t))):ls.resolve()}performQueryUsingIndex(e,t){if(hq(t))return ls.resolve(null);let n=hK(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=hK(t=hX(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=dm(...r);return this.localDocumentsView.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.applyQuery(t,r);return this.needsRefill(t,s,i,n.readTime)?this.performQueryUsingIndex(e,hX(t,null,"F")):this.appendRemainingResults(e,s,t,n)}))})))}performQueryUsingRemoteKeys(e,t,n,r){return hq(t)||r.isEqual(o$.min())?ls.resolve(null):this.localDocumentsView.getDocuments(e,n).next(i=>{let s=this.applyQuery(t,i);return this.needsRefill(t,s,n,r)?ls.resolve(null):(om()<=rb.DEBUG&&oy("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),h3(t)),this.appendRemainingResults(e,s,t,o7(r,oJ)).next(e=>e))})}applyQuery(e,t){let n=new uV(de(e));return t.forEach((t,r)=>{h4(e,r)&&(n=n.add(r))}),n}needsRefill(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}executeFullCollectionScan(e,t,n){return om()<=rb.DEBUG&&oy("QueryEngine","Using full collection scan to execute query:",h3(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,le.min(),n)}appendRemainingResults(e,t,n,r){return this.localDocumentsView.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let y8="firestore_clients";function ve(e,t){return`${y8}_${e}_${t}`}let vt="firestore_mutations";function vn(e,t,n){let r=`${vt}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}let vr="firestore_targets";function vi(e,t){return`${vr}_${e}_${t}`}let vs="firestore_online_state";function va(e){return`${vs}_${e}`}let vo="firestore_bundle_loaded_v2";function vl(e){return`${vo}_${e}`}let vu="firestore_sequence_number";function vc(e){return`${vu}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vh="SharedClientState";class vd{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static fromWebStorageEntry(e,t,n){let r;let i=JSON.parse(n),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new oI(i.error.code,i.error.message)),s)?new vd(e,t,i.state,r):(ov(vh,`Failed to parse mutation state for ID '${t}': ${n}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class vf{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static fromWebStorageEntry(e,t){let n;let r=JSON.parse(t),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return(i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new oI(r.error.code,r.error.message)),i)?new vf(e,r.state,n):(ov(vh,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class vp{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=dv();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=ca(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new vp(e,i):(ov(vh,`Failed to parse client data for instance '${e}': ${t}`),null)}}class vg{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new vg(t.clientId,t.onlineState):(ov(vh,`Failed to parse online state: ${e}`),null)}}class vm{constructor(){this.activeTargetIds=dv()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class vy{constructor(e,t,n,r,i){this.window=e,this.queue=t,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new uB(oF),this.started=!1,this.earlyEvents=[];let s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=ve(this.persistenceKey,this.localClientId),this.sequenceNumberKey=vc(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new vm),this.clientStateKeyRe=RegExp(`^${y8}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${vt}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${vr}_${s}_(\\d+)$`),this.onlineStateKey=va(this.persistenceKey),this.bundleLoadedKey=vl(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(let e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;let t=this.getItem(ve(this.persistenceKey,e));if(t){let n=vp.fromWebStorageEntry(e,t);n&&(this.activeClients=this.activeClients.insert(n.clientId,n))}}this.persistClientState();let e=this.storage.getItem(this.onlineStateKey);if(e){let t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(let e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,n){this.persistMutationState(e,t,n),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(vi(this.persistenceKey,e));if(n){let r=vf.fromWebStorageEntry(e,n);r&&(t=r.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(vi(this.persistenceKey,e))}updateQueryState(e,t,n){this.persistQueryTargetState(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return oy(vh,"READ",e,t),t}setItem(e,t){oy(vh,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){oy(vh,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(oy(vh,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){ov("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(async()=>{if(!this.started){this.earlyEvents.push(t);return}if(null!==t.key){if(this.clientStateKeyRe.test(t.key)){if(null!=t.newValue){let e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{let e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){let e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){let e=vv(t.newValue);e!==lC.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){let e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,n){let r=new vd(this.currentUser,e,t,n),i=vn(this.persistenceKey,this.currentUser,e);this.setItem(i,r.toWebStorageJSON())}removeMutationState(e){let t=vn(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,n){let r=vi(this.persistenceKey,e),i=new vf(e,t,n);this.setItem(r,i.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let n=this.fromWebStorageClientStateKey(e);return vp.fromWebStorageEntry(n,t)}fromWebStorageMutationMetadata(e,t){let n=this.mutationBatchKeyRe.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return vd.fromWebStorageEntry(new oh(i),r,t)}fromWebStorageQueryTargetMetadata(e,t){let n=Number(this.queryTargetKeyRe.exec(e)[1]);return vf.fromWebStorageEntry(n,t)}fromWebStorageOnlineState(e){return vg.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){if(e.user.uid!==this.currentUser.uid){oy(vh,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let n=t?this.activeClients.insert(e,t):this.activeClients.remove(e),r=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.applyActiveTargetsChange(s,a).then(()=>{this.activeClients=n})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=dv();return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}function vv(e){let t=lC.INVALID;if(null!=e)try{let n=JSON.parse(e);ow("number"==typeof n),t=n}catch(e){ov(vh,"Failed to read sequence number from WebStorage",e)}return t}class vb{constructor(){this.localState=new vm,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,n){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new vm,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS{addCallback(e){}shutdown(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vT{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vw=null;function vC(){return 268435456+Math.round(2147483648*Math.random())}function vE(){return null===vw?vw=vC():vw++,"0x"+vw.toString(16)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vI(e){return new Promise((t,n)=>{e((e,r)=>{e?n(e):t(r)})})}let v_="GrpcConnection",vk=null;function vD(e,t,n,r){ow(null===t||"OAuth"===t.type);let i=new grpc.Metadata;return t&&t.headers.forEach((e,t)=>i.set(t,e)),n&&n.headers.forEach((e,t)=>i.set(t,e)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",vk),i.set("Google-Cloud-Resource-Prefix",e),i.set("x-goog-request-params",e),i}class vR{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){oy(v_,"Creating Firestore stub.");let e=this.databaseInfo.ssl?grpc.credentials.createSsl():grpc.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,n,r,i){let s=vE(),a=this.ensureActiveStub(),o=vD(this.databasePath,r,i,this.databaseInfo.appId),l=Object.assign({database:this.databasePath},n);return vI(t=>(oy(v_,`RPC '${e}' ${s} invoked with request:`,n),a[e](l,o,(n,r)=>{n?(oy(v_,`RPC '${e}' ${s} failed with error:`,n),t(new oI(fr(n.code),n.message))):(oy(v_,`RPC '${e}' ${s} completed with response:`,r),t(void 0,r))})))}invokeStreamingRPC(e,t,n,r,i,s){let a=vE(),o=[],l=new o_;oy(v_,`RPC '${e}' ${a} invoked (streaming) with request:`,n);let u=this.ensureActiveStub(),c=vD(this.databasePath,r,i,this.databaseInfo.appId),h=Object.assign(Object.assign({},n),{database:this.databasePath}),d=u[e](h,c),f=!1;return d.on("data",t=>{oy(v_,`RPC ${e} ${a} received result:`,t),o.push(t),void 0!==s&&o.length===s&&(f=!0,l.resolve(o))}),d.on("end",()=>{oy(v_,`RPC '${e}' ${a} completed.`),f||(f=!0,l.resolve(o))}),d.on("error",t=>{oy(v_,`RPC '${e}' ${a} failed with error:`,t);let n=fr(t.code);l.reject(new oI(n,t.message))}),l.promise}openStream(e,t,n){let r=vE(),i=this.ensureActiveStub(),s=vD(this.databasePath,t,n,this.databaseInfo.appId),a=i[e](s),o=!1,l=e=>{o||(o=!0,u.callOnClose(e),a.end())},u=new vT({sendFn:t=>{if(o)oy(v_,`RPC '${e}' stream ${r} not sending because gRPC stream is closed:`,t);else{oy(v_,`RPC '${e}' stream ${r} sending:`,t);try{a.write(t)}catch(e){throw ov("Failure sending:",t),ov("Error:",e),e}}},closeFn:()=>{oy(v_,`RPC '${e}' stream ${r} closed locally via close().`),l()}});return a.on("data",t=>{o||(oy(v_,`RPC '${e}' stream ${r} received:`,t),u.callOnMessage(t))}),a.on("end",()=>{oy(v_,`RPC '${e}' stream ${r} ended.`),l()}),a.on("error",t=>{o||(ob(v_,`RPC '${e}' stream ${r} error. Code:`,t.code,"Message:",t.message),l(new oI(fr(t.code),t.message)))}),oy(v_,`Opening RPC '${e}' stream ${r} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}}let vA={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var vx={nested:vA},vN=Object.freeze({__proto__:null,nested:vA,default:vx});/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vO={longs:String,enums:String,defaults:!0,oneofs:!1};function vM(){let e=protoLoader.fromJSON(vN,vO);return grpc.loadPackageDefinition(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vP(e){return new vR(vM(),e)}function vL(){return new vS}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vB(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function vF(){return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vj(e){return new fD(e,!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vU="ExponentialBackoff",vV=1e3,vq=1.5,vz=6e4;class v${constructor(e,t,n=vV,r=vq,i=vz){this.queue=e,this.timerId=t,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),n=Math.max(0,Date.now()-this.lastAttemptTime),r=Math.max(0,t-n);r>0&&oy(vU,`Backing off for ${r} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,r,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vG="PersistentStream",vH=6e4,vK=1e4;class vW{constructor(e,t,n,r,i,s,a,o){this.queue=e,this.idleTimerId=n,this.healthTimerId=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new v$(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){if(4===this.state){this.performBackoff();return}this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,vH,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===oE.RESOURCE_EXHAUSTED?(ov(t.toString()),ov("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===oE.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.closeCount===t&&this.startStream(e,n)},t=>{e(()=>{let e=new oI(oE.UNKNOWN,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){let n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onOpen(()=>{n(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,vK,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{n(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return oy(vG,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(oy(vG,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class vQ extends vW{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=fZ(this.serializer,e),n=f1(e);return this.listener.onWatchChange(t,n)}watch(e){let t={};t.database=f$(this.serializer),t.addTarget=pl(this.serializer,e);let n=pa(this.serializer,e);n&&(t.labels=n),this.sendRequest(t)}unwatch(e){let t={};t.database=f$(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class vY extends vW{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(ow(!!e.streamToken),this.lastStreamToken=e.streamToken,!this.handshakeComplete_)return ow(!e.writeResults||0===e.writeResults.length),this.handshakeComplete_=!0,this.listener.onHandshakeComplete();{this.backoff.reset();let t=f5(e.writeResults,e.commitTime),n=fB(e.commitTime);return this.listener.onMutationResult(n,t)}}writeHandshake(){let e={};e.database=f$(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>f2(this.serializer,e))};this.sendRequest(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vJ{}class vX extends vJ{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new oI(oE.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,n){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.invokeRPC(e,t,n,r,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===oE.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new oI(oE.UNKNOWN,e.toString())})}invokeStreamingRPC(e,t,n,r){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeStreamingRPC(e,t,n,i,s,r)).catch(e=>{if("FirebaseError"===e.name)throw e.code===oE.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new oI(oE.UNKNOWN,e.toString())})}terminate(){this.terminated=!0}}function vZ(e,t,n,r){return new vX(e,t,n,r)}async function v0(e,t){let n=oC(e),r=f$(n.serializer)+"/documents",i={writes:t.map(e=>f2(n.serializer,e))};await n.invokeRPC("Commit",r,i)}async function v1(e,t){let n=oC(e),r=f$(n.serializer)+"/documents",i={documents:t.map(e=>fU(n.serializer,e))},s=await n.invokeStreamingRPC("BatchGetDocuments",r,i,t.length),a=new Map;s.forEach(e=>{let t=fX(n.serializer,e);a.set(t.key.toString(),t)});let o=[];return t.forEach(e=>{let t=a.get(e.toString());ow(!!t),o.push(t)}),o}async function v2(e,t,n){var r;let i=oC(e),{request:s,aliasMap:a}=pr(i.serializer,hW(t),n),o=s.parent;i.connection.shouldResourcePathBeIncludedInRequest||delete s.parent;let l=(await i.invokeStreamingRPC("RunAggregationQuery",o,s,1)).filter(e=>!!e.result);ow(1===l.length);let u=null===(r=l[0].result)||void 0===r?void 0:r.aggregateFields;return Object.keys(u).reduce((e,t)=>(e[a[t]]=u[t],e),{})}function v3(e,t,n){let r=oC(e);return r.verifyInitialized(),new vY(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}function v4(e,t,n){let r=oC(e);return r.verifyInitialized(),new vQ(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let v6="OnlineStateTracker",v9=1,v5=null;class v7{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",v5,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${v5/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=v9&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${v9} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(ov(t),this.shouldWarnClientIsOffline=!1):oy(v6,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let v8="RemoteStore",be=10;class bt{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{n.enqueueAndForget(async()=>{bd(this)&&(oy(v8,"Restarting streams for network reachability change."),await bx(this))})}),this.onlineStateTracker=new v7(n,r)}}function bn(e,t,n,r,i){return new bt(e,t,n,r,i)}async function br(e){if(bd(e))for(let t of e.onNetworkStatusChange)await t(!0)}async function bi(e){for(let t of e.onNetworkStatusChange)await t(!1)}async function bs(e){let t=oC(e);oy(v8,"RemoteStore shutting down."),t.offlineCauses.add(5),await bi(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function ba(e,t){let n=oC(e);!n.listenTargets.has(t.targetId)&&(n.listenTargets.set(t.targetId,t),bh(n)?bc(n):bM(n).isOpen()&&bl(n,t))}function bo(e,t){let n=oC(e),r=bM(n);n.listenTargets.delete(t),r.isOpen()&&bu(n,t),0===n.listenTargets.size&&(r.isOpen()?r.markIdle():bd(n)&&n.onlineStateTracker.set("Unknown"))}function bl(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(o$.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}bM(e).watch(t)}function bu(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),bM(e).unwatch(t)}function bc(e){e.watchChangeAggregator=new fT({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),bM(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function bh(e){return bd(e)&&!bM(e).isStarted()&&e.listenTargets.size>0}function bd(e){return 0===oC(e).offlineCauses.size}function bf(e){e.watchChangeAggregator=void 0}async function bp(e){e.listenTargets.forEach((t,n)=>{bl(e,t)})}async function bg(e,t){bf(e),bh(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),bc(e)):e.onlineStateTracker.set("Unknown")}async function bm(e,t,n){if(e.onlineStateTracker.set("Online"),t instanceof fv&&2===t.state&&t.cause){try{await bS(e,t)}catch(n){oy(v8,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await by(e,n)}return}if(t instanceof fm?e.watchChangeAggregator.handleDocumentChange(t):t instanceof fy?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!n.isEqual(o$.min()))try{let t=await yP(e.localStore);n.compareTo(t)>=0&&await bb(e,n)}catch(t){oy(v8,"Failed to raise snapshot:",t),await by(e,t)}}async function by(e,t,n){if(ld(t))e.offlineCauses.add(1),await bi(e),e.onlineStateTracker.set("Offline"),n||(n=()=>yP(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{oy(v8,"Retrying IndexedDB access"),await n(),e.offlineCauses.delete(1),await br(e)});else throw t}function bv(e,t){return t().catch(n=>by(e,n,t))}function bb(e,t){let n=e.watchChangeAggregator.createRemoteEvent(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.listenTargets.get(r);i&&e.listenTargets.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.listenTargets.get(t);r&&(e.listenTargets.set(t,r.withResumeToken(uW.EMPTY_BYTE_STRING,r.snapshotVersion)),bu(e,t),bl(e,new pB(r.target,t,n,r.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(n)}async function bS(e,t){let n=t.cause;for(let r of t.targetIds)e.listenTargets.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.listenTargets.delete(r),e.watchChangeAggregator.removeTarget(r))}async function bT(e){let t=oC(e),n=bP(t),r=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:cr;for(;bw(t);)try{let e=await yU(t.localStore,r);if(null===e){0===t.writePipeline.length&&n.markIdle();break}r=e.batchId,bC(t,e)}catch(e){await by(t,e)}bE(t)&&bI(t)}function bw(e){return bd(e)&&e.writePipeline.length<be}function bC(e,t){e.writePipeline.push(t);let n=bP(e);n.isOpen()&&n.handshakeComplete&&n.writeMutations(t.mutations)}function bE(e){return bd(e)&&!bP(e).isStarted()&&e.writePipeline.length>0}function bI(e){bP(e).start()}async function b_(e){bP(e).writeHandshake()}async function bk(e){let t=bP(e);for(let n of e.writePipeline)t.writeMutations(n.mutations)}async function bD(e,t,n){let r=e.writePipeline.shift(),i=d7.from(r,t,n);await bv(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await bT(e)}async function bR(e,t){t&&bP(e).handshakeComplete&&await bA(e,t),bE(e)&&bI(e)}async function bA(e,t){if(fn(t.code)){let n=e.writePipeline.shift();bP(e).inhibitBackoff(),await bv(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await bT(e)}}async function bx(e){let t=oC(e);t.offlineCauses.add(4),await bi(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await br(t)}async function bN(e,t){let n=oC(e);n.asyncQueue.verifyOperationInProgress(),oy(v8,"RemoteStore received new credentials");let r=bd(n);n.offlineCauses.add(3),await bi(n),r&&n.onlineStateTracker.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.offlineCauses.delete(3),await br(n)}async function bO(e,t){let n=oC(e);t?(n.offlineCauses.delete(2),await br(n)):t||(n.offlineCauses.add(2),await bi(n),n.onlineStateTracker.set("Unknown"))}function bM(e){return e.watchStream||(e.watchStream=v4(e.datastore,e.asyncQueue,{onOpen:bp.bind(null,e),onClose:bg.bind(null,e),onWatchChange:bm.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),bh(e)?bc(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),bf(e))})),e.watchStream}function bP(e){return e.writeStream||(e.writeStream=v3(e.datastore,e.asyncQueue,{onOpen:b_.bind(null,e),onClose:bR.bind(null,e),onHandshakeComplete:bk.bind(null,e),onMutationResult:bD.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await bT(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(oy(v8,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bL="AsyncQueue";class bB{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new o_,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new bB(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new oI(oE.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function bF(e,t){if(ov(bL,`${t}: ${e}`),ld(e))return new oI(oE.UNAVAILABLE,`${t}: ${e}`);throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bj{constructor(e){e?this.comparator=(t,n)=>e(t,n)||oY.comparator(t.key,n.key):this.comparator=(e,t)=>oY.comparator(e.key,t.key),this.keyedMap=da(),this.sortedSet=new uB(this.comparator)}static emptySet(e){return new bj(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof bj)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new bj;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bU{constructor(){this.changeMap=new uB(oY.comparator)}track(e){let t=e.doc.key,n=this.changeMap.get(t);if(!n){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===n.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==n.type?this.changeMap=this.changeMap.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):oT()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,n)=>{e.push(n)}),e}}class bV{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new bV(e,t,bj.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!h1(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bq{constructor(){this.viewSnap=void 0,this.listeners=[]}}function bz(){return new b$}class b${constructor(){this.queries=new dn(e=>h2(e),h1),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}}async function bG(e,t){let n=oC(e),r=t.query,i=!1,s=n.queries.get(r);if(s||(i=!0,s=new bq),i)try{s.viewSnap=await n.onListen(r)}catch(n){let e=bF(n,`Initialization of query '${h3(t.query)}' failed`);t.onError(e);return}n.queries.set(r,s),s.listeners.push(t),t.applyOnlineStateChange(n.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&bY(n)}async function bH(e,t){let n=oC(e),r=t.query,i=!1,s=n.queries.get(r);if(s){let e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function bK(e,t){let n=oC(e),r=!1;for(let e of t){let t=e.query,i=n.queries.get(t);if(i){for(let t of i.listeners)t.onViewSnapshot(e)&&(r=!0);i.viewSnap=e}}r&&bY(n)}function bW(e,t,n){let r=oC(e),i=r.queries.get(t);if(i)for(let e of i.listeners)e.onError(n);r.queries.delete(t)}function bQ(e,t){let n=oC(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(let e of n.listeners)e.applyOnlineStateChange(t)&&(r=!0)}),r&&bY(n)}function bY(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}class bJ{constructor(e,t,n){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=n||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new bV(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache)return!0;let n="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=bV.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bX{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.addedKeys=n,this.removedKeys=r}static fromSnapshot(e,t){let n=dm(),r=dm();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new bX(e,t.fromCache,n,r)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bZ{constructor(e){this.serializer=e}toDocumentKey(e){return fV(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?fQ(this.serializer,e.document,!1):cZ.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return fB(e)}}class b0{constructor(e,t,n){this.bundleMetadata=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=b1(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;let n=oK.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,n=new bZ(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.toDocumentKey(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||dm()).add(e);t.set(n,r)}}return t}async complete(){let e=await y0(this.localStore,new bZ(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let e of this.queries)await y3(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}}}function b1(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function b2(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b3{constructor(e){this.key=e}}class b4{constructor(e){this.key=e}}class b6{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=dm(),this.mutatedKeys=dm(),this.docComparator=de(e),this.documentSet=new bj(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let n=t?t.changeSet:new bU,r=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),c=h4(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),f=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(n.track({type:3,doc:c}),f=!0):!this.shouldWaitForSyncedDocument(u,c)&&(n.track({type:2,doc:c}),f=!0,(o&&this.docComparator(c,o)>0||l&&0>this.docComparator(c,l))&&(a=!0)):!u&&c?(n.track({type:0,doc:c}),f=!0):u&&!c&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(c?(s=s.add(c),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{documentSet:s,changeSet:n,needsRefill:a,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){let r=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let i=e.changeSet.getChanges();i.sort((e,t)=>b9(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(n);let s=t?this.updateLimboDocuments():[],a=0===this.limboDocuments.size&&this.current?1:0,o=a!==this.syncState;return(this.syncState=a,0!==i.length||o)?{snapshot:new bV(this.query,e.documentSet,r,i,e.mutatedKeys,0===a,o,!1,!!n&&n.resumeToken.approximateByteSize()>0),limboChanges:s}:{limboChanges:s}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new bU,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=dm(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});let t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new b4(e))}),this.limboDocuments.forEach(n=>{e.has(n)||t.push(new b3(n))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=dm();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return bV.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function b9(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return oT()}};return n(e)-n(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let b5="SyncEngine";class b7{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class b8{constructor(e){this.key=e,this.receivedDocument=!1}}class Se{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new dn(e=>h2(e),h1),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new uB(oY.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new mG,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=ml.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function St(e,t,n,r,i,s,a){let o=new Se(e,t,n,r,i,s);return a&&(o._isPrimaryClient=!0),o}async function Sn(e,t){let n,r;let i=SM(e),s=i.queryViewsByQuery.get(t);if(s)n=s.targetId,i.sharedClientState.addLocalQueryTarget(n),r=s.view.computeInitialSnapshot();else{let e=await yq(i.localStore,hK(t)),s=i.sharedClientState.addLocalQueryTarget(e.targetId);n=e.targetId,r=await Sr(i,t,n,"current"===s,e.resumeToken),i.isPrimaryClient&&ba(i.remoteStore,e)}return r}async function Sr(e,t,n,r,i){e.applyDocChanges=(t,n,r)=>ST(e,t,n,r);let s=await yG(e.localStore,t,!0),a=new b6(t,s.remoteKeys),o=a.computeDocChanges(s.documents),l=fg.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);Sy(e,n,u.limboChanges);let c=new b7(t,n,a);return e.queryViewsByQuery.set(t,c),e.queriesByTarget.has(n)?e.queriesByTarget.get(n).push(t):e.queriesByTarget.set(n,[t]),u.snapshot}async function Si(e,t){let n=oC(e),r=n.queryViewsByQuery.get(t),i=n.queriesByTarget.get(r.targetId);if(i.length>1){n.queriesByTarget.set(r.targetId,i.filter(e=>!h1(e,t))),n.queryViewsByQuery.delete(t);return}n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await y$(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),bo(n.remoteStore,r.targetId),Sg(n,r.targetId)}).catch(li)):(Sg(n,r.targetId),await y$(n.localStore,r.targetId,!0))}async function Ss(e,t,n){let r=SP(e);try{let e=await yA(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),Sf(r,e.batchId,n),await SS(r,e.changes),await bT(r.remoteStore)}catch(t){let e=bF(t,"Failed to persist write");n.reject(e)}}async function Sa(e,t){let n=oC(e);try{let e=await yL(n.localStore,t);t.targetChanges.forEach((e,t)=>{let r=n.activeLimboResolutionsByTarget.get(t);r&&(ow(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.receivedDocument=!0:e.modifiedDocuments.size>0?ow(r.receivedDocument):e.removedDocuments.size>0&&(ow(r.receivedDocument),r.receivedDocument=!1))}),await SS(n,e,t)}catch(e){await li(e)}}function So(e,t,n){let r=oC(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){let e=[];r.queryViewsByQuery.forEach((n,r)=>{let i=r.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),bQ(r.eventManager,t),e.length&&r.syncEngineListener.onWatchChange(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Sl(e,t,n){let r=oC(e);r.sharedClientState.updateQueryState(t,"rejected",n);let i=r.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new uB(oY.comparator);e=e.insert(s,cZ.newNoDocument(s,o$.min()));let n=dm().add(s),i=new fp(o$.min(),new Map,new uB(oF),e,n);await Sa(r,i),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(t),Sb(r)}else await y$(r.localStore,t,!1).then(()=>Sg(r,t,n)).catch(li)}async function Su(e,t){let n=oC(e),r=t.batch.batchId;try{let e=await yx(n.localStore,t);Sp(n,r,null),Sh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await SS(n,e)}catch(e){await li(e)}}async function Sc(e,t,n){let r=oC(e);try{let e=await yO(r.localStore,t);Sp(r,t,n),Sh(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await SS(r,e)}catch(e){await li(e)}}function Sh(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function Sd(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new oI(oE.CANCELLED,t))})}),e.pendingWritesCallbacks.clear()}function Sf(e,t,n){let r=e.mutationUserCallbacks[e.currentUser.toKey()];r||(r=new uB(oF)),r=r.insert(t,n),e.mutationUserCallbacks[e.currentUser.toKey()]=r}function Sp(e,t,n){let r=oC(e),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function Sg(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(r),n&&e.syncEngineListener.onWatchError(r,n);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||Sm(e,t)})}function Sm(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());let n=e.activeLimboTargetsByKey.get(t);null!==n&&(bo(e.remoteStore,n),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(n),Sb(e))}function Sy(e,t,n){for(let r of n)r instanceof b3?(e.limboDocumentRefs.addReference(r.key,t),Sv(e,r)):r instanceof b4?(oy(b5,"Document no longer in limbo: "+r.key),e.limboDocumentRefs.removeReference(r.key,t),e.limboDocumentRefs.containsKey(r.key)||Sm(e,r.key)):oT()}function Sv(e,t){let n=t.key,r=n.path.canonicalString();e.activeLimboTargetsByKey.get(n)||e.enqueuedLimboResolutions.has(r)||(oy(b5,"New document in limbo: "+n),e.enqueuedLimboResolutions.add(r),Sb(e))}function Sb(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){let t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);let n=new oY(oK.fromString(t)),r=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(r,new b8(n)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(n,r),ba(e.remoteStore,new pB(hK(hU(n.path)),r,"TargetPurposeLimboResolution",lC.INVALID))}}async function SS(e,t,n){let r=oC(e),i=[],s=[],a=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((e,o)=>{a.push(r.applyDocChanges(o,t,n).then(e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(o.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);let t=bX.fromSnapshot(o.targetId,e);s.push(t)}}))}),await Promise.all(a),r.syncEngineListener.onWatchChange(i),await yj(r.localStore,s))}async function ST(e,t,n,r){let i=t.view.computeDocChanges(n);i.needsRefill&&(i=await yG(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s);return Sy(e,t.targetId,a.limboChanges),a.snapshot}async function Sw(e,t){let n=oC(e);if(!n.currentUser.isEqual(t)){oy(b5,"User change. New user:",t.toKey());let e=await yR(n.localStore,t);n.currentUser=t,Sd(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await SS(n,e.affectedDocuments)}}function SC(e,t){let n=oC(e),r=n.activeLimboResolutionsByTarget.get(t);if(r&&r.receivedDocument)return dm().add(r.key);{let e=dm(),r=n.queriesByTarget.get(t);if(!r)return e;for(let t of r){let r=n.queryViewsByQuery.get(t);e=e.unionWith(r.view.syncedDocuments)}return e}}async function SE(e,t){let n=oC(e),r=await yG(n.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(r);return n.isPrimaryClient&&Sy(n,t.targetId,i.limboChanges),i}async function SI(e,t){let n=oC(e);return yJ(n.localStore,t).then(e=>SS(n,e))}async function S_(e,t,n,r){let i=oC(e),s=await yK(i.localStore,t);if(null===s){oy(b5,"Cannot apply mutation batch with id: "+t);return}"pending"===n?await bT(i.remoteStore):"acknowledged"===n||"rejected"===n?(Sp(i,t,r||null),Sh(i,t),yW(i.localStore,t)):oT(),await SS(i,s)}async function Sk(e,t){let n=oC(e);if(SM(n),SP(n),!0===t&&!0!==n._isPrimaryClient){let e=n.sharedClientState.getAllActiveQueryTargets(),t=await SR(n,e.toArray());for(let e of(n._isPrimaryClient=!0,await bO(n.remoteStore,!0),t))ba(n.remoteStore,e)}else if(!1===t&&!1!==n._isPrimaryClient){let e=[],t=Promise.resolve();n.queriesByTarget.forEach((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(Sg(n,i),y$(n.localStore,i,!0))),bo(n.remoteStore,i)}),await t,await SR(n,e),SD(n),n._isPrimaryClient=!1,await bO(n.remoteStore,!1)}}function SD(e){let t=oC(e);t.activeLimboResolutionsByTarget.forEach((e,n)=>{bo(t.remoteStore,n)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new uB(oY.comparator)}async function SR(e,t,n){let r=oC(e),i=[],s=[];for(let e of t){let t;let n=r.queriesByTarget.get(e);if(n&&0!==n.length)for(let e of(t=await yq(r.localStore,hK(n[0])),n)){let t=r.queryViewsByQuery.get(e),n=await SE(r,t);n.snapshot&&s.push(n.snapshot)}else{let n=await yY(r.localStore,e);t=await yq(r.localStore,n),await Sr(r,SA(n),e,!1,t.resumeToken)}i.push(t)}return r.syncEngineListener.onWatchChange(s),i}function SA(e){return hj(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Sx(e){return yQ(oC(e).localStore)}async function SN(e,t,n,r){let i=oC(e);if(i._isPrimaryClient){oy(b5,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{let e=await yJ(i.localStore,h8(s[0])),r=fp.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,uW.EMPTY_BYTE_STRING);await SS(i,e,r);break}case"rejected":await y$(i.localStore,t,!0),Sg(i,t,r);break;default:oT()}}async function SO(e,t,n){let r=SM(e);if(r._isPrimaryClient){for(let e of t){if(r.queriesByTarget.has(e)){oy(b5,"Adding an already active target "+e);continue}let t=await yY(r.localStore,e),n=await yq(r.localStore,t);await Sr(r,SA(t),n.targetId,!1,n.resumeToken),ba(r.remoteStore,n)}for(let e of n)r.queriesByTarget.has(e)&&await y$(r.localStore,e,!1).then(()=>{bo(r.remoteStore,e),Sg(r,e)}).catch(li)}}function SM(e){let t=oC(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Sa.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=SC.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Sl.bind(null,t),t.syncEngineListener.onWatchChange=bK.bind(null,t.eventManager),t.syncEngineListener.onWatchError=bW.bind(null,t.eventManager),t}function SP(e){let t=oC(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Su.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Sc.bind(null,t),t}async function SL(e,t,n){try{let r=await t.getMetadata();if(await y1(e.localStore,r))return await t.close(),n._completeWith(b2(r)),Promise.resolve(new Set);n._updateProgress(b1(r));let i=new b0(r,e.localStore,t.serializer),s=await t.nextElement();for(;s;){let e=await i.addSizedElement(s);e&&n._updateProgress(e),s=await t.nextElement()}let a=await i.complete();return await SS(e,a.changedDocs,void 0),await y2(e.localStore,r),n._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(e){return ob(b5,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SB{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=vj(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return yD(this.persistence,new y7,e.initialUser,this.serializer)}createPersistence(e){return new m0(m2.factory,this.serializer)}createSharedClientState(e){return new vb}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class SF extends SB{constructor(e,t,n){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await SP(this.onlineComponentProvider.syncEngine),await bT(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return yD(this.persistence,new y7,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new mC(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new lw(t,this.persistence);return new lT(e.asyncQueue,n)}createPersistence(e){let t=yC(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?mm.withCacheSize(this.cacheSizeBytes):mm.DEFAULT;return new yS(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,vB(),vF(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new vb}}class Sj{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>So(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Sw.bind(null,this.syncEngine),await bO(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return bz()}createDatastore(e){let t=vj(e.databaseInfo.databaseId),n=vP(e.databaseInfo);return vZ(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return bn(this.localStore,this.datastore,e.asyncQueue,e=>So(this.syncEngine,e,0),vL())}createSyncEngine(e,t){return St(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return bs(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SU=10240;function SV(e,t=SU){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function Sq(e,t,n,r){if(!0===t&&!0===r)throw new oI(oE.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Sz(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function S$(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{let t=SG(e);return t?`a custom ${t} object`:"an object"}}if("function"==typeof e)return"a function";return oT()}function SG(e){return e.constructor?e.constructor.name:null}function SH(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new oI(oE.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=S$(e);throw new oI(oE.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SK(e,t){if(!(e instanceof Uint8Array))throw new oI(oE.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${S$(e)}`);return SV(e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SW{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):ov("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SQ{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SY{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new o_,this.buffer=new Uint8Array,this.textDecoder=fl(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let e=await this.readLength();if(null===e)return null;let t=this.textDecoder.decode(e),n=Number(t);return isNaN(n)&&this.raiseError(`length string (${t}) is not valid number`),new SQ(JSON.parse(await this.readJsonString(n)),e.length+n)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){let e=await this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function SJ(e,t){return new SY(e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SX{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new oI(oE.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");let t=await v1(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new d3(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=oY.fromPath(t);this.mutations.push(new d9(n,this.precondition(n)))}),await v0(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=o$.min();else throw oT();let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new oI(oE.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?dU.none():t.isEqual(o$.min())?dU.exists(!1):dU.updateTime(t)}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return dU.exists(!0);if(t.isEqual(o$.min()))throw new oI(oE.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return dU.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SZ="FirestoreClient",S0=100,S1=11,S2=20,S3=22;class S4{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=oh.UNAUTHENTICATED,this.clientId=oB.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{oy(SZ,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(oy(SZ,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:S0}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new oI(oE.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new o_;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=bF(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function S6(e,t){e.asyncQueue.verifyOperationInProgress(),oy(SZ,"Initializing OfflineComponentProvider");let n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await yR(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function S9(e,t){e.asyncQueue.verifyOperationInProgress();let n=await S7(e);oy(SZ,"Initializing OnlineComponentProvider");let r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>bN(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>bN(t.remoteStore,n)),e._onlineComponents=t}function S5(e){return"FirebaseError"===e.name?e.code===oE.FAILED_PRECONDITION||e.code===oE.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||e.code===S3||e.code===S2||e.code===S1}async function S7(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){oy(SZ,"Using user provided OfflineComponentProvider");try{await S6(e,e._uninitializedComponentsProvider._offline)}catch(n){let t=n;if(!S5(t))throw t;ob("Error using user provided cache. Falling back to memory cache: "+t),await S6(e,new SB)}}else oy(SZ,"Using default OfflineComponentProvider"),await S6(e,new SB)}return e._offlineComponents}async function S8(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(oy(SZ,"Using user provided OnlineComponentProvider"),await S9(e,e._uninitializedComponentsProvider._online)):(oy(SZ,"Using default OnlineComponentProvider"),await S9(e,new Sj))),e._onlineComponents}function Te(e){return S7(e).then(e=>e.localStore)}function Tt(e){return S8(e).then(e=>e.syncEngine)}function Tn(e){return S8(e).then(e=>e.datastore)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tr(e,t){return e.timeoutSeconds===t.timeoutSeconds}function Ti(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ts="ComponentProvider",Ta=new Map;function To(e){let t=Ta.get(e);t&&(oy(Ts,"Removing Datastore"),Ta.delete(e),t.terminate())}function Tl(e,t,n,r){return new u8(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Ti(r.experimentalLongPollingOptions),r.useFetchStreams)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tu="firestore.googleapis.com",Tc=!0,Th=5,Td=30,Tf=!0;class Tp{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new oI(oE.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Tu,this.ssl=Tc}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:Tc;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=mg;else{if(e.cacheSizeBytes!==mp&&e.cacheSizeBytes<mv)throw new oI(oE.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${mv}`);this.cacheSizeBytes=e.cacheSizeBytes}Sq("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=Tf:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ti(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),Tg(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&Tr(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function Tg(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new oI(oE.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<Th)throw new oI(oE.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${Th})`);if(e.timeoutSeconds>Td)throw new oI(oE.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${Td})`)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tm{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Tp({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new oI(oE.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new oI(oE.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Tp(e),void 0!==e.credentials&&(this._authCredentials=oP(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return To(this),Promise.resolve()}}function Ty(e,t,n,r={}){var i;let s=(e=SH(e,Tm))._getSettings(),a=`${t}:${n}`;if(s.host!==Tu&&s.host!==a&&ob("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=oh.MOCK_USER;else{t=q(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new oI(oE.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new oh(s)}e._authCredentials=new oR(new ok(t,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tv{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Tv(this.firestore,e,this._query)}}class Tb{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new TS(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Tb(this.firestore,e,this._key)}}class TS extends Tv{constructor(e,t,n){super(e,t,hU(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Tb(this.firestore,null,new oY(e))}withConverter(e){return new TS(this.firestore,e,this._path)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TT="AsyncQueue";class Tw{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new v$(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new o_;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(ld(e))oy(TT,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,ov("INTERNAL UNHANDLED ERROR: ",TE(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,n){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let r=bB.createAndSchedule(this,e,t,n,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(r),r}verifyNotFailed(){this.failure&&oT()}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(let t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function TC(){return new Tw}function TE(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class TI extends Tm{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=TC(),this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Tk(this),this._firestoreClient.terminate()}}function T_(e,t){let n="object"==typeof e?e:e6(),r="string"==typeof e?e:t||ce,i=e0(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let e=j("firestore");e&&Ty(i,...e)}return i}function Tk(e){var t,n,r;let i=e._freezeSettings(),s=Tl(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new S4(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TD(e,t=!0){of(e3),eZ(new eu("firestore",(e,{instanceIdentifier:n,options:r})=>{let i=e.getProvider("app").getImmediate(),s=new TI(new oA(e.getProvider("auth-internal")),new oM(e.getProvider("app-check-internal")),cn(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),e9(ou,oc,e),e9(ou,oc,"esm2017")}class TR{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TA{constructor(e){this._byteString=e}static fromBase64String(e){try{return new TA(uW.fromBase64String(e))}catch(e){throw new oI(oE.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new TA(uW.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tx{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new oI(oE.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new oQ(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TN{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TO{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new oI(oE.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new oI(oE.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return oF(this._lat,e._lat)||oF(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TM=/^__.*__$/;class TP{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new dJ(e,this.data,this.fieldMask,t,this.fieldTransforms):new dW(e,this.data,t,this.fieldTransforms)}}class TL{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new dJ(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function TB(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw oT()}}class TF{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new TF(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return T3(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(TB(this.dataSource)&&TM.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class Tj{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||vj(e)}createContext(e,t,n,r=!1){return new TF({dataSource:e,methodName:t,targetDoc:n,path:oQ.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function TU(e){let t=e._freezeSettings(),n=vj(e._databaseId);return new Tj(e._databaseId,!!t.ignoreUndefinedProperties,n)}function TV(e,t,n,r,i,s={}){let a,o;let l=e.createContext(s.merge||s.mergeFields?2:0,t,n,i);TZ("Data must be an object, but it was:",l,r);let u=TW(r,l);if(s.merge)a=new uG(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=T0(t,r,n);if(!l.contains(i))throw new oI(oE.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);T4(e,i)||e.push(i)}a=new uG(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new TP(new cJ(u),a,o)}class Tq extends TN{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof Tq}}class Tz extends null{_toFieldTransform(e){return new dL(e.path,new dk)}isEqual(e){return e instanceof Tz}}function T$(e,t,n,r){let i=e.createContext(1,t,n);TZ("Data must be an object, but it was:",i,r);let s=[],a=cJ.empty();return uP(r,(e,r)=>{let o=T2(t,e,n);r=el(r);let l=i.childContextForFieldPath(o);if(r instanceof Tq)s.push(o);else{let e=TK(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new TL(a,new uG(s),i.fieldTransforms)}function TG(e,t,n,r,i,s){let a=e.createContext(1,t,n),o=[T0(t,r,n)],l=[i];if(s.length%2!=0)throw new oI(oE.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(T0(t,s[e])),l.push(s[e+1]);let u=[],c=cJ.empty();for(let e=o.length-1;e>=0;--e)if(!T4(u,o[e])){let t=o[e],n=l[e];n=el(n);let r=a.childContextForFieldPath(t);if(n instanceof Tq)u.push(t);else{let e=TK(n,r);null!=e&&(u.push(t),c.set(t,e))}}return new TL(c,new uG(u),a.fieldTransforms)}function TH(e,t,n,r=!1){return TK(n,e.createContext(r?4:3,t))}function TK(e,t){if(TX(e=el(e)))return TZ("Unsupported field value:",t,e),TW(e,t);if(e instanceof TN)return TY(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return TJ(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return TQ(e,t)}function TW(e,t){let n={};return uL(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):uP(e,(e,r)=>{let i=TK(r,t.childContextForField(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function TQ(e,t){let n=[],r=0;for(let i of e){let e=TK(i,t.childContextForArray(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}function TY(e,t){if(!TB(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}function TJ(e,t){if(null===(e=el(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return dT(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=oz.fromDate(e);return{timestampValue:fN(t.serializer,n)}}if(e instanceof oz){let n=new oz(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:fN(t.serializer,n)}}if(e instanceof TO)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof TA)return{bytesValue:fM(t.serializer,e._byteString)};else if(e instanceof Tb){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:fF(e.firestore._databaseId||t.databaseId,e._key.path)}}else throw t.createError(`Unsupported field value: ${S$(e)}`)}function TX(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof oz)&&!(e instanceof TO)&&!(e instanceof TA)&&!(e instanceof Tb)&&!(e instanceof TN)}function TZ(e,t,n){if(!TX(n)||!Sz(n)){let r=S$(n);if("an object"===r)throw t.createError(e+" a custom object");throw t.createError(e+" "+r)}}function T0(e,t,n){if((t=el(t))instanceof Tx)return t._internalPath;if("string"==typeof t)return T2(e,t);throw T3("Field path arguments must be of type string or ",e,!1,void 0,n)}let T1=RegExp("[~\\*/\\[\\]]");function T2(e,t,n){if(t.search(T1)>=0)throw T3(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Tx(...t.split("."))._internalPath}catch(r){throw T3(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function T3(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new oI(oE.INVALID_ARGUMENT,o+e+l)}function T4(e,t){return e.some(e=>e.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T6{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Tb(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let e=new T9(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}get(e){if(this._document){let t=this._document.data.field(T5("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class T9 extends T6{data(){return super.data()}}function T5(e,t){return"string"==typeof t?T2(e,t):t instanceof Tx?t._internalPath:t._delegate._internalPath}class T7{}class T8 extends T7{}class we extends T8{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new we(e,t,n)}_apply(e){let t=this._parse(e);return wp(e._query,t),new Tv(e.firestore,e.converter,hY(e._query,t))}_parse(e){let t=TU(e.firestore);return wo(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class wt extends T7{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new wt(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:hn.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(wg(e._query,t),new Tv(e.firestore,e.converter,hY(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class wn extends T8{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new wn(e,t)}_apply(e){let t=wl(e._query,this._field,this._direction);return new Tv(e.firestore,e.converter,hJ(e._query,t))}}class wr extends T8{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new wr(e,t,n)}_apply(e){return new Tv(e.firestore,e.converter,hX(e._query,this._limit,this._limitType))}}class wi extends T8{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new wi(e,t,n)}_apply(e){let t=wa(e,this.type,this._docOrFields,this._inclusive);return new Tv(e.firestore,e.converter,hZ(e._query,t))}}class ws extends T8{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new ws(e,t,n)}_apply(e){let t=wa(e,this.type,this._docOrFields,this._inclusive);return new Tv(e.firestore,e.converter,h0(e._query,t))}}function wa(e,t,n,r){if(n[0]=el(n[0]),n[0]instanceof T6)return wu(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=TU(e.firestore);return wc(e._query,e.firestore._databaseId,i,t,n,r)}}function wo(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new oI(oE.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){wd(a,s);let t=[];for(let n of a)t.push(wh(r,e,n));o={arrayValue:{values:t}}}else o=wh(r,e,a)}else("in"===s||"not-in"===s||"array-contains-any"===s)&&wd(a,s),o=TH(n,t,a,"in"===s||"not-in"===s);return ht.create(i,s,o)}function wl(e,t,n){if(null!==e.startAt)throw new oI(oE.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new oI(oE.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new c9(t,n)}function wu(e,t,n,r,i){if(!r)throw new oI(oE.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of hH(e))if(n.field.isKeyField())s.push(cB(t,r.key));else{let e=r.data.field(n.field);if(u6(e))throw new oI(oE.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{let e=n.field.canonicalString();throw new oI(oE.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new c1(s,i)}function wc(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new oI(oE.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new oI(oE.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!hG(e)&&-1!==l.indexOf("/"))throw new oI(oE.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(oK.fromString(l));if(!oY.isDocumentKey(n))throw new oI(oE.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new oY(n);o.push(cB(t,i))}else{let e=TH(n,r,l);o.push(e)}}return new c1(o,s)}function wh(e,t,n){if("string"==typeof(n=el(n))){if(""===n)throw new oI(oE.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!hG(t)&&-1!==n.indexOf("/"))throw new oI(oE.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(oK.fromString(n));if(!oY.isDocumentKey(r))throw new oI(oE.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return cB(e,new oY(r))}if(n instanceof Tb)return cB(e,n._key);throw new oI(oE.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${S$(n)}.`)}function wd(e,t){if(!Array.isArray(e)||0===e.length)throw new oI(oE.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function wf(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function wp(e,t){let n=wm(e.filters,wf(t.op));if(null!==n){if(n===t.op)throw new oI(oE.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);throw new oI(oE.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}}function wg(e,t){let n=e;for(let e of t.getFlattenedFilters())wp(n,e),n=hY(n,e)}function wm(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wy{convertValue(e,t="none"){switch(cc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return uZ(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(u0(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw oT()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return uP(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new TO(uZ(e.latitude),uZ(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=u5(e);if(null==n)return null;return this.convertValue(n,t);case"estimate":return this.convertTimestamp(u7(e));default:return null}}convertTimestamp(e){let t=uX(e);return new oz(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=oK.fromString(e);ow(pL(n));let r=new ct(n.get(1),n.get(3)),i=new oY(n.popFirst(5));return r.isEqual(t)||ov(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wv(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class wb extends wy{constructor(e){super(),this.firestore=e}convertBytes(e){return new TA(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Tb(this.firestore,null,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wS{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class wT extends T6{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{let t=new ww(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){let n=this._document.data.field(T5("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class ww extends wT{data(e={}){return super.data(e)}}function wC(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return oT()}}class wE extends wy{constructor(e){super(),this.firestore=e}convertBytes(e){return new TA(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Tb(this.firestore,null,t)}}class wI{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=new Sj,this._offlineComponentProvider=new SF(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}function w_(e,t){if((e=el(e)).firestore===t)return e;throw new oI(oE.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.")}new WeakMap;class wk{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return wD||fa(wD=new wk),wD}notifyOnExistenceFilterMismatch(e){this.existenceFilterMismatchCallbacksById.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),n=this.existenceFilterMismatchCallbacksById;return n.set(t,e),()=>n.delete(t)}}let wD=null;async function wR(e){try{let t=(0,b.E)(),n=await e.json();return n.callback_query||await E({bot:t,body:n}),Response.json({code:201,message:"success"})}catch(e){return Response.json({code:403,message:"Something Went Wrong",err:e})}}async function wA(e){console.log("GET api was called");try{return Response.json({code:201,message:"success"})}catch(e){return console.log(e),Response.json({code:403,message:"Something Went Wrong",err:e})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */TD("node"),T_(e4({apiKey:"AIzaSyD5iLpuPjMjuIbcL0c-N6-mEDBIe2V7Y94",authDomain:"opbot-eaf96.firebaseapp.com",projectId:"opbot-eaf96",storageBucket:"opbot-eaf96.appspot.com",messagingSenderId:"359709125915",appId:"1:359709125915:web:080044314d45aaaa4d37be",measurementId:"G-Y3HJ361BSX"}));let wx="",wN=new m.AppRouteRouteModule({definition:{kind:y.x.APP_ROUTE,page:"/api/v4/bot/route",pathname:"/api/v4/bot",filename:"route",bundlePath:"app/api/v4/bot/route"},resolvedPagePath:"C:\\Users\\17gua\\Desktop\\cryptos\\tribuni\\next-app\\app\\api\\v4\\bot\\route.jsx",nextConfigOutput:wx,userland:g}),{requestAsyncStorage:wO,staticGenerationAsyncStorage:wM,serverHooks:wP}=wN,wL="/api/v4/bot/route";function wB(){return(0,v.patchFetch)({serverHooks:wP,staticGenerationAsyncStorage:wM})}},63418:(e,t,n)=>{"use strict";n.d(t,{K:()=>u,E:()=>i});var r=n(22358);let i=()=>new r(process.env.BOT_API_KEY,{polling:!1});var s=n(23215);let a=(0,s.createProxy)(String.raw`C:\Users\17gua\Desktop\cryptos\tribuni\next-app\components\bot\BotConnector.jsx`),{__esModule:o,$$typeof:l}=a;a.default;let u=(0,s.createProxy)(String.raw`C:\Users\17gua\Desktop\cryptos\tribuni\next-app\components\bot\BotConnector.jsx#BotConnector`)},23542:(e,t,n)=>{"use strict";n.d(t,{o:()=>i,i:()=>r});let r=(0,n(71468).Z)({host:process.env.DB_HOST,port:process.env.DB_PORT,database:process.env.DB_NAME,username:process.env.DB_USERNAME,password:process.env.DB_PASSWORD,ssl:!1,max:20,max_lifetime:null,idle_timeout:60,connect_timeout:30});function i(e){return null==e?null:e.replace(/'/g,"''")}},11576:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addAdminServicesToServer=t.registerAdminService=void 0;let n=[];function r(e,t){n.push({getServiceDefinition:e,getHandlers:t})}function i(e){for(let{getServiceDefinition:t,getHandlers:r}of n)e.addService(t(),r())}t.registerAdminService=r,t.addAdminServicesToServer=i},71241:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackoffTimeout=void 0;let n=1e3,r=1.6,i=12e4,s=.2;function a(e,t){return Math.random()*(t-e)+e}class o{constructor(e,t){this.callback=e,this.initialDelay=n,this.multiplier=r,this.maxDelay=i,this.jitter=s,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,n;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null===(n=(t=this.timerId).unref)||void 0===n||n.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+a(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,null===(t=(e=this.timerId).ref)||void 0===t||t.call(e)}unref(){var e,t;this.hasRef=!1,null===(t=(e=this.timerId).unref)||void 0===t||t.call(e)}getEndTime(){return this.endTime}}t.BackoffTimeout=o},15651:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallCredentials=void 0;let r=n(16535);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new o(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,n)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((n,r)=>{e.getRequestMetadata(t.service_url,(e,t)=>{if(e){r(e);return}if(!t){r(Error("Headers not set by metadata plugin"));return}n(t)})})).then(e=>{let t=new r.Metadata;for(let n of Object.keys(e))t.add(n,e[n]);n(null,t)},e=>{n(e)})})}static createEmpty(){return new l}}t.CallCredentials=s;class a extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new r.Metadata;for(let n of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(n);return t}compose(e){return new a(this.creds.concat([e]))}_equals(e){return this===e||e instanceof a&&this.creds.every((t,n)=>t._equals(e.creds[n]))}}class o extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,n)=>{this.metadataGenerator(e,(e,r)=>{void 0!==r?t(r):n(e)})})}compose(e){return new a([this,e])}_equals(e){return this===e||e instanceof o&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new r.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},3249:(e,t)=>{"use strict";function n(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length}Object.defineProperty(t,"__esModule",{value:!0}),t.InterceptingListenerImpl=t.isInterceptingListener=void 0,t.isInterceptingListener=n;class r{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}t.InterceptingListenerImpl=r},63680:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNextCallNumber=void 0;let n=0;function r(){return n++}t.getNextCallNumber=r},10805:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientDuplexStreamImpl=t.ClientWritableStreamImpl=t.ClientReadableStreamImpl=t.ClientUnaryCallImpl=t.callErrorFromStatus=void 0;let r=n(82361),i=n(12781),s=n(18584);function a(e,t){let n=`${e.code} ${s.Status[e.code]}: ${e.details}`,r=Error(n),i=`${r.stack}
for call at
${t}`;return Object.assign(Error(n),e,{stack:i})}t.callErrorFromStatus=a;class o extends r.EventEmitter{constructor(){super()}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}}t.ClientUnaryCallImpl=o;class l extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_read(e){var t;null===(t=this.call)||void 0===t||t.startRead()}}t.ClientReadableStreamImpl=l;class u extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_write(e,t,n){var r;let i={callback:n},s=Number(t);Number.isNaN(s)||(i.flags=s),null===(r=this.call)||void 0===r||r.sendMessageWithContext(i,e)}_final(e){var t;null===(t=this.call)||void 0===t||t.halfClose(),e()}}t.ClientWritableStreamImpl=u;class c extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_read(e){var t;null===(t=this.call)||void 0===t||t.startRead()}_write(e,t,n){var r;let i={callback:n},s=Number(t);Number.isNaN(s)||(i.flags=s),null===(r=this.call)||void 0===r||r.sendMessageWithContext(i,e)}_final(e){var t;null===(t=this.call)||void 0===t||t.halfClose(),e()}}t.ClientDuplexStreamImpl=c},39324:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelCredentials=void 0;let r=n(24404),i=n(15651),s=n(60998);function a(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class o{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,n,i){var o;if(a(e,"Root certificate"),a(t,"Private key"),a(n,"Certificate chain"),t&&!n)throw Error("Private key must be given with accompanying certificate chain");if(!t&&n)throw Error("Certificate chain must be given with accompanying private key");return new u((0,r.createSecureContext)({ca:null!==(o=null!=e?e:(0,s.getDefaultRootsData)())&&void 0!==o?o:void 0,key:null!=t?t:void 0,cert:null!=n?n:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new u(e,null!=t?t:{})}static createInsecure(){return new l}}t.ChannelCredentials=o;class l extends o{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class u extends o{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new c(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class c extends o{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new c(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},6377:(e,t)=>{"use strict";function n(e,t){let n=Object.keys(e).sort(),r=Object.keys(t).sort();if(n.length!==r.length)return!1;for(let i=0;i<n.length;i+=1)if(n[i]!==r[i]||e[n[i]]!==t[r[i]])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.channelOptionsEqual=t.recognizedOptions=void 0,t.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},t.channelOptionsEqual=n},69107:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelImplementation=void 0;let r=n(39324),i=n(49982);class s{constructor(e,t,n){if("string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof r.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(n&&"object"!=typeof n)throw TypeError("Channel options must be an object");this.internalChannel=new i.InternalChannel(e,t,n)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,n){this.internalChannel.watchConnectivityState(e,t,n)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,n,r,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,n,r,i)}}t.ChannelImplementation=s},64061:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.getChannelzServiceDefinition=t.getChannelzHandlers=t.unregisterChannelzRef=t.registerChannelzSocket=t.registerChannelzServer=t.registerChannelzSubchannel=t.registerChannelzChannel=t.ChannelzCallTracker=t.ChannelzChildrenTracker=t.ChannelzTrace=void 0;let r=n(41808),i=n(92916),s=n(18584),a=n(21916),o=n(11576),l=n(57303);function u(e){return{channel_id:e.id,name:e.name}}function c(e){return{subchannel_id:e.id,name:e.name}}function h(e){return{server_id:e.id}}function d(e){return{socket_id:e.id,name:e.name}}let f=32;class p{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,n){let r=new Date;this.events.push({description:t,severity:e,timestamp:r,childChannel:(null==n?void 0:n.kind)==="channel"?n:void 0,childSubchannel:(null==n?void 0:n.kind)==="subchannel"?n:void 0}),this.events.length>=2*f&&(this.events=this.events.slice(f)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:N(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:N(e.timestamp),channel_ref:e.childChannel?u(e.childChannel):null,subchannel_ref:e.childSubchannel?c(e.childSubchannel):null}))}}}t.ChannelzTrace=p;class g{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,n,r;switch(e.kind){case"channel":{let n=null!==(t=this.channelChildren.get(e.id))&&void 0!==t?t:{ref:e,count:0};n.count+=1,this.channelChildren.set(e.id,n);break}case"subchannel":{let t=null!==(n=this.subchannelChildren.get(e.id))&&void 0!==n?n:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{let t=null!==(r=this.socketChildren.get(e.id))&&void 0!==r?r:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){let e=[];for(let{ref:t}of this.channelChildren.values())e.push(t);let t=[];for(let{ref:e}of this.subchannelChildren.values())t.push(e);let n=[];for(let{ref:e}of this.socketChildren.values())n.push(e);return{channels:e,subchannels:t,sockets:n}}}t.ChannelzChildrenTracker=g;class m{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}t.ChannelzCallTracker=m;let y=1;function v(){return y++}let b=[],S=[],T=[],w=[];function C(e,t,n){let r=v(),i={id:r,name:e,kind:"channel"};return n&&(b[r]={ref:i,getInfo:t}),i}function E(e,t,n){let r=v(),i={id:r,name:e,kind:"subchannel"};return n&&(S[r]={ref:i,getInfo:t}),i}function I(e,t){let n=v(),r={id:n,kind:"server"};return t&&(T[n]={ref:r,getInfo:e}),r}function _(e,t,n){let r=v(),i={id:r,name:e,kind:"socket"};return n&&(w[r]={ref:i,getInfo:t}),i}function k(e){switch(e.kind){case"channel":delete b[e.id];return;case"subchannel":delete S[e.id];return;case"server":delete T[e.id];return;case"socket":delete w[e.id];return}}function D(e){let t=Number.parseInt(e,16);return[t/256|0,t%256]}function R(e){return""===e?[]:[].concat(...e.split(":").map(e=>D(e)))}function A(e){if((0,r.isIPv4)(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!(0,r.isIPv6)(e))return null;{let t,n;let r=e.indexOf("::");-1===r?(t=e,n=""):(t=e.substring(0,r),n=e.substring(r+2));let i=Buffer.from(R(t)),s=Buffer.from(R(n)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}}function x(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function N(e){if(!e)return null;let t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function O(e){let t=e.getInfo();return{ref:u(e.ref),data:{target:t.target,state:x(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:N(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>u(e)),subchannel_ref:t.children.subchannels.map(e=>c(e))}}function M(e,t){let n=Number.parseInt(e.request.channel_id),r=b[n];if(void 0===r){t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+n});return}t(null,{channel:O(r)})}function P(e,t){let n=Number.parseInt(e.request.max_results),r=[],i=Number.parseInt(e.request.start_channel_id);for(;i<b.length;i++){let e=b[i];if(void 0!==e&&(r.push(O(e)),r.length>=n))break}t(null,{channel:r,end:i>=T.length})}function L(e){let t=e.getInfo();return{ref:h(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:N(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>d(e))}}function B(e,t){let n=Number.parseInt(e.request.server_id),r=T[n];if(void 0===r){t({code:s.Status.NOT_FOUND,details:"No server data found for id "+n});return}t(null,{server:L(r)})}function F(e,t){let n=Number.parseInt(e.request.max_results),r=[],i=Number.parseInt(e.request.start_server_id);for(;i<T.length;i++){let e=T[i];if(void 0!==e&&(r.push(L(e)),r.length>=n))break}t(null,{server:r,end:i>=T.length})}function j(e,t){let n=Number.parseInt(e.request.subchannel_id),r=S[n];if(void 0===r){t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+n});return}let i=r.getInfo();t(null,{subchannel:{ref:c(r.ref),data:{target:i.target,state:x(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:N(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>d(e))}})}function U(e){var t;return(0,a.isTcpSubchannelAddress)(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!==(t=A(e.host))&&void 0!==t?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function V(e,t){var n,r,i,a,o;let l=Number.parseInt(e.request.socket_id),u=w[l];if(void 0===u){t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});return}let c=u.getInfo(),h=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!==(n=c.security.cipherSuiteStandardName)&&void 0!==n?n:void 0,other_name:null!==(r=c.security.cipherSuiteOtherName)&&void 0!==r?r:void 0,local_certificate:null!==(i=c.security.localCertificate)&&void 0!==i?i:void 0,remote_certificate:null!==(a=c.security.remoteCertificate)&&void 0!==a?a:void 0}}:null;t(null,{socket:{ref:d(u.ref),local:c.localAddress?U(c.localAddress):null,remote:c.remoteAddress?U(c.remoteAddress):null,remote_name:null!==(o=c.remoteName)&&void 0!==o?o:void 0,security:h,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:N(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:N(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:N(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:N(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}}})}function q(e,t){let n=Number.parseInt(e.request.server_id),r=T[n];if(void 0===r){t({code:s.Status.NOT_FOUND,details:"No server data found for id "+n});return}let i=Number.parseInt(e.request.start_socket_id),a=Number.parseInt(e.request.max_results),o=r.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],u=0;for(;u<o.length&&(!(o[u].id>=i)||(l.push(d(o[u])),!(l.length>=a)));u++);t(null,{socket_ref:l,end:u>=o.length})}function z(){return{GetChannel:M,GetTopChannels:P,GetServer:B,GetServers:F,GetSubchannel:j,GetSocket:V,GetServerSockets:q}}t.registerChannelzChannel=C,t.registerChannelzSubchannel=E,t.registerChannelzServer=I,t.registerChannelzSocket=_,t.unregisterChannelzRef=k,t.getChannelzHandlers=z;let $=null;function G(){if($)return $;let e=(0,n(9256).J_)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return $=(0,l.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service}function H(){(0,o.registerAdminService)(G,z)}t.getChannelzServiceDefinition=G,t.setup=H},89299:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInterceptingCall=t.InterceptingCall=t.RequesterBuilder=t.ListenerBuilder=t.InterceptorConfigurationError=void 0;let r=n(16535),i=n(3249),s=n(18584),a=n(13471);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}t.InterceptorConfigurationError=o;class l{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}t.ListenerBuilder=l;class u{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}t.RequesterBuilder=u;let c={onReceiveMetadata:(e,t)=>{t(e)},onReceiveMessage:(e,t)=>{t(e)},onReceiveStatus:(e,t)=>{t(e)}},h={start:(e,t,n)=>{n(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class d{constructor(e,t){var n,r,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!==(n=t.start)&&void 0!==n?n:h.start,sendMessage:null!==(r=t.sendMessage)&&void 0!==r?r:h.sendMessage,halfClose:null!==(i=t.halfClose)&&void 0!==i?i:h.halfClose,cancel:null!==(s=t.cancel)&&void 0!==s?s:h.cancel}:this.requester=h}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var n,r,s,a,o,l;let u={onReceiveMetadata:null!==(r=null===(n=null==t?void 0:t.onReceiveMetadata)||void 0===n?void 0:n.bind(t))&&void 0!==r?r:e=>{},onReceiveMessage:null!==(a=null===(s=null==t?void 0:t.onReceiveMessage)||void 0===s?void 0:s.bind(t))&&void 0!==a?a:e=>{},onReceiveStatus:null!==(l=null===(o=null==t?void 0:t.onReceiveStatus)||void 0===o?void 0:o.bind(t))&&void 0!==l?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,u,(e,t)=>{var n,r,s;let a;if(this.processingMetadata=!1,(0,i.isInterceptingListener)(t))a=t;else{let e={onReceiveMetadata:null!==(n=t.onReceiveMetadata)&&void 0!==n?n:c.onReceiveMetadata,onReceiveMessage:null!==(r=t.onReceiveMessage)&&void 0!==r?r:c.onReceiveMessage,onReceiveStatus:null!==(s=t.onReceiveStatus)&&void 0!==s?s:c.onReceiveStatus};a=new i.InterceptingListenerImpl(e,u)}this.nextCall.start(e,a),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,n=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,n),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function f(e,t,n){var r,i;let s=null!==(r=n.deadline)&&void 0!==r?r:1/0,a=n.host,o=null!==(i=n.parent)&&void 0!==i?i:null,l=n.propagate_flags,u=n.credentials,c=e.createCall(t,s,a,o,l);return u&&c.setCredentials(u),c}t.InterceptingCall=d;class p{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let n;try{n=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${(0,a.getErrorMessage)(e)}`);return}this.call.sendMessageWithContext(e,n)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let n=null;this.call.start(e,{onReceiveMetadata:e=>{var n;null===(n=null==t?void 0:t.onReceiveMetadata)||void 0===n||n.call(t,e)},onReceiveMessage:e=>{var i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){n={code:s.Status.INTERNAL,details:`Response message parsing error: ${(0,a.getErrorMessage)(e)}`,metadata:new r.Metadata},this.call.cancelWithStatus(n.code,n.details);return}null===(i=null==t?void 0:t.onReceiveMessage)||void 0===i||i.call(t,o)},onReceiveStatus:e=>{var r,i;n?null===(r=null==t?void 0:t.onReceiveStatus)||void 0===r||r.call(t,n):null===(i=null==t?void 0:t.onReceiveStatus)||void 0===i||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class g extends p{constructor(e,t){super(e,t)}start(e,t){var n,r;let i=!1,s={onReceiveMetadata:null!==(r=null===(n=null==t?void 0:t.onReceiveMetadata)||void 0===n?void 0:n.bind(t))&&void 0!==r?r:e=>{},onReceiveMessage:e=>{var n;i=!0,null===(n=null==t?void 0:t.onReceiveMessage)||void 0===n||n.call(t,e)},onReceiveStatus:e=>{var n,r;i||null===(n=null==t?void 0:t.onReceiveMessage)||void 0===n||n.call(t,null),null===(r=null==t?void 0:t.onReceiveStatus)||void 0===r||r.call(t,e)}};super.start(e,s),this.call.startRead()}}class m extends p{}function y(e,t,n){let r=f(e,n.path,t);return n.responseStream?new m(r,n):new g(r,n)}function v(e,t,n,r){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);let s=Object.assign({},n,{method_definition:t});return i.reduceRight((e,t)=>n=>t(n,e),e=>y(r,e,t))(s)}t.getInterceptingCall=v},48747:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;let r=n(10805),i=n(69107),s=n(92916),a=n(18584),o=n(16535),l=n(89299),u=Symbol(),c=Symbol(),h=Symbol(),d=Symbol();function f(e){return"function"==typeof e}function p(e){return e.stack.split("\n").slice(1).join("\n")}class g{constructor(e,t,n={}){var r,s;if(n=Object.assign({},n),this[c]=null!==(r=n.interceptors)&&void 0!==r?r:[],delete n.interceptors,this[h]=null!==(s=n.interceptor_providers)&&void 0!==s?s:[],delete n.interceptor_providers,this[c].length>0&&this[h].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[d]=n.callInvocationTransformer,delete n.callInvocationTransformer,n.channelOverride)this[u]=n.channelOverride;else if(n.channelFactoryOverride){let r=n.channelFactoryOverride;delete n.channelFactoryOverride,this[u]=r(e,t,n)}else this[u]=new i.ChannelImplementation(e,t,n)}close(){this[u].close()}getChannel(){return this[u]}waitForReady(e,t){let n=r=>{let i;if(r){t(Error("Failed to connect before the deadline"));return}try{i=this[u].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[u].watchConnectivityState(i,e,n)}catch(e){t(Error("The channel has been closed"))}};setImmediate(n)}checkOptionalUnaryResponseArguments(e,t,n){if(f(e))return{metadata:new o.Metadata,options:{},callback:e};if(f(t))return e instanceof o.Metadata?{metadata:e,options:{},callback:t}:{metadata:new o.Metadata,options:e,callback:t};if(!(e instanceof o.Metadata&&t instanceof Object&&f(n)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:n}}makeUnaryRequest(e,t,n,i,s,o,f){var g,m;let y=this.checkOptionalUnaryResponseArguments(s,o,f),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:n},b={argument:i,metadata:y.metadata,call:new r.ClientUnaryCallImpl,channel:this[u],methodDefinition:v,callOptions:y.options,callback:y.callback};this[d]&&(b=this[d](b));let S=b.call,T={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(g=b.callOptions.interceptors)&&void 0!==g?g:[],callInterceptorProviders:null!==(m=b.callOptions.interceptor_providers)&&void 0!==m?m:[]},w=(0,l.getInterceptingCall)(T,b.methodDefinition,b.callOptions,b.channel);S.call=w;let C=null,E=!1,I=Error();return w.start(b.metadata,{onReceiveMetadata:e=>{S.emit("metadata",e)},onReceiveMessage(e){null!==C&&w.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),C=e},onReceiveStatus(e){if(!E){if(E=!0,e.code===a.Status.OK){if(null===C){let t=p(I);b.callback((0,r.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else b.callback(null,C)}else{let t=p(I);b.callback((0,r.callErrorFromStatus)(e,t))}I=null,S.emit("status",e)}}}),w.sendMessage(i),w.halfClose(),S}makeClientStreamRequest(e,t,n,i,s,o){var f,g;let m=this.checkOptionalUnaryResponseArguments(i,s,o),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:n},v={metadata:m.metadata,call:new r.ClientWritableStreamImpl(t),channel:this[u],methodDefinition:y,callOptions:m.options,callback:m.callback};this[d]&&(v=this[d](v));let b=v.call,S={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(f=v.callOptions.interceptors)&&void 0!==f?f:[],callInterceptorProviders:null!==(g=v.callOptions.interceptor_providers)&&void 0!==g?g:[]},T=(0,l.getInterceptingCall)(S,v.methodDefinition,v.callOptions,v.channel);b.call=T;let w=null,C=!1,E=Error();return T.start(v.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==w&&T.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),w=e},onReceiveStatus(e){if(!C){if(C=!0,e.code===a.Status.OK){if(null===w){let t=p(E);v.callback((0,r.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,w)}else{let t=p(E);v.callback((0,r.callErrorFromStatus)(e,t))}E=null,b.emit("status",e)}}}),b}checkMetadataAndOptions(e,t){let n,r;return e instanceof o.Metadata?(n=e,r=t||{}):(r=e||{},n=new o.Metadata),{metadata:n,options:r}}makeServerStreamRequest(e,t,n,i,s,o){var f,g;let m=this.checkMetadataAndOptions(s,o),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:n},v={argument:i,metadata:m.metadata,call:new r.ClientReadableStreamImpl(n),channel:this[u],methodDefinition:y,callOptions:m.options};this[d]&&(v=this[d](v));let b=v.call,S={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(f=v.callOptions.interceptors)&&void 0!==f?f:[],callInterceptorProviders:null!==(g=v.callOptions.interceptor_providers)&&void 0!==g?g:[]},T=(0,l.getInterceptingCall)(S,v.methodDefinition,v.callOptions,v.channel);b.call=T;let w=!1,C=Error();return T.start(v.metadata,{onReceiveMetadata(e){b.emit("metadata",e)},onReceiveMessage(e){b.push(e)},onReceiveStatus(e){if(!w){if(w=!0,b.push(null),e.code!==a.Status.OK){let t=p(C);b.emit("error",(0,r.callErrorFromStatus)(e,t))}C=null,b.emit("status",e)}}}),T.sendMessage(i),T.halfClose(),b}makeBidiStreamRequest(e,t,n,i,s){var o,f;let g=this.checkMetadataAndOptions(i,s),m={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:n},y={metadata:g.metadata,call:new r.ClientDuplexStreamImpl(t,n),channel:this[u],methodDefinition:m,callOptions:g.options};this[d]&&(y=this[d](y));let v=y.call,b={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(o=y.callOptions.interceptors)&&void 0!==o?o:[],callInterceptorProviders:null!==(f=y.callOptions.interceptor_providers)&&void 0!==f?f:[]},S=(0,l.getInterceptingCall)(b,y.methodDefinition,y.callOptions,y.channel);v.call=S;let T=!1,w=Error();return S.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!T){if(T=!0,v.push(null),e.code!==a.Status.OK){let t=p(w);v.emit("error",(0,r.callErrorFromStatus)(e,t))}w=null,v.emit("status",e)}}}),v}}t.Client=g},74239:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(n||(t.CompressionAlgorithms=n={}))},85863:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionFilterFactory=t.CompressionFilter=void 0;let r=n(59796),i=n(74239),s=n(18584),a=n(44023),o=n(42130),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class u{async writeMessage(e,t){let n=e;t&&(n=await this.compressMessage(n));let r=Buffer.allocUnsafe(n.length+5);return r.writeUInt8(t?1:0,0),r.writeUInt32BE(n.length,1),n.copy(r,5),r}async readMessage(e){let t=1===e.readUInt8(0),n=e.slice(5);return t&&(n=await this.decompressMessage(n)),n}}class c extends u{async compressMessage(e){return e}async writeMessage(e,t){let n=Buffer.allocUnsafe(e.length+5);return n.writeUInt8(0,0),n.writeUInt32BE(e.length,1),e.copy(n,5),n}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class h extends u{compressMessage(e){return new Promise((t,n)=>{r.deflate(e,(e,r)=>{e?n(e):t(r)})})}decompressMessage(e){return new Promise((t,n)=>{r.inflate(e,(e,r)=>{e?n(e):t(r)})})}}class d extends u{compressMessage(e){return new Promise((t,n)=>{r.gzip(e,(e,r)=>{e?n(e):t(r)})})}decompressMessage(e){return new Promise((t,n)=>{r.unzip(e,(e,r)=>{e?n(e):t(r)})})}}class f extends u{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function p(e){switch(e){case"identity":return new c;case"deflate":return new h;case"gzip":return new d;default:return new f(e)}}class g extends a.BaseFilter{constructor(e,t){var n;super(),this.sharedFilterConfig=t,this.sendCompression=new c,this.receiveCompression=new c,this.currentCompressionAlgorithm="identity";let r=e["grpc.default_compression_algorithm"];if(void 0!==r){if(l(r)){let e=i.CompressionAlgorithms[r],s=null===(n=t.serverSupportedEncodingHeader)||void 0===n?void 0:n.split(",");(!s||s.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=p(this.currentCompressionAlgorithm))}else o.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${r}`)}}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let e=t[0];"string"==typeof e&&(this.receiveCompression=p(e))}e.remove("grpc-encoding");let n=e.get("grpc-accept-encoding")[0];return n&&(this.sharedFilterConfig.serverSupportedEncodingHeader=n,n.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new c,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let n;let r=await e;return n=!(this.sendCompression instanceof c)&&((null!==(t=r.flags)&&void 0!==t?t:0)&2)==0,{message:await this.sendCompression.writeMessage(r.message,n),flags:r.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}t.CompressionFilter=g;class m{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new g(this.options,this.sharedFilterConfig)}}t.CompressionFilterFactory=m},92916:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(n||(t.ConnectivityState=n={}))},18584:(e,t)=>{"use strict";var n,r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=t.Propagate=t.LogVerbosity=t.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(n||(t.Status=n={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(r||(t.LogVerbosity=r={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(i||(t.Propagate=i={})),t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},22547:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.restrictControlPlaneStatusCode=void 0;let r=n(18584),i=[r.Status.OK,r.Status.INVALID_ARGUMENT,r.Status.NOT_FOUND,r.Status.ALREADY_EXISTS,r.Status.FAILED_PRECONDITION,r.Status.ABORTED,r.Status.OUT_OF_RANGE,r.Status.DATA_LOSS];function s(e,t){return i.includes(e)?{code:r.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${r.Status[e]} ${t}`}:{code:e,details:t}}t.restrictControlPlaneStatusCode=s},4491:(e,t)=>{"use strict";function n(...e){let t=1/0;for(let n of e){let e=n instanceof Date?n.getTime():n;e<t&&(t=e)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.deadlineToString=t.getRelativeTimeout=t.getDeadlineTimeoutString=t.minDeadline=void 0,t.minDeadline=n;let r=[["m",1],["S",1e3],["M",6e4],["H",36e5]];function i(e){let t=new Date().getTime();e instanceof Date&&(e=e.getTime());let n=Math.max(e-t,0);for(let[e,t]of r){let r=n/t;if(r<1e8)return String(Math.ceil(r))+e}throw Error("Deadline is too far in the future")}t.getDeadlineTimeoutString=i;let s=2147483647;function a(e){let t=(e instanceof Date?e.getTime():e)-new Date().getTime();return t<0?0:t>s?1/0:t}function o(e){if(e instanceof Date)return e.toISOString();{let t=new Date(e);return Number.isNaN(t.getTime())?""+e:t.toISOString()}}t.getRelativeTimeout=a,t.deadlineToString=o},92342:(e,t)=>{"use strict";function n(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}}function r(e){return 1e3*e.seconds+e.nanos/1e6|0}function i(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}Object.defineProperty(t,"__esModule",{value:!0}),t.isDuration=t.durationToMs=t.msToDuration=void 0,t.msToDuration=n,t.durationToMs=r,t.isDuration=i},13471:(e,t)=>{"use strict";function n(e){return e instanceof Error?e.message:String(e)}function r(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.code?e.code:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorCode=t.getErrorMessage=void 0,t.getErrorMessage=n,t.getErrorCode=r},25486:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlierDetectionLoadBalancingConfig=t.BaseSubchannelWrapper=t.registerAdminService=t.FilterStackFactory=t.BaseFilter=t.PickResultType=t.QueuePicker=t.UnavailablePicker=t.ChildLoadBalancerHandler=t.subchannelAddressToString=t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.registerLoadBalancerType=t.createChildChannelControlHelper=t.BackoffTimeout=t.durationToMs=t.uriToString=t.createResolver=t.registerResolver=t.log=t.trace=void 0;var r=n(42130);Object.defineProperty(t,"trace",{enumerable:!0,get:function(){return r.trace}}),Object.defineProperty(t,"log",{enumerable:!0,get:function(){return r.log}});var i=n(5520);Object.defineProperty(t,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}}),Object.defineProperty(t,"createResolver",{enumerable:!0,get:function(){return i.createResolver}});var s=n(36699);Object.defineProperty(t,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});var a=n(92342);Object.defineProperty(t,"durationToMs",{enumerable:!0,get:function(){return a.durationToMs}});var o=n(71241);Object.defineProperty(t,"BackoffTimeout",{enumerable:!0,get:function(){return o.BackoffTimeout}});var l=n(29480);Object.defineProperty(t,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(t,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(t,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(t,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});var u=n(21916);Object.defineProperty(t,"subchannelAddressToString",{enumerable:!0,get:function(){return u.subchannelAddressToString}});var c=n(37253);Object.defineProperty(t,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return c.ChildLoadBalancerHandler}});var h=n(40937);Object.defineProperty(t,"UnavailablePicker",{enumerable:!0,get:function(){return h.UnavailablePicker}}),Object.defineProperty(t,"QueuePicker",{enumerable:!0,get:function(){return h.QueuePicker}}),Object.defineProperty(t,"PickResultType",{enumerable:!0,get:function(){return h.PickResultType}});var d=n(44023);Object.defineProperty(t,"BaseFilter",{enumerable:!0,get:function(){return d.BaseFilter}});var f=n(49227);Object.defineProperty(t,"FilterStackFactory",{enumerable:!0,get:function(){return f.FilterStackFactory}});var p=n(11576);Object.defineProperty(t,"registerAdminService",{enumerable:!0,get:function(){return p.registerAdminService}});var g=n(23348);Object.defineProperty(t,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return g.BaseSubchannelWrapper}});var m=n(76132);Object.defineProperty(t,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return m.OutlierDetectionLoadBalancingConfig}})},49227:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterStackFactory=t.FilterStack=void 0;class n{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}t.FilterStack=n;class r{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new r([...this.factories])}createFilter(){return new n(this.factories.map(e=>e.createFilter()))}}t.FilterStackFactory=r},44023:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseFilter=void 0;class n{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}}t.BaseFilter=n},30914:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProxiedConnection=t.mapProxyName=void 0;let r=n(42130),i=n(18584),s=n(5520),a=n(13685),o=n(24404),l=n(42130),u=n(21916),c=n(36699),h=n(57310),d="proxy";function f(e){l.trace(i.LogVerbosity.DEBUG,d,e)}function p(){let e,t="",n="";if(process.env.grpc_proxy)n="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)n="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};n="http_proxy",t=process.env.http_proxy}try{e=new h.URL(t)}catch(e){return(0,r.log)(i.LogVerbosity.ERROR,`cannot parse value of "${n}" env var`),{}}if("http:"!==e.protocol)return(0,r.log)(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?((0,r.log)(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let a=e.hostname,o=e.port;""===o&&(o="80");let l={address:`${a}:${o}`};return s&&(l.creds=s),f("Proxy server "+l.address+" set by environment variable "+n),l}function g(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(f("No proxy server list set by environment variable "+t),e.split(",")):[]}function m(e,t){var n;let r={target:e,extraOptions:{}};if((null!==(n=t["grpc.enable_http_proxy"])&&void 0!==n?n:1)===0||"unix"===e.scheme)return r;let i=p();if(!i.address)return r;let s=(0,c.splitHostPort)(e.path);if(!s)return r;let a=s.host;for(let t of g())if(t===a)return f("Not using proxy for target in no_proxy list: "+(0,c.uriToString)(e)),r;let o={"grpc.http_connect_target":(0,c.uriToString)(e)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}}function y(e,t,n){if(!("grpc.http_connect_target"in t))return Promise.resolve({});let l=t["grpc.http_connect_target"],h=(0,c.parseUri)(l);if(null===h)return Promise.resolve({});let d={method:"CONNECT",path:h.path},p={Host:h.path};(0,u.isTcpSubchannelAddress)(e)?(d.host=e.host,d.port=e.port):d.socketPath=e.path,"grpc.http_connect_creds"in t&&(p["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),d.headers=p;let g=(0,u.subchannelAddressToString)(e);return f("Using proxy "+g+" to connect to "+d.path),new Promise((e,t)=>{let l=a.request(d);l.once("connect",(a,u,p)=>{var m;if(l.removeAllListeners(),u.removeAllListeners(),200===a.statusCode){if(f("Successfully connected to "+d.path+" through proxy "+g),"secureContext"in n){let r=(0,s.getDefaultAuthority)(h),i=(0,c.splitHostPort)(r),a=null!==(m=null==i?void 0:i.host)&&void 0!==m?m:r,l=o.connect(Object.assign({host:a,servername:a,socket:u},n),()=>{f("Successfully established a TLS connection to "+d.path+" through proxy "+g),e({socket:l,realTarget:h})});l.on("error",e=>{f("Failed to establish a TLS connection to "+d.path+" through proxy "+g+" with error "+e.message),t()})}else f("Successfully established a plaintext connection to "+d.path+" through proxy "+g),e({socket:u,realTarget:h})}else(0,r.log)(i.LogVerbosity.ERROR,"Failed to connect to "+d.path+" through proxy "+g+" with status "+a.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),(0,r.log)(i.LogVerbosity.ERROR,"Failed to connect to proxy "+g+" with error "+e.message),t()}),l.end()})}t.mapProxyName=m,t.getProxiedConnection=y},94415:(e,t,n)=>{"use strict";m={value:!0},m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=void 0;let r=n(15651);m={enumerable:!0,get:function(){return r.CallCredentials}};let i=n(69107);m={enumerable:!0,get:function(){return i.ChannelImplementation}};let s=n(74239);m={enumerable:!0,get:function(){return s.CompressionAlgorithms}};let a=n(92916);m={enumerable:!0,get:function(){return a.ConnectivityState}};let o=n(39324);m={enumerable:!0,get:function(){return o.ChannelCredentials}};let l=n(48747);m={enumerable:!0,get:function(){return l.Client}};let u=n(18584);m={enumerable:!0,get:function(){return u.LogVerbosity}},m={enumerable:!0,get:function(){return u.Status}},m={enumerable:!0,get:function(){return u.Propagate}};let c=n(42130),h=n(57303);m={enumerable:!0,get:function(){return h.loadPackageDefinition}},m={enumerable:!0,get:function(){return h.makeClientConstructor}},m={enumerable:!0,get:function(){return h.makeClientConstructor}};let d=n(16535);m={enumerable:!0,get:function(){return d.Metadata}};let f=n(16681);m={enumerable:!0,get:function(){return f.Server}};let p=n(40618);m={enumerable:!0,get:function(){return p.ServerCredentials}};let g=n(27680);m={enumerable:!0,get:function(){return g.StatusBuilder}},m={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:o.ChannelCredentials.createInsecure,createSsl:o.ChannelCredentials.createSsl,createFromSecureContext:o.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:r.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:r.CallCredentials.createFromGoogleCredential,createEmpty:r.CallCredentials.createEmpty},m=e=>e.close(),m=(e,t,n)=>e.waitForReady(t,n),m=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},m=(e,t,n)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},m=e=>{c.setLogger(e)},m=e=>{c.setLoggerVerbosity(e)},m=e=>l.Client.prototype.getChannel.call(e);var m,y=n(89299);m={enumerable:!0,get:function(){return y.ListenerBuilder}},m={enumerable:!0,get:function(){return y.RequesterBuilder}},m={enumerable:!0,get:function(){return y.InterceptingCall}},m={enumerable:!0,get:function(){return y.InterceptorConfigurationError}};var v=n(64061);m={enumerable:!0,get:function(){return v.getChannelzServiceDefinition}},m={enumerable:!0,get:function(){return v.getChannelzHandlers}};var b=n(11576);m={enumerable:!0,get:function(){return b.addAdminServicesToServer}},m=n(25486);let S=n(91442),T=n(38337),w=n(78852),C=n(20300),E=n(30795),I=n(76132),_=n(64061);(()=>{S.setup(),T.setup(),w.setup(),C.setup(),E.setup(),I.setup(),_.setup()})()},49982:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InternalChannel=void 0;let r=n(39324),i=n(54255),s=n(98344),a=n(40937),o=n(18584),l=n(49227),u=n(85863),c=n(5520),h=n(42130),d=n(93958),f=n(30914),p=n(36699),g=n(92916),m=n(64061),y=n(51975),v=n(4491),b=n(21582),S=n(63680),T=n(22547),w=n(69794),C=n(23348),E=2147483647,I=1e3,_=18e5,k=new Map,D=16777216,R=1048576;class A extends C.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(e,n,r,i)=>{t.throttleKeepalive(i)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class x{constructor(e,t,n){var y,v,b,S,C,x,N,O;if(this.credentials=t,this.options=n,this.connectivityState=g.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new m.ChannelzCallTracker,this.childrenTracker=new m.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof r.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(n&&"object"!=typeof n)throw TypeError("Channel options must be an object");this.originalTarget=e;let M=(0,p.parseUri)(e);if(null===M)throw Error(`Could not parse target name "${e}"`);let P=(0,c.mapUriDefaultScheme)(M);if(null===P)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},E),null===(v=(y=this.callRefTimer).unref)||void 0===v||v.call(y),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new m.ChannelzTrace,this.channelzRef=(0,m.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,c.getDefaultAuthority)(P);let L=(0,f.mapProxyName)(P,n);this.target=L.target,this.options=Object.assign({},this.options,L.extraOptions),this.subchannelPool=(0,s.getSubchannelPool)((null!==(b=n["grpc.use_local_subchannel_pool"])&&void 0!==b?b:0)===0),this.retryBufferTracker=new w.MessageBufferTracker(null!==(S=n["grpc.retry_buffer_size"])&&void 0!==S?S:D,null!==(C=n["grpc.per_rpc_retry_buffer_size"])&&void 0!==C?C:R),this.keepaliveTime=null!==(x=n["grpc.keepalive_time_ms"])&&void 0!==x?x:-1,this.idleTimeoutMs=Math.max(null!==(N=n["grpc.client_idle_timeout_ms"])&&void 0!==N?N:_,I);let B={createSubchannel:(e,t)=>{let n=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);n.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",n.getChannelzRef());let r=new A(n,this);return this.wrappedSubchannels.add(r),r},updateState:(e,t)=>{this.currentPicker=t;let n=this.pickQueue.slice();for(let e of(this.pickQueue=[],this.callRefTimerUnref(),n))e.doPick();this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new i.ResolvingLoadBalancer(this.target,B,n,(e,t)=>{e.retryThrottling?k.set(this.getTarget(),new w.RetryThrottler(e.retryThrottling.maxTokens,e.retryThrottling.tokenRatio,k.get(this.getTarget()))):k.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=t,this.currentResolutionError=null,process.nextTick(()=>{let e=this.configSelectionQueue;for(let t of(this.configSelectionQueue=[],this.callRefTimerUnref(),e))t.getConfig();this.configSelectionQueue=[]})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,T.restrictControlPlaneStatusCode)(e.code,e.details)),{metadata:e.metadata}));let t=this.configSelectionQueue;for(let n of(this.configSelectionQueue=[],this.callRefTimerUnref(),t))n.reportResolverError(e)}),this.filterStackFactory=new l.FilterStackFactory([new d.MaxMessageSizeFilterFactory(this.options),new u.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(n,void 0,2));let F=Error();(0,h.trace)(o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null===(O=F.stack)||void 0===O?void 0:O.substring(F.stack.indexOf("\n")+1)))}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,h.trace)(null!=t?t:o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,p.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,n,r;(null===(t=(e=this.callRefTimer).hasRef)||void 0===t?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(r=(n=this.callRefTimer).ref)||void 0===r||r.call(n))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(t=(e=this.callRefTimer).unref)||void 0===t||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(let t of((0,h.trace)(o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,p.uriToString)(this.target)+" "+g.ConnectivityState[this.connectivityState]+" -> "+g.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+g.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==g.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime)for(let t of(this.keepaliveTime=e,this.wrappedSubchannels))t.throttleKeepalive(e)}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(g.ConnectivityState.IDLE),this.currentPicker=new a.QueuePicker(this.resolvingLoadBalancer)}maybeStartIdleTimer(){var e,t;this.connectivityState!==g.ConnectivityState.SHUTDOWN&&0===this.callCount&&(this.idleTimer=setTimeout(()=>{this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()},this.idleTimeoutMs),null===(t=(e=this.idleTimer).unref)||void 0===t||t.call(e))}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1,this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}onCallEnd(e){this.channelzEnabled&&(e.code===o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,n,r,i){let s=(0,S.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+s+'] method="'+t+'"'),new y.LoadBalancingCall(this,e,t,n,r,i,s)}createRetryingCall(e,t,n,r,i){let s=(0,S.getNextCallNumber)();return this.trace("createRetryingCall ["+s+'] method="'+t+'"'),new w.RetryingCall(this,e,t,n,r,i,s,this.retryBufferTracker,k.get(this.getTarget()))}createInnerCall(e,t,n,r,i){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(e,t,n,r,i):this.createRetryingCall(e,t,n,r,i)}createResolvingCall(e,t,n,r,i){let s=(0,S.getNextCallNumber)();this.trace("createResolvingCall ["+s+'] method="'+e+'", deadline='+(0,v.deadlineToString)(t));let a={deadline:t,flags:null!=i?i:o.Propagate.DEFAULTS,host:null!=n?n:this.defaultAuthority,parentCall:r},l=new b.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),s);return this.onCallStart(),l.addStatusWatcher(e=>{this.onCallEnd(e)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(g.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,m.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,p.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,n){if(this.connectivityState===g.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let r=null;if(t!==1/0){let e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s){process.nextTick(n,Error("Deadline passed without connectivity state change"));return}r=setTimeout(()=>{this.removeConnectivityStateWatcher(i),n(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}let i={currentState:e,callback:n,timer:r};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,n,r,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===g.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(e,t,n,r,i)}}t.InternalChannel=x},37253:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChildLoadBalancerHandler=void 0;let r=n(29480),i=n(92916),s="child_load_balancer_helper";class a{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){var n;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null===(n=this.parent.currentChild)||void 0===n||n.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){var e;let t=null!==(e=this.parent.pendingChild)&&void 0!==e?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,n){let i;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let e=new this.ChildPolicyHelper(this),n=(0,r.createLoadBalancer)(t,e);e.setChild(n),null===this.currentChild?(this.currentChild=n,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=n,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,n)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}t.ChildLoadBalancerHandler=a},76132:(e,t,n)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.OutlierDetectionLoadBalancer=t.OutlierDetectionLoadBalancingConfig=void 0;let i=n(92916),s=n(18584),a=n(92342),o=n(25486),l=n(29480),u=n(37253),c=n(40937),h=n(21916),d=n(23348),f=n(42130),p="outlier_detection";function g(e){f.trace(s.LogVerbosity.DEBUG,p,e)}let m="outlier_detection",y=(null!==(r=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)&&void 0!==r?r:"true")==="true",v={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},b={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function S(e,t,n,r){if(t in e&&typeof e[t]!==n){let i=r?`${r}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${n}, got ${typeof e[t]}`)}}function T(e,t,n){let r=n?`${n}.${t}`:t;if(t in e){if(!(0,a.isDuration)(e[t]))throw Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=999999999))throw Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function w(e,t,n){let r=n?`${n}.${t}`:t;if(S(e,t,"number",n),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}class C{constructor(e,t,n,r,i,s,a){if(this.childPolicy=a,a.length>0&&"pick_first"===a[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=n?n:3e5,this.maxEjectionPercent=null!=r?r:10,this.successRateEjection=i?Object.assign(Object.assign({},v),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},b),s):null}getLoadBalancerName(){return m}toJsonObject(){return{interval:(0,a.msToDuration)(this.intervalMs),base_ejection_time:(0,a.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,a.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new C(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(T(e,"interval"),T(e,"base_ejection_time"),T(e,"max_ejection_time"),w(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");S(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),w(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),S(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),S(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");w(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),w(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),S(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),S(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new C(e.interval?(0,a.durationToMs)(e.interval):null,e.base_ejection_time?(0,a.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,a.durationToMs)(e.max_ejection_time):null,null!==(t=e.max_ejection_percent)&&void 0!==t?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(l.validateLoadBalancingConfig))}}t.OutlierDetectionLoadBalancingConfig=C;class E extends d.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,n,r)=>{if(this.childSubchannelState=n,!this.ejected)for(let e of this.stateListeners)e(this,t,n,r)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(let e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function I(){return{success:0,failure:0}}class _{constructor(){this.activeBucket=I(),this.inactiveBucket=I()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=I()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class k{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType!==c.PickResultType.COMPLETE)return t;{let e=t.subchannel,n=e.getMapEntry();if(!n)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let r=t.onCallEnded;return this.countCalls&&(r=e=>{var r;e===s.Status.OK?n.counter.addSuccess():n.counter.addFailure(),null===(r=t.onCallEnded)||void 0===r||r.call(t,e)}),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),onCallEnded:r})}}}}class D{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new u.ChildLoadBalancerHandler((0,o.createChildChannelControlHelper)(e,{createSubchannel:(t,n)=>{let r=e.createSubchannel(t,n),i=this.addressMap.get((0,h.subchannelAddressToString)(t)),s=new E(r,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,n)=>{t===i.ConnectivityState.READY?e.updateState(t,new k(n,this.isCountingEnabled())):e.updateState(t,n)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;g("Running success rate check");let n=t.request_volume,r=0,i=[];for(let[e,t]of this.addressMap){let s=t.counter.getLastSuccesses(),a=t.counter.getLastFailures();g("Stats for "+e+": successes="+s+" failures="+a+" targetRequestVolume="+n),s+a>=n&&(r+=1,i.push(s/(s+a)))}if(g("Found "+r+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),r<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,a=0;for(let e of i){let t=e-s;a+=t*t}let o=Math.sqrt(a/i.length),l=s-t.stdev_factor/1e3*o;for(let[r,i]of(g("stdev="+o+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();if(s+a<n)continue;let o=s/(s+a);if(g("Checking candidate "+r+" successRate="+o),o<l){let n=100*Math.random();g("Candidate "+r+" randomNumber="+n+" enforcement_percentage="+t.enforcement_percentage),n<t.enforcement_percentage&&(g("Ejecting candidate "+r),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;g("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let n=0;for(let e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(n+=1);if(!(n<t.minimum_hosts))for(let[n,r]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let i=r.counter.getLastSuccesses(),s=r.counter.getLastFailures();if(g("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume)&&100*s/(s+i)>t.threshold){let i=100*Math.random();g("Candidate "+n+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(g("Ejecting candidate "+n),this.eject(r,e))}}}eject(e,t){for(let t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(let t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,n;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),null===(n=(t=this.ejectionTimer).unref)||void 0===n||n.call(t)}runChecks(){let e=new Date;if(g("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[t,n]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===n.currentEjectionTimestamp)n.ejectionTimeMultiplier>0&&(n.ejectionTimeMultiplier-=1);else{let e=this.latestConfig.getBaseEjectionTimeMs(),r=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(n.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*n.ejectionTimeMultiplier,Math.max(e,r))),i<new Date&&(g("Unejecting "+t),this.uneject(n))}}updateAddressList(e,t,n){if(!(t instanceof C))return;let r=new Set;for(let t of e)r.add((0,h.subchannelAddressToString)(t));for(let e of r)this.addressMap.has(e)||(g("Adding map entry for "+e),this.addressMap.set(e,{counter:new _,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let e of this.addressMap.keys())r.has(e)||(g("Removing map entry for "+e),this.addressMap.delete(e));let i=(0,l.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,n),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig()){if(this.timerStartTime){g("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else g("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets()}else for(let e of(g("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return m}}function R(){y&&(0,o.registerLoadBalancerType)(m,D,C)}t.OutlierDetectionLoadBalancer=D,t.setup=R},20300:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.PickFirstLoadBalancer=t.shuffled=t.PickFirstLoadBalancingConfig=void 0;let r=n(29480),i=n(92916),s=n(40937),a=n(42130),o=n(18584),l="pick_first";function u(e){a.trace(o.LogVerbosity.DEBUG,l,e)}let c="pick_first",h=250;class d{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return c}toJsonObject(){return{[c]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&"boolean"!=typeof e.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new d(!0===e.shuffleAddressList)}}t.PickFirstLoadBalancingConfig=d;class f{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function p(e){let t=e.slice();for(let e=t.length-1;e>1;e--){let n=Math.floor(Math.random()*(e+1)),r=t[e];t[e]=t[n],t[n]=r}return t}t.shuffled=p;class g{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(e,t,n,r,i)=>{this.onSubchannelStateUpdate(e,t,n,i)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(i.ConnectivityState.READY,new f(this.currentPick)):0===this.children.length?this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:e}of(this.stickyTransientFailureMode=!0,this.children))e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,n,r){var s;if(null===(s=this.currentPick)||void 0===s?void 0:s.realSubchannelEquals(e)){n!==i.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[t,s]of this.children.entries())if(e.realSubchannelEquals(s.subchannel)){n===i.ConnectivityState.READY&&this.pickSubchannel(s.subchannel),n===i.ConnectivityState.TRANSIENT_FAILURE&&(s.hasReportedTransientFailure=!0,r&&(this.lastError=r),this.maybeEnterStickyTransientFailureMode(),t===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(t+1)),s.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,n]of this.children.entries())if(t>=e){let e=n.subchannel.getConnectivityState();if(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,n;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===i.ConnectivityState.IDLE&&(u("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var t;null===(t=this.children[e])||void 0===t||t.subchannel.startConnecting()})),this.connectionDelayTimeout=null===(n=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},h)).unref)||void 0===n?void 0:n.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(u("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){u(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)e.subchannel!==this.currentPick&&e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}updateAddressList(e,t){if(!(t instanceof d))return;t.getShuffleAddressList()&&(e=p(e));let n=e.map(e=>({subchannel:this.channelControlHelper.createSubchannel(e,{}),hasReportedTransientFailure:!1}));for(let{subchannel:e}of n)e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(let{subchannel:e}of(this.resetSubchannelList(),this.children=n,this.children))if(e.addConnectivityStateListener(this.subchannelStateListener),e.getConnectivityState()===i.ConnectivityState.READY){this.pickSubchannel(e);return}for(let e of this.children)e.subchannel.getConnectivityState()===i.ConnectivityState.TRANSIENT_FAILURE&&(e.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}exitIdle(){}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return c}}function m(){(0,r.registerLoadBalancerType)(c,g,d),(0,r.registerDefaultLoadBalancerType)(c)}t.PickFirstLoadBalancer=g,t.setup=m},30795:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.RoundRobinLoadBalancer=void 0;let r=n(29480),i=n(92916),s=n(40937),a=n(21916),o=n(42130),l=n(18584),u="round_robin";function c(e){o.trace(l.LogVerbosity.DEBUG,u,e)}let h="round_robin";class d{getLoadBalancerName(){return h}constructor(){}toJsonObject(){return{[h]:{}}}static createFromJson(e){return new d}}class f{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class p{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(e,t,n,r,s)=>{this.calculateAndUpdateState(),(n===i.ConnectivityState.TRANSIENT_FAILURE||n===i.ConnectivityState.IDLE)&&(s&&(this.lastError=s),this.channelControlHelper.requestReresolution(),e.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(i.ConnectivityState.READY)>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new f(e,t))}else this.countSubchannelsWithState(i.ConnectivityState.CONNECTING)>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(i.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){for(let t of(this.resetSubchannelList(),c("Connect to address list "+e.map(e=>(0,a.subchannelAddressToString)(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());let e=t.getConnectivityState();(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return h}}function g(){(0,r.registerLoadBalancerType)(h,p,d)}t.RoundRobinLoadBalancer=p,t.setup=g},29480:(e,t)=>{"use strict";function n(e,t){var n,r,i,s,a,o,l,u,c,h;return{createSubchannel:null!==(r=null===(n=t.createSubchannel)||void 0===n?void 0:n.bind(t))&&void 0!==r?r:e.createSubchannel.bind(e),updateState:null!==(s=null===(i=t.updateState)||void 0===i?void 0:i.bind(t))&&void 0!==s?s:e.updateState.bind(e),requestReresolution:null!==(o=null===(a=t.requestReresolution)||void 0===a?void 0:a.bind(t))&&void 0!==o?o:e.requestReresolution.bind(e),addChannelzChild:null!==(u=null===(l=t.addChannelzChild)||void 0===l?void 0:l.bind(t))&&void 0!==u?u:e.addChannelzChild.bind(e),removeChannelzChild:null!==(h=null===(c=t.removeChannelzChild)||void 0===c?void 0:c.bind(t))&&void 0!==h?h:e.removeChannelzChild.bind(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.isLoadBalancerNameRegistered=t.createLoadBalancer=t.registerDefaultLoadBalancerType=t.registerLoadBalancerType=t.createChildChannelControlHelper=void 0,t.createChildChannelControlHelper=n;let r={},i=null;function s(e,t,n){r[e]={LoadBalancer:t,LoadBalancingConfig:n}}function a(e){i=e}function o(e,t){let n=e.getLoadBalancerName();return n in r?new r[n].LoadBalancer(t):null}function l(e){return e in r}function u(e,t=!1){for(let t of e)if(t.getLoadBalancerName() in r)return t;return t&&i?new r[i].LoadBalancingConfig:null}function c(e){if(!(null!==e&&"object"==typeof e))throw Error("Load balancing config must be an object");let t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");let n=t[0];if(n in r)return r[n].LoadBalancingConfig.createFromJson(e[n]);throw Error(`Unrecognized load balancing config name ${n}`)}t.registerLoadBalancerType=s,t.registerDefaultLoadBalancerType=a,t.createLoadBalancer=o,t.isLoadBalancerNameRegistered=l,t.getFirstUsableConfig=u,t.validateLoadBalancingConfig=c},51975:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadBalancingCall=void 0;let r=n(92916),i=n(18584),s=n(4491),a=n(16535),o=n(40937),l=n(36699),u=n(42130),c=n(22547),h=n(85158),d="load_balancing_call";class f{constructor(e,t,n,r,i,s,a){var o,u;this.channel=e,this.callConfig=t,this.methodName=n,this.host=r,this.credentials=i,this.deadline=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let c=this.methodName.split("/"),h="";c.length>=2&&(h=c[1]);let d=null!==(u=null===(o=(0,l.splitHostPort)(this.host))||void 0===o?void 0:o.host)&&void 0!==u?u:"localhost";this.serviceUrl=`https://${d}/${h}`}trace(e){u.trace(i.LogVerbosity.DEBUG,d,"["+this.callNumber+"] "+e)}outputStatus(e,t){var n,r;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let i=Object.assign(Object.assign({},e),{progress:t});null===(n=this.listener)||void 0===n||n.onReceiveStatus(i),null===(r=this.onCallEnded)||void 0===r||r.call(this,i.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let n=this.channel.doPick(this.metadata,this.callConfig.pickInformation),l=n.subchannel?"("+n.subchannel.getChannelzRef().id+") "+n.subchannel.getAddress():""+n.subchannel;switch(this.trace("Pick result: "+o.PickResultType[n.pickResultType]+" subchannel: "+l+" status: "+(null===(e=n.status)||void 0===e?void 0:e.code)+" "+(null===(t=n.status)||void 0===t?void 0:t.details)),n.pickResultType){case o.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(e=>{var t,o,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let c=this.metadata.clone();if(c.merge(e),c.get("authorization").length>1&&this.outputStatus({code:i.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new a.Metadata},"PROCESSED"),n.subchannel.getConnectivityState()!==r.ConnectivityState.READY){this.trace("Picked subchannel "+l+" has state "+r.ConnectivityState[n.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&c.set("grpc-timeout",(0,s.getDeadlineTimeoutString)(this.deadline));try{this.child=n.subchannel.getRealSubchannel().createCall(c,this.host,this.methodName,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(e)},onReceiveMessage:e=>{this.trace("Received message"),this.listener.onReceiveMessage(e)},onReceiveStatus:e=>{this.trace("Received status"),e.rstCode===h.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(e,"REFUSED"):this.outputStatus(e,"PROCESSED")}})}catch(e){this.trace("Failed to start call on picked subchannel "+l+" with error "+e.message),this.outputStatus({code:i.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+e.message,metadata:new a.Metadata},"NOT_STARTED");return}null===(o=(t=this.callConfig).onCommitted)||void 0===o||o.call(t),null===(u=n.onCallStarted)||void 0===u||u.call(n),this.onCallEnded=n.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},e=>{let{code:t,details:n}=(0,c.restrictControlPlaneStatusCode)("number"==typeof e.code?e.code:i.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${e.message}`);this.outputStatus({code:t,details:n,metadata:new a.Metadata},"PROCESSED")});break;case o.PickResultType.DROP:let{code:u,details:d}=(0,c.restrictControlPlaneStatusCode)(n.status.code,n.status.details);setImmediate(()=>{this.outputStatus({code:u,details:d,metadata:n.status.metadata},"DROP")});break;case o.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:e,details:t}=(0,c.restrictControlPlaneStatusCode)(n.status.code,n.status.details);setImmediate(()=>{this.outputStatus({code:e,details:t,metadata:n.status.metadata},"PROCESSED")})}break;case o.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var n;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null===(n=this.child)||void 0===n||n.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new a.Metadata},"PROCESSED")}getPeer(){var e,t;return null!==(t=null===(e=this.child)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}t.LoadBalancingCall=f},42130:(e,t,n)=>{"use strict";var r,i,s,a;Object.defineProperty(t,"__esModule",{value:!0}),t.isTracerEnabled=t.trace=t.log=t.setLoggerVerbosity=t.setLogger=t.getLogger=void 0;let o=n(18584),l=n(77282),u=n(9932).i8,c={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},h=o.LogVerbosity.ERROR;switch((null!==(i=null!==(r=process.env.GRPC_NODE_VERBOSITY)&&void 0!==r?r:process.env.GRPC_VERBOSITY)&&void 0!==i?i:"").toUpperCase()){case"DEBUG":h=o.LogVerbosity.DEBUG;break;case"INFO":h=o.LogVerbosity.INFO;break;case"ERROR":h=o.LogVerbosity.ERROR;break;case"NONE":h=o.LogVerbosity.NONE}let d=()=>c;t.getLogger=d;let f=e=>{c=e};t.setLogger=f;let p=e=>{h=e};t.setLoggerVerbosity=p;let g=(e,...t)=>{let n;if(e>=h){switch(e){case o.LogVerbosity.DEBUG:n=c.debug;break;case o.LogVerbosity.INFO:n=c.info;break;case o.LogVerbosity.ERROR:n=c.error}n||(n=c.error),n&&n.bind(c)(...t)}};t.log=g;let m=null!==(a=null!==(s=process.env.GRPC_NODE_TRACE)&&void 0!==s?s:process.env.GRPC_TRACE)&&void 0!==a?a:"",y=new Set,v=new Set;for(let e of m.split(","))e.startsWith("-")?v.add(e.substring(1)):y.add(e);let b=y.has("all");function S(e,n,r){T(n)&&(0,t.log)(e,new Date().toISOString()+" | v"+u+" "+l.pid+" | "+n+" | "+r)}function T(e){return!v.has(e)&&(b||y.has(e))}t.trace=S,t.isTracerEnabled=T},57303:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadPackageDefinition=t.makeClientConstructor=void 0;let r=n(48747),i={unary:r.Client.prototype.makeUnaryRequest,server_stream:r.Client.prototype.makeServerStreamRequest,client_stream:r.Client.prototype.makeClientStreamRequest,bidi:r.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function a(e,t,n){n||(n={});class a extends r.Client{}return Object.keys(e).forEach(t=>{let n;if(s(t))return;let r=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");n=r.requestStream?r.responseStream?"bidi":"client_stream":r.responseStream?"server_stream":"unary";let l=r.requestSerialize,u=r.responseDeserialize,c=o(i[n],r.path,l,u);a.prototype[t]=c,Object.assign(a.prototype[t],r),r.originalName&&!s(r.originalName)&&(a.prototype[r.originalName]=a.prototype[t])}),a.service=e,a.serviceName=t,a}function o(e,t,n,r){return function(...i){return e.call(this,t,n,r,...i)}}function l(e){return"format"in e}function u(e){let t={};for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let r=e[n],i=n.split(".");if(i.some(e=>s(e)))continue;let o=i[i.length-1],u=t;for(let e of i.slice(0,-1))u[e]||(u[e]={}),u=u[e];l(r)?u[o]=r:u[o]=a(r,o,{})}return t}t.makeClientConstructor=a,t.loadPackageDefinition=u},93958:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MaxMessageSizeFilterFactory=t.MaxMessageSizeFilter=void 0;let r=n(44023),i=n(18584),s=n(16535);class a extends r.BaseFilter{constructor(e){super(),this.maxSendMessageSize=i.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=i.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}async sendMessage(e){if(-1===this.maxSendMessageSize)return e;{let t=await e;if(!(t.message.length>this.maxSendMessageSize))return t;throw{code:i.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new s.Metadata}}}async receiveMessage(e){if(-1===this.maxReceiveMessageSize)return e;{let t=await e;if(!(t.length>this.maxReceiveMessageSize))return t;throw{code:i.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new s.Metadata}}}}t.MaxMessageSizeFilter=a;class o{constructor(e){this.options=e}createFilter(){return new a(this.options)}}t.MaxMessageSizeFilterFactory=o},16535:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;let r=n(42130),i=n(18584),s=n(13471),a=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function l(e){return a.test(e)}function u(e){return o.test(e)}function c(e){return e.endsWith("-bin")}function h(e){return!e.startsWith("grpc-")}function d(e){return e.toLowerCase()}function f(e,t){if(!l(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t){if(c(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!u(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}}class p{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){f(e=d(e),t),this.internalRepr.set(e,[t])}add(e,t){f(e=d(e),t);let n=this.internalRepr.get(e);void 0===n?this.internalRepr.set(e,[t]):n.push(t)}remove(e){e=d(e),this.internalRepr.delete(e)}get(e){return e=d(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,n]of this.internalRepr)if(n.length>0){let r=n[0];e[t]=Buffer.isBuffer(r)?Buffer.from(r):r}return e}clone(){let e=new p(this.options),t=e.internalRepr;for(let[e,n]of this.internalRepr){let r=n.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,r)}return e}merge(e){for(let[t,n]of e.internalRepr){let e=(this.internalRepr.get(t)||[]).concat(n);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,n]of this.internalRepr)e[t]=n.map(g);return e}toJSON(){let e={};for(let[t,n]of this.internalRepr)e[t]=n;return e}static fromHttp2Headers(e){let t=new p;for(let n of Object.keys(e)){if(":"===n.charAt(0))continue;let a=e[n];try{c(n)?Array.isArray(a)?a.forEach(e=>{t.add(n,Buffer.from(e,"base64"))}):void 0!==a&&(h(n)?a.split(",").forEach(e=>{t.add(n,Buffer.from(e.trim(),"base64"))}):t.add(n,Buffer.from(a,"base64"))):Array.isArray(a)?a.forEach(e=>{t.add(n,e)}):void 0!==a&&t.add(n,a)}catch(t){let e=`Failed to add metadata entry ${n}: ${a}. ${(0,s.getErrorMessage)(t)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,r.log)(i.LogVerbosity.ERROR,e)}}return t}}t.Metadata=p;let g=e=>Buffer.isBuffer(e)?e.toString("base64"):e},40937:(e,t,n)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.QueuePicker=t.UnavailablePicker=t.PickResultType=void 0;let i=n(16535),s=n(18584);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(r||(t.PickResultType=r={}));class a{constructor(e){this.status=Object.assign({code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata},e)}pick(e){return{pickResultType:r.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}t.UnavailablePicker=a;class o{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:r.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}t.QueuePicker=o},91442:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let r=n(5520),i=n(9523),s=n(73837),a=n(601),o=n(18584),l=n(16535),u=n(42130),c=n(18584),h=n(36699),d=n(41808),f=n(71241),p="dns_resolver";function g(e){u.trace(c.LogVerbosity.DEBUG,p,e)}let m=443,y=3e4,v=s.promisify(i.resolveTxt),b=s.promisify(i.lookup);function S(...e){let t=[];for(let n=0;n<Math.max.apply(null,e.map(e=>e.length));n++)for(let r of e)n<r.length&&t.push(r[n]);return t}class T{constructor(e,t,n){var r,i,s;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,g("Resolver constructed for target "+(0,h.uriToString)(e));let a=(0,h.splitHostPort)(e.path);null===a?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,d.isIPv4)(a.host)||(0,d.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:null!==(r=a.port)&&void 0!==r?r:m}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=null!==(i=a.port)&&void 0!==i?i:m),this.percentage=100*Math.random(),1===n["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:o.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata};let u={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoff=new f.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},u),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!==(s=n["grpc.dns_min_time_between_resolutions_ms"])&&void 0!==s?s:y,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(g("Returning IP address for target "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)g("Failed to parse DNS address "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:o.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;g("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=b(e,{all:!0}),this.pendingLookupPromise.then(e=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let t=e.filter(e=>4===e.family),n=e.filter(e=>6===e.family);this.latestLookupResult=S(n,t).map(e=>({host:e.address,port:+this.port}));let r="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";if(g("Resolved addresses for target "+(0,h.uriToString)(this.target)+": "+r),0===this.latestLookupResult.length){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{null!==this.pendingLookupPromise&&(g("Resolution error for target "+(0,h.uriToString)(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=v(e),this.pendingTxtPromise.then(e=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,a.extractAndSelectServiceConfig)(e,this.percentage)}catch(e){this.latestServiceConfigError={code:o.Status.UNAVAILABLE,details:`Parsing service config failed with error ${e.message}`,metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},e=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null===(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)||void 0===t?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?g('resolution update delayed by "min time between resolutions" rate limit'):g("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}}function w(){(0,r.registerResolver)("dns",T),(0,r.registerDefaultScheme)("dns")}t.setup=w},78852:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let r=n(41808),i=n(18584),s=n(16535),a=n(5520),o=n(36699),l=n(42130),u="ip_resolver";function c(e){l.trace(i.LogVerbosity.DEBUG,u,e)}let h="ipv4",d="ipv6",f=443;class p{constructor(e,t,n){var a;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,c("Resolver constructed for target "+(0,o.uriToString)(e));let l=[];if(!(e.scheme===h||e.scheme===d)){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(let t of e.path.split(",")){let n=(0,o.splitHostPort)(t);if(null===n||e.scheme===h&&!(0,r.isIPv4)(n.host)||e.scheme===d&&!(0,r.isIPv6)(n.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:n.host,port:null!==(a=n.port)&&void 0!==a?a:f})}this.addresses=l,c("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}}function g(){(0,a.registerResolver)(h,p),(0,a.registerResolver)(d,p)}t.setup=g},38337:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let r=n(5520);class i{constructor(e,t,n){let r;this.listener=t,this.addresses=[],r=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:r}]}updateResolution(){process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{})}destroy(){}static getDefaultAuthority(e){return"localhost"}}function s(){(0,r.registerResolver)("unix",i)}t.setup=s},5520:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapUriDefaultScheme=t.getDefaultAuthority=t.createResolver=t.registerDefaultScheme=t.registerResolver=void 0;let r=n(36699),i={},s=null;function a(e,t){i[e]=t}function o(e){s=e}function l(e,t,n){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,n);throw Error(`No resolver could be created for target ${(0,r.uriToString)(e)}`)}function u(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${(0,r.uriToString)(e)}`)}function c(e){return void 0!==e.scheme&&e.scheme in i?e:null!==s?{scheme:s,authority:void 0,path:(0,r.uriToString)(e)}:null}t.registerResolver=a,t.registerDefaultScheme=o,t.createResolver=l,t.getDefaultAuthority=u,t.mapUriDefaultScheme=c},21582:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingCall=void 0;let r=n(18584),i=n(4491),s=n(16535),a=n(42130),o=n(22547),l="resolving_call";class u{constructor(e,t,n,s,a,o){this.channel=e,this.method=t,this.filterStackFactory=s,this.credentials=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=n.deadline,this.host=n.host,n.parentCall&&(n.flags&r.Propagate.CANCELLATION&&n.parentCall.on("cancelled",()=>{this.cancelWithStatus(r.Status.CANCELLED,"Cancelled by parent call")}),n.flags&r.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+n.parentCall.getDeadline()),this.deadline=(0,i.minDeadline)(this.deadline,n.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){a.trace(r.LogVerbosity.DEBUG,l,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,i.deadlineToString)(this.deadline));let e=(0,i.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(r.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{var e;null===(e=this.listener)||void 0===e||e.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw Error("sendMessageonChild called with child not populated");let n=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(t=>{this.writeFilterPending=!1,n.sendMessageWithContext(e,t.message),this.pendingHalfClose&&n.halfClose()},e=>{this.cancelWithStatus(e.code,e.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if("NONE"===e.type){this.channel.queueCallForConfig(this);return}if("ERROR"===e.type){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==r.Status.OK){let{code:e,details:n}=(0,o.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:e,details:n,metadata:new s.Metadata});return}if(t.methodConfig.timeout){let e=new Date;e.setSeconds(e.getSeconds()+t.methodConfig.timeout.seconds),e.setMilliseconds(e.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,i.minDeadline)(this.deadline,e),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(e=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(e,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(e))},onReceiveMessage:e=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(e).then(e=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(e),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},e=>{this.cancelWithStatus(e.code,e.details)})},onReceiveStatus:e=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=e:this.outputStatus(e)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},e=>{this.outputStatus(e)})}reportResolverError(e){var t;(null===(t=this.metadata)||void 0===t?void 0:t.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var n;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null===(n=this.child)||void 0===n||n.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new s.Metadata})}getPeer(){var e,t;return null!==(t=null===(e=this.child)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}}t.ResolvingCall=u},54255:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingLoadBalancer=void 0;let r=n(29480),i=n(601),s=n(92916),a=n(5520),o=n(40937),l=n(71241),u=n(18584),c=n(16535),h=n(42130),d=n(18584),f=n(36699),p=n(37253),g="resolving_load_balancer";function m(e){h.trace(d.LogVerbosity.DEBUG,g,e)}let y=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function v(e,t,n,r){for(let i of n.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===e&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===e&&i.method===t)return!0}return!1}function b(e,t,n,r){for(let i of n)if(v(e,t,i,r))return i;return null}function S(e){return function(t,n){var r,i;let s=t.split("/").filter(e=>e.length>0),a=null!==(r=s[0])&&void 0!==r?r:"",o=null!==(i=s[1])&&void 0!==i?i:"";if(e&&e.methodConfig)for(let t of y){let n=b(a,o,e.methodConfig,t);if(n)return{methodConfig:n,pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}}class T{constructor(e,t,n,h,d){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=h,this.onFailedResolution=d,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,n["grpc.service_config"]?this.defaultServiceConfig=(0,i.validateServiceConfig)(JSON.parse(n["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new o.QueuePicker(this)),this.childLoadBalancer=new p.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(m("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,a.createResolver)(e,{onSuccessfulResolution:(e,t,n,i,s)=>{var a;this.backoffTimeout.stop(),this.backoffTimeout.reset();let o=null;null===t?null===n?(this.previousServiceConfig=null,o=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(n):o=this.previousServiceConfig:(o=t,this.previousServiceConfig=t);let l=null!==(a=null==o?void 0:o.loadBalancingConfig)&&void 0!==a?a:[],h=(0,r.getFirstUsableConfig)(l,!0);if(null===h){this.handleResolutionFailure({code:u.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new c.Metadata});return}this.childLoadBalancer.updateAddressList(e,h,s);let d=null!=o?o:this.defaultServiceConfig;this.onSuccessfulResolution(d,null!=i?i:S(d))},onError:e=>{this.handleResolutionFailure(e)}},n);let f={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},f),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new o.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){m((0,f.uriToString)(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new o.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new o.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}t.ResolvingLoadBalancer=T},69794:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryingCall=t.MessageBufferTracker=t.RetryThrottler=void 0;let r=n(18584),i=n(16535),s=n(42130),a="retrying_call";class o{constructor(e,t,n){this.maxTokens=e,this.tokenRatio=t,n?this.tokens=n.tokens*(e/n.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}t.RetryThrottler=o;class l{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var n;let r=null!==(n=this.allocatedPerCall.get(t))&&void 0!==n?n:0;return!(this.limitPerCall-r<e)&&!(this.totalLimit-this.totalAllocated<e)&&(this.allocatedPerCall.set(t,r+e),this.totalAllocated+=e,!0)}free(e,t){var n;if(this.totalAllocated<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let r=null!==(n=this.allocatedPerCall.get(t))&&void 0!==n?n:0;if(r<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${r}`);this.allocatedPerCall.set(t,r-e)}freeAll(e){var t;let n=null!==(t=this.allocatedPerCall.get(e))&&void 0!==t?t:0;if(this.totalAllocated<n)throw Error(`Invalid buffer allocation state: call ${e} allocated ${n} > total allocated ${this.totalAllocated}`);this.totalAllocated-=n,this.allocatedPerCall.delete(e)}}t.MessageBufferTracker=l;let u="grpc-previous-rpc-attempts";class c{constructor(e,t,n,r,i,s,a,o,l){if(this.channel=e,this.callConfig=t,this.methodName=n,this.host=r,this.credentials=i,this.deadline=s,this.callNumber=a,this.bufferTracker=o,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let e=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(e.initialBackoff.substring(0,e.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){s.trace(r.LogVerbosity.DEBUG,a,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;null===(t=this.listener)||void 0===t||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){for(let{call:n}of(this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new i.Metadata}),this.underlyingCalls))n.cancelWithStatus(e,t)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return null!==(t=this.writeBuffer[e-this.writeBufferOffset])&&void 0!==t?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let e=this.getBufferEntry(t);e.allocated&&this.bufferTracker.free(e.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[e].state){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&"COMPLETED"!==this.underlyingCalls[t].state&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(r.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let e=-1,t=-1;for(let[n,r]of this.underlyingCalls.entries())"ACTIVE"===r.state&&r.nextMessageToSend>e&&(e=r.nextMessageToSend,t=n);-1===t?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(e=>e===t||e.toString().toLowerCase()===r.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=null===(e=this.callConfig)||void 0===e?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let n=Math.random()*this.nextRetryBackoffSec*1e3,r=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,r),n}maybeRetryCall(e,t){let n;if("RETRY"!==this.state){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}if(null===e)n=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else n=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var e,n;if("RETRY"!==this.state){t(!1);return}(null===(n=null===(e=this.retryThrottler)||void 0===e?void 0:e.canRetryCall())||void 0===n||n)&&(t(!0),this.attempts+=1,this.startNewAttempt())},n)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)(null==t?void 0:t.state)==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,n){var r,i,s;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList(null!==(r=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)&&void 0!==r?r:[],e.code)){let r;if(null===(i=this.retryThrottler)||void 0===i||i.addCallFailed(),null===n)r=0;else if(n<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else r=n;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(t),this.reportStatus(e))},r)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?(null===(s=this.retryThrottler)||void 0===s||s.addCallFailed(),this.maybeRetryCall(n,n=>{n||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e))}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(0===t.length)return null;try{return parseInt(t[0])}catch(e){return -1}}handleChildStatus(e,t){var n;if("COMPLETED"===this.underlyingCalls[t].state)return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===r.Status.OK){null===(n=this.retryThrottler)||void 0===n||n.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if("COMMITTED"===this.state){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,n;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let r=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(r.maxAttempts,5))return;let i=null!==(e=r.hedgingDelay)&&void 0!==e?e:"0s",s=Number(i.substring(0,i.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*s),null===(n=(t=this.hedgingTimer).unref)||void 0===n||n.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let n=this.attempts-1,r=this.initialMetadata.clone();n>0&&r.set(u,`${n}`);let i=!1;e.start(r,{onReceiveMetadata:r=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),i=!0,n>0&&r.set(u,`${n}`),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMetadata(r)},onReceiveMessage:n=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMessage(n)},onReceiveStatus:r=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!i&&n>0&&r.metadata.set(u,`${n}`),this.handleChildStatus(r,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,n;let r=this.underlyingCalls[e],i=r.nextMessageToSend;null===(n=(t=this.getBufferEntry(i)).callback)||void 0===n||n.call(t),this.clearSentMessages(),r.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if("COMPLETED"!==t.state&&this.getBufferEntry(t.nextMessageToSend)){let n=this.getBufferEntry(t.nextMessageToSend);switch(n.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:t=>{this.handleChildWriteCompleted(e)}},n.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose()}}}sendMessageWithContext(e,t){var n;this.trace("write() called with message of length "+t.length);let r={message:t,flags:e.flags},i=this.getNextBufferIndex(),s={entryType:"MESSAGE",message:r,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(s),s.allocated)for(let[r,s]of(null===(n=e.callback)||void 0===n||n.call(e),this.underlyingCalls.entries()))"ACTIVE"===s.state&&s.nextMessageToSend===i&&s.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(r)}},t);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let n=this.underlyingCalls[this.committedCallIndex];s.callback=e.callback,"ACTIVE"===n.state&&n.nextMessageToSend===i&&n.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){for(let e of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==e?void 0:e.state)==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();for(let t of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==t?void 0:t.state)==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}t.RetryingCall=c},32359:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2ServerCallStream=t.ServerDuplexStreamImpl=t.ServerWritableStreamImpl=t.ServerReadableStreamImpl=t.ServerUnaryCallImpl=void 0;let r=n(82361),i=n(85158),s=n(12781),a=n(59796),o=n(73837),l=n(18584),u=n(16535),c=n(16499),h=n(42130),d=n(13471),f="server_call",p=(0,o.promisify)(a.unzip),g=(0,o.promisify)(a.inflate);function m(e){h.trace(l.LogVerbosity.DEBUG,f,e)}let y="grpc-message",v="grpc-status",b="grpc-timeout",S=/(\d{1,8})\s*([HMSmun])/,T={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},w={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},C={[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},E={waitForTrailers:!0};class I extends r.EventEmitter{constructor(e,t,n){super(),this.call=e,this.metadata=t,this.request=n,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerUnaryCallImpl=I;class _ extends s.Readable{constructor(e,t,n,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=n,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,r)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerReadableStreamImpl=_;class k extends s.Writable{constructor(e,t,n,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=n,this.request=r,this.cancelled=!1,this.trailingMetadata=new u.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,n){try{let t=this.call.serializeMessage(e);if(!this.call.write(t)){this.call.once("drain",n);return}}catch(e){this.emit("error",{details:(0,d.getErrorMessage)(e),code:l.Status.INTERNAL})}n()}_final(e){this.call.sendStatus({code:l.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerWritableStreamImpl=k;class D extends s.Duplex{constructor(e,t,n,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=n,this.deserialize=r,this.cancelled=!1,this.trailingMetadata=new u.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerDuplexStreamImpl=D,D.prototype._read=_.prototype._read,D.prototype._write=k.prototype._write,D.prototype._final=k.prototype._final;class R extends r.EventEmitter{constructor(e,t,n){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=l.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=l.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{var e;m("Request to method "+(null===(e=this.handler)||void 0===e?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:l.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in n&&(this.maxSendMessageSize=n["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in n&&(this.maxReceiveMessageSize=n["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return"deflate"===t?g(e.subarray(5)):"gzip"===t?p(e.subarray(5)):"identity"===t?e.subarray(5):Promise.reject({code:l.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,n=Object.assign(Object.assign(Object.assign({},C),w),t);this.stream.respond(n,E)}receiveMetadata(e){let t=u.Metadata.fromHttp2Headers(e);h.isTracerEnabled(f)&&m("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let n=t.get(b);if(n.length>0){let e=n[0].toString().match(S);if(null===e){let e=Error("Invalid deadline");return e.code=l.Status.OUT_OF_RANGE,this.sendError(e),t}let r=+e[1]*T[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+r),this.deadlineTimer=setTimeout(A,r,this),t.remove(b)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,n)=>{let{stream:r}=this,i=0,s=this,a=[],o=this.maxReceiveMessageSize;function u(e){if(i+=e.byteLength,-1!==o&&i>o){r.removeListener("data",u),r.removeListener("end",c),r.removeListener("error",c),n({code:l.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${i} vs. ${o})`});return}a.push(e)}function c(o){if(r.removeListener("data",u),r.removeListener("end",c),r.removeListener("error",c),void 0!==o){n({code:l.Status.INTERNAL,details:o.message});return}if(0===i){n({code:l.Status.INTERNAL,details:"received empty unary message"});return}s.emit("receiveMessage");let h=Buffer.concat(a,i),d=1===h.readUInt8(0)?e:"identity",f=s.getDecompressedMessage(h,d);if(Buffer.isBuffer(f)){t(s.deserializeMessageWithInternalError(f));return}f.then(e=>t(s.deserializeMessageWithInternalError(e)),t=>n(t.code?t:{code:l.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}this.stream.on("data",u),this.stream.on("end",c),this.stream.on("error",c)})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(e){throw{details:(0,d.getErrorMessage)(e),code:l.Status.INTERNAL}}}serializeMessage(e){let t=this.handler.serialize(e),n=t.byteLength,r=Buffer.allocUnsafe(n+5);return r.writeUInt8(0,0),r.writeUInt32BE(n,1),t.copy(r,5),r}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,n,r){if(!this.checkCancelled()){if(void 0===n&&(n=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&n&&(e.metadata=n),this.sendError(e);return}try{let e=this.serializeMessage(t);this.write(e),this.sendStatus({code:l.Status.OK,details:"OK",metadata:n})}catch(e){this.sendError({details:(0,d.getErrorMessage)(e),code:l.Status.INTERNAL})}}}sendStatus(e){var t,n;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===l.Status.OK),!this.checkCancelled()){if(m("Request to method "+(null===(t=this.handler)||void 0===t?void 0:t.path)+" ended with status code: "+l.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var t;let n=Object.assign({[v]:e.code,[y]:encodeURI(e.details)},null===(t=e.metadata)||void 0===t?void 0:t.toHttp2Headers());this.stream.sendTrailers(n),this.statusSent=!0}),this.stream.end());else{let t=Object.assign(Object.assign({[v]:e.code,[y]:encodeURI(e.details)},C),null===(n=e.metadata)||void 0===n?void 0:n.toHttp2Headers());this.stream.respond(t,{endStream:!0}),this.statusSent=!0}}}sendError(e){let t={code:l.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(-1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize){this.sendError({code:l.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let n=new c.StreamDecoder,r=!1,i=!1,s=!1,a=async()=>{s||!r||i||(s=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async r=>{let s=n.write(r);for(let n of(i=!0,this.stream.pause(),s)){if(-1!==this.maxReceiveMessageSize&&n.length>this.maxReceiveMessageSize){this.sendError({code:l.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${n.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let r=1===n.readUInt8(0)?t:"identity",i=await this.getDecompressedMessage(n,r);if(!i)return;await this.pushOrBufferMessage(e,i)}i=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{r=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),n=e.push(t);if(null===t||!1===n){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){m("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}m("Received message of length "+t.length),this.isPushPending=!0;try{let n=await this.deserializeMessage(t);this.canPush?e.push(n)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(n)}catch(n){this.bufferedMessages.length=0;let t=(0,d.getErrorCode)(n);(null===t||t<l.Status.OK||t>l.Status.UNAUTHENTICATED)&&(t=l.Status.INTERNAL),e.emit("error",{details:(0,d.getErrorMessage)(n),code:t})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){var e;let t=null===(e=this.stream.session)||void 0===e?void 0:e.socket;return null!=t&&t.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function A(e){let t=Error("Deadline exceeded");t.code=l.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}t.Http2ServerCallStream=R},40618:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerCredentials=void 0;let r=n(60998);class i{static createInsecure(){return new s}static createSsl(e,t,n=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof n)throw TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let e=0;e<t.length;e++){let n=t[e];if(null===n||"object"!=typeof n)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(n.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(n.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(n.cert_chain),s.push(n.private_key)}return new a({ca:e||(0,r.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:n,ciphers:r.CIPHER_SUITES})}}t.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class a extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},16681:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Server=void 0;let r=n(85158),i=n(18584),s=n(32359),a=n(40618),o=n(5520),l=n(42130),u=n(21916),c=n(36699),h=n(64061),d=2147483647,f=2147483647,p=2e4,{HTTP2_HEADER_PATH:g}=r.constants,m="server";function y(){}function v(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function b(e,t){let n=v(t);switch(e){case"unary":return(e,t)=>{t(n,null)};case"clientStream":return(e,t)=>{t(n,null)};case"serverStream":return e=>{e.emit("error",n)};case"bidi":return e=>{e.emit("error",n)};default:throw Error(`Invalid handlerType ${e}`)}}class S{constructor(e){var t,n,r,i;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new h.ChannelzTrace,this.callTracker=new h.ChannelzCallTracker,this.listenerChildrenTracker=new h.ChannelzChildrenTracker,this.sessionChildrenTracker=new h.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,h.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!==(t=this.options["grpc.max_connection_age_ms"])&&void 0!==t?t:d,this.maxConnectionAgeGraceMs=null!==(n=this.options["grpc.max_connection_age_grace_ms"])&&void 0!==n?n:d,this.keepaliveTimeMs=null!==(r=this.options["grpc.keepalive_time_ms"])&&void 0!==r?r:f,this.keepaliveTimeoutMs=null!==(i=this.options["grpc.keepalive_timeout_ms"])&&void 0!==i?i:p,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,n,r;let i;let s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,u.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,u.stringToSubchannelAddress)(a.localAddress,a.localPort):null;if(e.encrypted){let e=a,n=e.getCipher(),r=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!==(t=n.standardName)&&void 0!==t?t:null,cipherSuiteOtherName:n.standardName?null:n.name,localCertificate:r&&"raw"in r?r.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:o,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(n=e.state.localWindowSize)&&void 0!==n?n:null,remoteFlowControlWindow:null!==(r=e.state.remoteWindowSize)&&void 0!==r?r:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");let n=Object.keys(e);if(0===n.length)throw Error("Cannot add an empty service to a server");n.forEach(n=>{let r,i;let s=e[n];r=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let a=t[n];if(void 0===a&&"string"==typeof s.originalName&&(a=t[s.originalName]),i=void 0!==a?a.bind(t):b(r,n),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,r))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{let n=e[t];this.unregister(n.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,n){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof a.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof n)throw TypeError("callback must be a function");let s=(0,c.parseUri)(e);if(null===s)throw Error(`Could not parse port "${e}"`);let d=(0,o.mapUriDefaultScheme)(s);if(null===d)throw Error(`Could not get a default scheme for port "${e}"`);let f={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?f.maxSessionMemory=this.options["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(f.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let p=(e,t)=>{process.nextTick(()=>n(e,t))},g=()=>{let e;if(t._isSecure()){let n=Object.assign(f,t._getSettings());n.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(e=r.createSecureServer(n)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=r.createServer(f);return e.setTimeout(0,y),this._setupHandlers(e),e},m=(e,t,n)=>0===e.length?Promise.resolve({port:t,count:n}):Promise.all(e.map(e=>{let n;this.trace("Attempting to bind "+(0,u.subchannelAddressToString)(e)),n=(0,u.isTcpSubchannelAddress)(e)?{host:e.host,port:t}:e;let r=g();return new Promise((i,s)=>{let a=t=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(e)+" with error "+t.message),i(t)};r.once("error",a),r.listen(n,()=>{let e;if(this.shutdown){r.close(),i(Error("bindAsync failed because server is shutdown"));return}let n=r.address();e="string"==typeof n?{path:n}:{host:n.address,port:n.port};let s=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(s),this.http2ServerList.push({server:r,channelzRef:s}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(e)),i("port"in e?e.port:t),r.removeListener("error",a)})})})).then(e=>{let r=0;for(let n of e)if("number"==typeof n&&(r+=1,n!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:r+n}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});let t=e[0],n=g();return new Promise((r,i)=>{let s=n=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(t)+" with error "+n.message),r(v(e.slice(1)))};n.once("error",s),n.listen(t,()=>{if(this.shutdown){n.close(),r({port:0,count:0});return}let t=n.address(),i={host:t.address,port:t.port},a=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(i),()=>({localAddress:i,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(a),this.http2ServerList.push({server:n,channelzRef:a}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(i)),r(m(e.slice(1),t.port,1)),n.removeListener("error",s)})})},b={onSuccessfulResolution:(t,n,r)=>{let s;if(b.onSuccessfulResolution=()=>{},this.shutdown&&p(Error("bindAsync failed because server is shutdown"),0),0===t.length){p(Error(`No addresses resolved for port ${e}`),0);return}(s=(0,u.isTcpSubchannelAddress)(t[0])?0===t[0].port?v(t):m(t,t[0].port,0):m(t,1,0)).then(e=>{if(0===e.count){let e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),p(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),p(null,e.port)},e=>{let n=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,n),p(Error(n),0)})},onError:e=>{p(Error(e.details),0)}};(0,o.createResolver)(d,b,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(r.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef)}register(e,t,n,r,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:n,deserialize:r,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef),e(t)},n=0;function r(){0==--n&&t()}for(let{server:e,channelzRef:t}of(this.started=!1,this.shutdown=!0,this.http2ServerList))e.listening&&(n++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t)),r()}));this.sessions.forEach((e,t)=>{t.closed||(n+=1,t.close(r))}),0===n&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let n=t[r.constants.HTTP2_HEADER_CONTENT_TYPE];return!!("string"==typeof n&&n.startsWith("application/grpc"))||(e.respond({[r.constants.HTTP2_HEADER_STATUS]:r.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return void 0===t?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,n=null){let r=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==n||n.streamTracker.addCallFailed()),r.sendError(e)}_channelzHandler(e,t){let n=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==n||n.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==n||n.streamTracker.addCallFailed();return}let r=t[g],a=this._retrieveHandler(r);if(!a){this._respondWithError(v(r),e,n);return}let o=new s.Http2ServerCallStream(e,a,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),n&&(o.once("streamEnd",e=>{e?n.streamTracker.addCallSucceeded():n.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{n.messagesSent+=1,n.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{n.messagesReceived+=1,n.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,a,t)||(this.callTracker.addCallFailed(),null==n||n.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${a.type}`}))}_streamHandler(e,t){if(!0!==this._verifyContentType(e,t))return;let n=t[g],r=this._retrieveHandler(n);if(!r){this._respondWithError(v(n),e,null);return}let a=new s.Http2ServerCallStream(e,r,this.options);this._runHandlerForCall(a,r,t)||a.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${r.type}`})}_runHandlerForCall(e,t,n){var r;let i=e.receiveMetadata(n),s=null!==(r=i.get("grpc-encoding")[0])&&void 0!==r?r:"identity";i.remove("grpc-encoding");let{type:a}=t;if("unary"===a)T(e,t,i,s);else if("clientStream"===a)w(e,t,i,s);else if("serverStream"===a)C(e,t,i,s);else{if("bidi"!==a)return!1;E(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),n="null";t&&(n="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=n;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",e=>{var t,n,i,s,a;if(!this.started){e.destroy();return}let o=(0,h.registerChannelzSocket)(null!==(t=e.socket.remoteAddress)&&void 0!==t?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),l={ref:o,streamTracker:new h.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,l);let u=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+u),this.sessionChildrenTracker.refChild(o));let c=null,f=null,p=!1;if(this.maxConnectionAgeMs!==d){let t=this.maxConnectionAgeMs/10,s=Math.random()*t*2-t;c=null===(i=(n=setTimeout(()=>{var t,n;p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+u);try{e.goaway(r.constants.NGHTTP2_NO_ERROR,2147483647,Buffer.from("max_age"))}catch(t){e.destroy();return}e.close(),this.maxConnectionAgeGraceMs!==d&&(f=null===(n=(t=setTimeout(()=>{e.destroy()},this.maxConnectionAgeGraceMs)).unref)||void 0===n?void 0:n.call(t))},this.maxConnectionAgeMs+s)).unref)||void 0===i?void 0:i.call(n)}let g=null===(a=(s=setInterval(()=>{var t,n;let r=null===(n=(t=setTimeout(()=>{p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+u),e.close()},this.keepaliveTimeoutMs)).unref)||void 0===n?void 0:n.call(t);try{e.ping((e,t,n)=>{clearTimeout(r)})}catch(t){e.destroy()}},this.keepaliveTimeMs)).unref)||void 0===a?void 0:a.call(s);e.on("close",()=>{this.channelzEnabled&&(p||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+u),this.sessionChildrenTracker.unrefChild(o),(0,h.unregisterChannelzRef)(o)),c&&clearTimeout(c),f&&clearTimeout(f),g&&clearTimeout(g),this.sessions.delete(e)})})}}async function T(e,t,n,r){try{let i=await e.receiveUnaryMessage(r);if(void 0===i||e.cancelled)return;let a=new s.ServerUnaryCallImpl(e,n,i);t.func(a,(t,n,r,i)=>{e.sendUnaryMessage(t,n,r,i)})}catch(t){e.sendError(t)}}function w(e,t,n,r){let i=new s.ServerReadableStreamImpl(e,n,t.deserialize,r);function a(t,n,r,s){i.destroy(),e.sendUnaryMessage(t,n,r,s)}e.cancelled||(i.on("error",a),t.func(i,a))}async function C(e,t,n,r){try{let i=await e.receiveUnaryMessage(r);if(void 0===i||e.cancelled)return;let a=new s.ServerWritableStreamImpl(e,n,t.serialize,i);t.func(a)}catch(t){e.sendError(t)}}function E(e,t,n,r){let i=new s.ServerDuplexStreamImpl(e,n,t.serialize,t.deserialize,r);e.cancelled||t.func(i)}t.Server=S},601:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractAndSelectServiceConfig=t.validateServiceConfig=t.validateRetryThrottling=void 0;let r=n(22037),i=n(18584),s=n(29480),a=/^\d+(\.\d{1,9})?s$/,o="node";function l(e){if("service"in e&&""!==e.service){if("string"!=typeof e.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof e.service}`);if(!("method"in e)||""===e.method)return{service:e.service};if("string"!=typeof e.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof e.service}`);return{service:e.service,method:e.method}}if("method"in e&&void 0!==e.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function u(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in e)||"string"!=typeof e.initialBackoff||!a.test(e.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in e)||"string"!=typeof e.maxBackoff||!a.test(e.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in e)||"number"!=typeof e.backoffMultiplier||e.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in e&&Array.isArray(e.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===e.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let t of e.retryableStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:e.maxAttempts,initialBackoff:e.initialBackoff,maxBackoff:e.maxBackoff,backoffMultiplier:e.backoffMultiplier,retryableStatusCodes:e.retryableStatusCodes}}function c(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in e&&("string"!=typeof e.hedgingDelay||!a.test(e.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in e&&Array.isArray(e.nonFatalStatusCodes))for(let t of e.nonFatalStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let t={maxAttempts:e.maxAttempts};return e.hedgingDelay&&(t.hedgingDelay=e.hedgingDelay),e.nonFatalStatusCodes&&(t.nonFatalStatusCodes=e.nonFatalStatusCodes),t}function h(e){var t;let n={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(let t of e.name)n.name.push(l(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");n.waitForReady=e.waitForReady}if("timeout"in e){if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");n.timeout=e.timeout}else if("string"==typeof e.timeout&&a.test(e.timeout)){let r=e.timeout.substring(0,e.timeout.length-1).split(".");n.timeout={seconds:0|r[0],nanos:(null!==(t=r[1])&&void 0!==t?t:0)|0}}else throw Error("Invalid method config: invalid timeout")}if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");n.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");n.maxResponseBytes=e.maxResponseBytes}if("retryPolicy"in e){if("hedgingPolicy"in e)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");n.retryPolicy=u(e.retryPolicy)}else"hedgingPolicy"in e&&(n.hedgingPolicy=c(e.hedgingPolicy));return n}function d(e){if(!("maxTokens"in e)||"number"!=typeof e.maxTokens||e.maxTokens<=0||e.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in e)||"number"!=typeof e.tokenRatio||e.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+e.maxTokens.toFixed(3),tokenRatio:+e.tokenRatio.toFixed(3)}}function f(e){let t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e){if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy")}if("loadBalancingConfig"in e){if(Array.isArray(e.loadBalancingConfig))for(let n of e.loadBalancingConfig)t.loadBalancingConfig.push((0,s.validateLoadBalancingConfig)(n));else throw Error("Invalid service config: invalid loadBalancingConfig")}if("methodConfig"in e&&Array.isArray(e.methodConfig))for(let n of e.methodConfig)t.methodConfig.push(h(n));"retryThrottling"in e&&(t.retryThrottling=d(e.retryThrottling));let n=[];for(let e of t.methodConfig)for(let t of e.name){for(let e of n)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);n.push(t)}return t}function p(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");let t={serviceConfig:f(e.serviceConfig)};if("clientLanguage"in e){if(Array.isArray(e.clientLanguage))for(let n of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof n)t.clientLanguage.push(n);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage")}if("clientHostname"in e){if(Array.isArray(e.clientHostname))for(let n of(t.clientHostname=[],e.clientHostname))if("string"==typeof n)t.clientHostname.push(n);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname")}if("percentage"in e){if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage")}let n=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let t in e)if(!n.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function g(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(let n of e){let e=p(n);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(let n of e.clientHostname)n===r.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(let n of e.clientLanguage)n===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}function m(e,t){for(let n of e)if(n.length>0&&n[0].startsWith("grpc_config="))return g(JSON.parse(n.join("").substring(12)),t);return null}t.validateRetryThrottling=d,t.validateServiceConfig=f,t.extractAndSelectServiceConfig=m},27680:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusBuilder=void 0;class n{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}t.StatusBuilder=n},16499:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(n||(n={}));class r{constructor(){this.readState=n.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,r=0,i=[];for(;r<e.length;)switch(this.readState){case n.NO_DATA:this.readCompressFlag=e.slice(r,r+1),r+=1,this.readState=n.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case n.READING_SIZE:if(t=Math.min(e.length-r,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,r,r+t),this.readSizeRemaining-=t,r+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=n.READING_MESSAGE;else{let e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=n.NO_DATA,i.push(e)}}break;case n.READING_MESSAGE:if(t=Math.min(e.length-r,this.readMessageRemaining),this.readPartialMessage.push(e.slice(r,r+t)),this.readMessageRemaining-=t,r+=t,0===this.readMessageRemaining){let e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=n.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}t.StreamDecoder=r},21916:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringToSubchannelAddress=t.subchannelAddressToString=t.subchannelAddressEqual=t.isTcpSubchannelAddress=void 0;let r=n(41808);function i(e){return"port"in e}function s(e,t){return!e&&!t||!!e&&!!t&&(i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path)}function a(e){return i(e)?e.host+":"+e.port:e.path}t.isTcpSubchannelAddress=i,t.subchannelAddressEqual=s,t.subchannelAddressToString=a;let o=443;function l(e,t){return(0,r.isIP)(e)?{host:e,port:null!=t?t:o}:{path:e}}t.stringToSubchannelAddress=l},72972:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelCall=void 0;let r=n(85158),i=n(22037),s=n(18584),a=n(16535),o=n(16499),l=n(42130),u=n(18584),c="subchannel_call";function h(e){for(let[t,n]of Object.entries(i.constants.errno))if(n===e)return t;return"Unknown system error "+e}class d{constructor(e,t,n,i,l){this.http2Stream=e,this.callEventTracker=t,this.listener=n,this.transport=i,this.callId=l,this.decoder=new o.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,e.on("response",(e,t)=>{let n="";for(let t of Object.keys(e))n+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+n),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&r.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=a.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new a.Metadata});return}this.listener.onReceiveMetadata(t)}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{if(!this.statusOutput)for(let t of(this.trace("receive HTTP/2 data frame of length "+e.length),this.decoder.write(e)))this.trace("parsed message of length "+t.length),this.callEventTracker.addMessageReceived(),this.tryPush(t)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var t;let n;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null===(t=this.finalStatus)||void 0===t?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case r.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;n=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case r.constants.NGHTTP2_REFUSED_STREAM:n=s.Status.UNAVAILABLE,i="Stream refused by server";break;case r.constants.NGHTTP2_CANCEL:n=s.Status.CANCELLED,i="Call cancelled";break;case r.constants.NGHTTP2_ENHANCE_YOUR_CALM:n=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case r.constants.NGHTTP2_INADEQUATE_SECURITY:n=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case r.constants.NGHTTP2_INTERNAL_ERROR:n=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(n=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:n=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:n,details:i,metadata:new a.Metadata,rstCode:e.rstCode})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+h(e.errno)+" syscall="+e.syscall),this.internalError=e),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new a.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){l.trace(u.LogVerbosity.DEBUG,c,"["+this.callId+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===s.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){let t;this.callEventTracker.onStreamEnd(!0);let n="";for(let t of Object.keys(e))n+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+n);try{t=a.Metadata.fromHttp2Headers(e)}catch(e){t=new a.Metadata}let r=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof r["grpc-status"]){let e=Number(r["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let o="";if("string"==typeof r["grpc-message"]){try{o=decodeURI(r["grpc-message"])}catch(e){o=r["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let l={code:i,details:o,metadata:t};this.endCall(l)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;t=(null===(e=this.finalStatus)||void 0===e?void 0:e.code)===s.Status.OK?r.constants.NGHTTP2_NO_ERROR:r.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new a.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let n=t=>{process.nextTick(()=>{var n;let r=s.Status.UNAVAILABLE;(null==t?void 0:t.code)==="ERR_STREAM_WRITE_AFTER_END"&&(r=s.Status.INTERNAL),t&&this.cancelWithStatus(r,`Write error: ${t.message}`),null===(n=e.callback)||void 0===n||n.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,n)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new a.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}t.Http2SubchannelCall=d},23348:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseSubchannelWrapper=void 0;class n{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}}t.BaseSubchannelWrapper=n},98344:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSubchannelPool=t.SubchannelPool=void 0;let r=n(6377),i=n(33337),s=n(21916),a=n(36699),o=n(41689),l=1e4;class u{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let n=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());n.length>0&&(e=!1),this.pool[t]=n}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},l),null===(t=(e=this.cleanupTimer).unref)||void 0===t||t.call(e))}getOrCreateSubchannel(e,t,n,l){this.ensureCleanupTask();let u=(0,a.uriToString)(e);if(u in this.pool){for(let e of this.pool[u])if((0,s.subchannelAddressEqual)(t,e.subchannelAddress)&&(0,r.channelOptionsEqual)(n,e.channelArguments)&&l._equals(e.channelCredentials))return e.subchannel}let c=new i.Subchannel(e,t,n,l,new o.Http2SubchannelConnector(e));return u in this.pool||(this.pool[u]=[]),this.pool[u].push({subchannelAddress:t,channelArguments:n,channelCredentials:l,subchannel:c}),c.ref(),c}}t.SubchannelPool=u;let c=new u;function h(e){return e?c:new u}t.getSubchannelPool=h},33337:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subchannel=void 0;let r=n(92916),i=n(71241),s=n(42130),a=n(18584),o=n(36699),l=n(21916),u=n(64061),c="subchannel",h=2147483647;class d{constructor(e,t,n,s,a){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=n,this.credentials=s,this.connector=a,this.connectivityState=r.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new u.ChannelzCallTracker,this.childrenTracker=new u.ChannelzChildrenTracker,this.streamTracker=new u.ChannelzCallTracker;let c={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.handleBackoffTimer()},c),this.backoffTimeout.unref(),this.subchannelAddressString=(0,l.subchannelAddressToString)(t),this.keepaliveTime=null!==(o=n["grpc.keepalive_time_ms"])&&void 0!==o?o:-1,0===n["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new u.ChannelzTrace,this.channelzRef=(0,u.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(n,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){s.trace(a.LogVerbosity.DEBUG,c,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){s.trace(a.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([r.ConnectivityState.TRANSIENT_FAILURE],r.ConnectivityState.CONNECTING):this.transitionToState([r.ConnectivityState.TRANSIENT_FAILURE],r.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,h);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(e=>{this.transitionToState([r.ConnectivityState.CONNECTING],r.ConnectivityState.READY)&&(this.transport=e,this.channelzEnabled&&this.childrenTracker.refChild(e.getChannelzRef()),e.addDisconnectListener(e=>{this.transitionToState([r.ConnectivityState.READY],r.ConnectivityState.IDLE),e&&this.keepaliveTime>0&&(this.keepaliveTime*=2,s.log(a.LogVerbosity.ERROR,`Connection to ${(0,o.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))}))},e=>{this.transitionToState([r.ConnectivityState.CONNECTING],r.ConnectivityState.TRANSIENT_FAILURE,`${e}`)})}transitionToState(e,t,n){var i,s;if(-1===e.indexOf(this.connectivityState))return!1;this.trace(r.ConnectivityState[this.connectivityState]+" -> "+r.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+r.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case r.ConnectivityState.READY:this.stopBackoff();break;case r.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case r.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(i=this.transport)||void 0===i||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case r.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(s=this.transport)||void 0===s||s.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let e of this.stateListeners)e(this,a,t,this.keepaliveTime,n);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,u.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([r.ConnectivityState.CONNECTING,r.ConnectivityState.READY],r.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(e,t,n,r){let i;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),i={onCallEnd:e=>{e.code===a.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):i={},this.transport.createCall(e,t,n,r,i)}startConnecting(){process.nextTick(()=>{this.transitionToState([r.ConnectivityState.IDLE],r.ConnectivityState.CONNECTING)||this.connectivityState!==r.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([r.ConnectivityState.TRANSIENT_FAILURE],r.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}}t.Subchannel=d},60998:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultRootsData=t.CIPHER_SUITES=void 0;let r=n(57147);t.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;function a(){return i?(null===s&&(s=r.readFileSync(i)),s):null}t.getDefaultRootsData=a},41689:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelConnector=void 0;let r=n(85158),i=n(24404),s=n(64061),a=n(18584),o=n(30914),l=n(42130),u=n(5520),c=n(21916),h=n(36699),d=n(41808),f=n(72972),p=n(63680),g="transport",m="transport_flowctrl",y=n(9932).i8,{HTTP2_HEADER_AUTHORITY:v,HTTP2_HEADER_CONTENT_TYPE:b,HTTP2_HEADER_METHOD:S,HTTP2_HEADER_PATH:T,HTTP2_HEADER_TE:w,HTTP2_HEADER_USER_AGENT:C}=r.constants,E=2e4,I=Buffer.from("too_many_pings","ascii");class _{constructor(e,t,n,i){this.session=e,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=E,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new s.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,c.subchannelAddressToString)(t),0===n["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,s.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[n["grpc.primary_user_agent"],`grpc-node-js/${y}`,n["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in n&&(this.keepaliveTimeMs=n["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in n&&(this.keepaliveTimeoutMs=n["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in n?this.keepaliveWithoutCalls=1===n["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(e,t,n)=>{let i=!1;e===r.constants.NGHTTP2_ENHANCE_YOUR_CALM&&n.equals(I)&&(i=!0),this.trace("connection closed by GOAWAY with code "+e),this.reportDisconnectToOwner(i)}),e.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(g)&&(e.on("remoteSettings",t=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))}),e.on("localSettings",t=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,n;let r;let i=this.session.socket,s=i.remoteAddress?(0,c.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,c.stringToSubchannelAddress)(i.localAddress,i.localPort):null;if(this.session.encrypted){let t=i,n=t.getCipher(),s=t.getCertificate(),a=t.getPeerCertificate();r={cipherSuiteStandardName:null!==(e=n.standardName)&&void 0!==e?e:null,cipherSuiteOtherName:n.standardName?null:n.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:a&&"raw"in a?a.raw:null}}else r=null;return{remoteAddress:s,localAddress:a,security:r,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(t=this.session.state.localWindowSize)&&void 0!==t?t:null,remoteFlowControlWindow:null!==(n=this.session.state.remoteWindowSize)&&void 0!==n?n:null}}trace(e){l.trace(a.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(a.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(a.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(a.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null===(t=(e=this.keepaliveTimeoutId).unref)||void 0===t||t.call(e));try{this.session.ping((e,t,n)=>{e&&(this.keepaliveTrace("Ping failed with error "+e.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(e){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null===(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)||void 0===t?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),0===this.activeCalls.size&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),1!==this.activeCalls.size||(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,n,r,i){let s,a,o;let l=e.toHttp2Headers();l[v]=t,l[C]=this.userAgent,l[b]="application/grpc",l[S]="POST",l[T]=n,l[w]="trailers";try{s=this.session.request(l)}catch(e){throw this.handleDisconnect(),e}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),a={addMessageSent:()=>{var e;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null===(e=i.addMessageSent)||void 0===e||e.call(i)},addMessageReceived:()=>{var e;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null===(e=i.addMessageReceived)||void 0===e||e.call(i)},onCallEnd:e=>{var t;null===(t=i.onCallEnd)||void 0===t||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null===(t=i.onStreamEnd)||void 0===t||t.call(i,e)}}):a={addMessageSent:()=>{var e;null===(e=i.addMessageSent)||void 0===e||e.call(i)},addMessageReceived:()=>{var e;null===(e=i.addMessageReceived)||void 0===e||e.call(i)},onCallEnd:e=>{var t;null===(t=i.onCallEnd)||void 0===t||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;null===(t=i.onStreamEnd)||void 0===t||t.call(i,e)}},o=new f.Http2SubchannelCall(s,a,r,this,(0,p.getNextCallNumber)()),this.addActiveCall(o),o}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,s.unregisterChannelzRef)(this.channelzRef)}}class k{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){l.trace(a.LogVerbosity.DEBUG,g,(0,h.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,n,s){return this.isShutdown?Promise.reject():new Promise((a,o)=>{var l,f,p;let g;s.realTarget?(g=(0,h.uriToString)(s.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,h.uriToString)(s.realTarget))):(g=null,this.trace("creating HTTP/2 session to "+(0,c.subchannelAddressToString)(e)));let m=(0,u.getDefaultAuthority)(null!==(l=s.realTarget)&&void 0!==l?l:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in n?y.maxSessionMemory=n["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in y){if(v="https://",n["grpc.ssl_target_name_override"]){let e=n["grpc.ssl_target_name_override"];y.checkServerIdentity=(t,n)=>(0,i.checkServerIdentity)(e,n),y.servername=e}else{let e=null!==(p=null===(f=(0,h.splitHostPort)(m))||void 0===f?void 0:f.host)&&void 0!==p?p:"localhost";y.servername=e}s.socket&&(y.createConnection=(e,t)=>s.socket)}else y.createConnection=(t,n)=>s.socket?s.socket:d.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:1===n["grpc-node.tls_enable_trace"]});let b=r.connect(v+m,y);this.session=b;let S="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),a(new _(b,e,n,g)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{o(`${S} (${new Date().toISOString()})`)})}),b.once("error",e=>{S=e.message,this.trace("connection failed with error "+S)})})}connect(e,t,n){var r,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],n["grpc.ssl_target_name_override"]){let e=n["grpc.ssl_target_name_override"];a.checkServerIdentity=(t,n)=>(0,i.checkServerIdentity)(e,n),a.servername=e}else if("grpc.http_connect_target"in n){let e=(0,u.getDefaultAuthority)(null!==(r=(0,h.parseUri)(n["grpc.http_connect_target"]))&&void 0!==r?r:{path:"localhost"}),t=(0,h.splitHostPort)(e);a.servername=null!==(s=null==t?void 0:t.host)&&void 0!==s?s:e}n["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,o.getProxiedConnection)(e,n,a).then(r=>this.createSession(e,t,n,r))}shutdown(){var e;this.isShutdown=!0,null===(e=this.session)||void 0===e||e.close(),this.session=null}}t.Http2SubchannelConnector=k},36699:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uriToString=t.splitHostPort=t.parseUri=void 0;let n=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function r(e){let t=n.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}}t.parseUri=r;let i=/^\d+$/;function s(e){if(e.startsWith("[")){let t=e.indexOf("]");if(-1===t)return null;let n=e.substring(1,t);if(-1===n.indexOf(":"))return null;if(!(e.length>t+1))return{host:n};if(":"!==e[t+1])return null;{let r=e.substring(t+2);return i.test(r)?{host:n,port:+r}:null}}{let t=e.split(":");return 2!==t.length?{host:e}:i.test(t[1])?{host:t[0],port:+t[1]}:null}}function a(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}t.splitHostPort=s,t.uriToString=a},9256:(e,t,n)=>{"use strict";var r;/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */r={value:!0},r=r=r=t.J_=r=r=r=void 0;let i=n(33737),s=n(44487),a=n(26829),o=n(58849);r=n(29143),r=function(e){return"@type"in e&&"string"==typeof e["@type"]};let l={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function u(e,t){return""===e?t:e+"."+t}function c(e){return e instanceof s.Service||e instanceof s.Type||e instanceof s.Enum}function h(e){return e instanceof s.Namespace||e instanceof s.Root}function d(e,t){let n=u(t,e.name);return c(e)?[[n,e]]:h(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>d(e.nested[t],n)).reduce((e,t)=>e.concat(t),[]):[]}function f(e,t){return function(n){return e.toObject(e.decode(n),t)}}function p(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let n=e.fromObject(t);return e.encode(n).finish()}}function g(e,t,n,r){let s=e.resolvedRequestType,a=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:p(s),requestDeserialize:f(s,n),responseSerialize:p(a),responseDeserialize:f(a,n),originalName:i(e.name),requestType:y(s,r),responseType:y(a,r)}}function m(e,t,n,r){let i={};for(let s of e.methodsArray)i[s.name]=g(s,t,n,r);return i}function y(e,t){let n=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:n.$type.toObject(n,l),fileDescriptorProtos:t}}function v(e,t){let n=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:n.$type.toObject(n,l),fileDescriptorProtos:t}}function b(e,t,n,r){if(e instanceof s.Service)return m(e,t,n,r);if(e instanceof s.Type)return y(e,r);if(e instanceof s.Enum)return v(e,r);throw Error("Type mismatch in reflection object handling")}function S(e,t){let n={};e.resolveAll();let r=e.toDescriptor("proto3").file.map(e=>Buffer.from(a.FileDescriptorProto.encode(e).finish()));for(let[i,s]of d(e,""))n[i]=b(s,i,t,r);return n}function T(e,t){t=t||{};let n=s.Root.fromDescriptor(e);return n.resolveAll(),S(n,t)}function w(e,t){return S((0,o.loadProtosWithOptionsSync)(e,t),t)}r=function(e,t){return(0,o.loadProtosWithOptions)(e,t).then(e=>S(e,t))},t.J_=w,r=function(e,t){t=t||{};let n=s.Root.fromJSON(e);return n.resolveAll(),S(n,t)},r=function(e,t){return T(a.FileDescriptorSet.decode(e),t)},r=function(e,t){return T(a.FileDescriptorSet.fromObject(e),t)},(0,o.addCommonProtos)()},58849:(e,t,n)=>{"use strict";/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */Object.defineProperty(t,"__esModule",{value:!0}),t.addCommonProtos=t.loadProtosWithOptionsSync=t.loadProtosWithOptions=void 0;let r=n(57147),i=n(71017),s=n(44487);function a(e,t){let n=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return r.accessSync(t,r.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),n(e,s)}}async function o(e,t){let n=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));a(n,t.includeDirs)}let r=await n.load(e,t);return r.resolveAll(),r}function l(e,t){let n=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");a(n,t.includeDirs)}let r=n.loadSync(e,t);return r.resolveAll(),r}function u(){let e=n(38710),t=n(48311),r=n(57535),i=n(93255);s.common("api",e.nested.google.nested.protobuf.nested),s.common("descriptor",t.nested.google.nested.protobuf.nested),s.common("source_context",r.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}t.loadProtosWithOptions=o,t.loadProtosWithOptionsSync=l,t.addCommonProtos=u},35623:e=>{"use strict";function t(e,t){for(var n=Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,a){n[r]=function(e){if(s){if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}}};try{e.apply(t||null,n)}catch(e){s&&(s=!1,a(e))}})}e.exports=t},53779:(e,t)=>{"use strict";var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var r=Array(64),i=Array(123),s=0;s<64;)i[r[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;n.encode=function(e,t,n){for(var i,s=null,a=[],o=0,l=0;t<n;){var u=e[t++];switch(l){case 0:a[o++]=r[u>>2],i=(3&u)<<4,l=1;break;case 1:a[o++]=r[i|u>>4],i=(15&u)<<2,l=2;break;case 2:a[o++]=r[i|u>>6],a[o++]=r[63&u],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return(l&&(a[o++]=r[i],a[o++]=61,1===l&&(a[o++]=61)),s)?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var a="invalid encoding";n.decode=function(e,t,n){for(var r,s=n,o=0,l=0;l<e.length;){var u=e.charCodeAt(l++);if(61===u&&o>1)break;if(void 0===(u=i[u]))throw Error(a);switch(o){case 0:r=u,o=1;break;case 1:t[n++]=r<<2|(48&u)>>4,r=u,o=2;break;case 2:t[n++]=(15&r)<<4|(60&u)>>2,r=u,o=3;break;case 3:t[n++]=(3&r)<<6|u,o=0}}if(1===o)throw Error(a);return n-s},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},97117:e=>{"use strict";function t(e,n){"string"==typeof e&&(n=e,e=void 0);var r=[];function i(e){if("string"!=typeof e){var n=s();if(t.verbose&&console.log("codegen: "+n),n="return "+n,e){for(var a=Object.keys(e),o=Array(a.length+1),l=Array(a.length),u=0;u<a.length;)o[u]=a[u],l[u]=e[a[u++]];return o[u]=n,Function.apply(null,o).apply(null,l)}return Function(n)()}for(var c=Array(arguments.length-1),h=0;h<c.length;)c[h]=arguments[++h];if(h=0,e=e.replace(/%([%dfijs])/g,function(e,t){var n=c[h++];switch(t){case"d":case"f":return String(Number(n));case"i":return String(Math.floor(n));case"j":return JSON.stringify(n);case"s":return String(n)}return"%"}),h!==c.length)throw Error("parameter count mismatch");return r.push(e),i}function s(t){return"function "+(t||n||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return i.toString=s,i}e.exports=t,t.verbose=!1},78068:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},92066:(e,t,n)=>{"use strict";e.exports=s;var r=n(35623),i=n(21018)("fs");function s(e,t,n){return("function"==typeof t?(n=t,t={}):t||(t={}),n)?!t.xhr&&i&&i.readFile?i.readFile(e,function(r,i){return r&&"undefined"!=typeof XMLHttpRequest?s.xhr(e,t,n):r?n(r):n(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,n):r(s,this,e,t)}s.xhr=function(e,t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState){if(0!==r.status&&200!==r.status)return n(Error("status "+r.status));if(t.binary){var e=r.response;if(!e){e=[];for(var i=0;i<r.responseText.length;++i)e.push(255&r.responseText.charCodeAt(i))}return n(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return n(null,r.responseText)}},t.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",e),r.send()}},41894:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function s(e,r,i){t[0]=e,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function a(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function o(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?i:s,e.writeFloatBE=r?s:i,e.readFloatLE=r?a:o,e.readFloatBE=r?o:a}():function(){function t(e,t,n,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var s=Math.floor(Math.log(t)/Math.LN2),a=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|a)>>>0,n,r)}}function a(e,t,n){var r=e(t,n),i=(r>>31)*2+1,s=r>>>23&255,a=8388607&r;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,n),e.writeFloatBE=t.bind(null,r),e.readFloatLE=a.bind(null,i),e.readFloatBE=a.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function s(e,r,i){t[0]=e,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function a(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function o(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:s,e.writeDoubleBE=r?s:i,e.readDoubleLE=r?a:o,e.readDoubleBE=r?o:a}():function(){function t(e,t,n,r,i,s){var a,o=r<0?1:0;if(o&&(r=-r),0===r)e(0,i,s+t),e(1/r>0?0:2147483648,i,s+n);else if(isNaN(r))e(0,i,s+t),e(2146959360,i,s+n);else if(r>17976931348623157e292)e(0,i,s+t),e((o<<31|2146435072)>>>0,i,s+n);else if(r<22250738585072014e-324)e((a=r/5e-324)>>>0,i,s+t),e((o<<31|a/4294967296)>>>0,i,s+n);else{var l=Math.floor(Math.log(r)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(a=r*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+n)}}function a(e,t,n,r,i){var s=e(r,i+t),a=e(r,i+n),o=(a>>31)*2+1,l=a>>>20&2047,u=4294967296*(1048575&a)+s;return 2047===l?u?NaN:1/0*o:0===l?5e-324*o*u:o*Math.pow(2,l-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,n,0,4),e.writeDoubleBE=t.bind(null,r,4,0),e.readDoubleLE=a.bind(null,i,0,4),e.readDoubleBE=a.bind(null,s,4,0)}(),e}function n(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function r(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},21018:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},65111:(e,t)=>{"use strict";var n=t,r=n.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},i=n.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),n=r(e),i="";n&&(i=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):n?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return i+t.join("/")};n.resolve=function(e,t,n){return(n||(t=i(t)),r(t))?t:(n||(e=i(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?i(e+"/"+t):t)}},53173:e=>{"use strict";function t(e,t,n){var r=n||8192,i=r>>>1,s=null,a=r;return function(n){if(n<1||n>i)return e(n);a+n>r&&(s=e(r),a=0);var o=t.call(s,a,a+=n);return 7&a&&(a=(7|a)+1),o}}e.exports=t},5481:(e,t)=>{"use strict";var n=t;n.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:(64512&n)==55296&&(64512&e.charCodeAt(r+1))==56320?(++r,t+=4):t+=3;return t},n.read=function(e,t,n){if(n-t<1)return"";for(var r,i=null,s=[],a=0;t<n;)(r=e[t++])<128?s[a++]=r:r>191&&r<224?s[a++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(r>>10),s[a++]=56320+(1023&r)):s[a++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},n.write=function(e,t,n){for(var r,i,s=n,a=0;a<e.length;++a)(r=e.charCodeAt(a))<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(r=65536+((1023&r)<<10)+(1023&i),++a,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-s}},33737:e=>{var t=1/0,n="[object Symbol]",r=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,i=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,s="\ud800-\udfff",a="\\u0300-\\u036f\\ufe20-\\ufe23",o="\\u20d0-\\u20f0",l="\\u2700-\\u27bf",u="a-z\\xdf-\\xf6\\xf8-\\xff",c="A-Z\\xc0-\\xd6\\xd8-\\xde",h="\\ufe0e\\ufe0f",d="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",f="['â€™]",p="["+s+"]",g="["+d+"]",m="["+a+o+"]",y="\\d+",v="["+l+"]",b="["+u+"]",S="[^"+s+d+y+l+u+c+"]",T="\ud83c[\udffb-\udfff]",w="[^"+s+"]",C="(?:\ud83c[\udde6-\uddff]){2}",E="[\ud800-\udbff][\udc00-\udfff]",I="["+c+"]",_="\\u200d",k="(?:"+b+"|"+S+")",D="(?:"+I+"|"+S+")",R="(?:"+f+"(?:d|ll|m|re|s|t|ve))?",A="(?:"+f+"(?:D|LL|M|RE|S|T|VE))?",x="(?:"+m+"|"+T+")?",N="["+h+"]?",O="(?:"+_+"(?:"+[w,C,E].join("|")+")"+N+x+")*",M=N+x+O,P="(?:"+[v,C,E].join("|")+")"+M,L="(?:"+[w+m+"?",m,C,E,p].join("|")+")",B=RegExp(f,"g"),F=RegExp(m,"g"),j=RegExp(T+"(?="+T+")|"+L+M,"g"),U=RegExp([I+"?"+b+"+"+R+"(?="+[g,I,"$"].join("|")+")",D+"+"+A+"(?="+[g,I+k,"$"].join("|")+")",I+"?"+k+"+"+R,I+"+"+A,y,P].join("|"),"g"),V=RegExp("["+_+s+a+o+h+"]"),q=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,z={Ã€:"A",Ã:"A",Ã‚:"A",Ãƒ:"A",Ã„:"A",Ã…:"A",Ã :"a",Ã¡:"a",Ã¢:"a",Ã£:"a",Ã¤:"a",Ã¥:"a",Ã‡:"C",Ã§:"c",Ã:"D",Ã°:"d",Ãˆ:"E",Ã‰:"E",ÃŠ:"E",Ã‹:"E",Ã¨:"e",Ã©:"e",Ãª:"e",Ã«:"e",ÃŒ:"I",Ã:"I",ÃŽ:"I",Ã:"I",Ã¬:"i",Ã­:"i",Ã®:"i",Ã¯:"i",Ã‘:"N",Ã±:"n",Ã’:"O",Ã“:"O",Ã”:"O",Ã•:"O",Ã–:"O",Ã˜:"O",Ã²:"o",Ã³:"o",Ã´:"o",Ãµ:"o",Ã¶:"o",Ã¸:"o",Ã™:"U",Ãš:"U",Ã›:"U",Ãœ:"U",Ã¹:"u",Ãº:"u",Ã»:"u",Ã¼:"u",Ã:"Y",Ã½:"y",Ã¿:"y",Ã†:"Ae",Ã¦:"ae",Ãž:"Th",Ã¾:"th",ÃŸ:"ss",Ä€:"A",Ä‚:"A",Ä„:"A",Ä:"a",Äƒ:"a",Ä…:"a",Ä†:"C",Äˆ:"C",ÄŠ:"C",ÄŒ:"C",Ä‡:"c",Ä‰:"c",Ä‹:"c",Ä:"c",ÄŽ:"D",Ä:"D",Ä:"d",Ä‘:"d",Ä’:"E",Ä”:"E",Ä–:"E",Ä˜:"E",Äš:"E",Ä“:"e",Ä•:"e",Ä—:"e",Ä™:"e",Ä›:"e",Äœ:"G",Äž:"G",Ä :"G",Ä¢:"G",Ä:"g",ÄŸ:"g",Ä¡:"g",Ä£:"g",Ä¤:"H",Ä¦:"H",Ä¥:"h",Ä§:"h",Ä¨:"I",Äª:"I",Ä¬:"I",Ä®:"I",Ä°:"I",Ä©:"i",Ä«:"i",Ä­:"i",Ä¯:"i",Ä±:"i",Ä´:"J",Äµ:"j",Ä¶:"K",Ä·:"k",Ä¸:"k",Ä¹:"L",Ä»:"L",Ä½:"L",Ä¿:"L",Å:"L",Äº:"l",Ä¼:"l",Ä¾:"l",Å€:"l",Å‚:"l",Åƒ:"N",Å…:"N",Å‡:"N",ÅŠ:"N",Å„:"n",Å†:"n",Åˆ:"n",Å‹:"n",ÅŒ:"O",ÅŽ:"O",Å:"O",Å:"o",Å:"o",Å‘:"o",Å”:"R",Å–:"R",Å˜:"R",Å•:"r",Å—:"r",Å™:"r",Åš:"S",Åœ:"S",Åž:"S",Å :"S",Å›:"s",Å:"s",ÅŸ:"s",Å¡:"s",Å¢:"T",Å¤:"T",Å¦:"T",Å£:"t",Å¥:"t",Å§:"t",Å¨:"U",Åª:"U",Å¬:"U",Å®:"U",Å°:"U",Å²:"U",Å©:"u",Å«:"u",Å­:"u",Å¯:"u",Å±:"u",Å³:"u",Å´:"W",Åµ:"w",Å¶:"Y",Å·:"y",Å¸:"Y",Å¹:"Z",Å»:"Z",Å½:"Z",Åº:"z",Å¼:"z",Å¾:"z",Ä²:"IJ",Ä³:"ij",Å’:"Oe",Å“:"oe",Å‰:"'n",Å¿:"ss"},$="object"==typeof global&&global&&global.Object===Object&&global,G="object"==typeof self&&self&&self.Object===Object&&self,H=$||G||Function("return this")();function K(e,t,n,r){var i=-1,s=e?e.length:0;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function W(e){return e.split("")}function Q(e){return e.match(r)||[]}var Y=function(e){return function(t){return null==e?void 0:e[t]}}(z);function J(e){return V.test(e)}function X(e){return q.test(e)}function Z(e){return J(e)?ee(e):W(e)}function ee(e){return e.match(j)||[]}function et(e){return e.match(U)||[]}var en=Object.prototype.toString,er=H.Symbol,ei=er?er.prototype:void 0,es=ei?ei.toString:void 0;function ea(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function eo(e){if("string"==typeof e)return e;if(eh(e))return es?es.call(e):"";var n=e+"";return"0"==n&&1/e==-t?"-0":n}function el(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:ea(e,t,n)}function eu(e){return function(t){var n=J(t=ed(t))?Z(t):void 0,r=n?n[0]:t.charAt(0),i=n?el(n,1).join(""):t.slice(1);return r[e]()+i}}function ec(e){return!!e&&"object"==typeof e}function eh(e){return"symbol"==typeof e||ec(e)&&en.call(e)==n}function ed(e){return null==e?"":eo(e)}var ef=function(e){return function(t){return K(ey(eg(t).replace(B,"")),e,"")}}(function(e,t,n){return t=t.toLowerCase(),e+(n?ep(t):t)});function ep(e){return em(ed(e).toLowerCase())}function eg(e){return(e=ed(e))&&e.replace(i,Y).replace(F,"")}var em=eu("toUpperCase");function ey(e,t,n){return(e=ed(e),void 0===(t=n?void 0:t))?X(e)?et(e):Q(e):e.match(t)||[]}e.exports=ef},23215:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createProxy",{enumerable:!0,get:function(){return r}});let r=n(47978).createClientModuleProxy},47978:(e,t,n)=>{"use strict";e.exports=n(56126).vendored["react-rsc"].ReactServerDOMWebpackServerEdge},34371:(e,t,n)=>{"use strict";e.exports=n(30517)},26829:(e,t,n)=>{"use strict";var r=n(44487);e.exports=t=r.descriptor=r.Root.fromJSON(n(48311)).lookup(".google.protobuf");var i=r.Namespace,s=r.Root,a=r.Enum,o=r.Type,l=r.Field,u=r.MapField,c=r.OneOf,h=r.Service,d=r.Method;function f(e,n,r){var u=t.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});r&&(u.syntax=r),e instanceof s||(u.package=e.fullName.substring(1));for(var c,d=0;d<e.nestedArray.length;++d)(c=e._nestedArray[d])instanceof o?u.messageType.push(c.toDescriptor(r)):c instanceof a?u.enumType.push(c.toDescriptor()):c instanceof l?u.extension.push(c.toDescriptor(r)):c instanceof h?u.service.push(c.toDescriptor()):c instanceof i&&f(c,n,r);u.options=E(e.options,t.FileOptions),u.messageType.length+u.enumType.length+u.extension.length+u.service.length&&n.push(u)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.FileDescriptorSet.decode(e));var n=new s;if(e.file)for(var r,i,u,c=0;c<e.file.length;++c){if(i=n,(r=e.file[c]).package&&r.package.length&&(i=n.define(r.package)),r.name&&r.name.length&&n.files.push(i.filename=r.name),r.messageType)for(u=0;u<r.messageType.length;++u)i.add(o.fromDescriptor(r.messageType[u],r.syntax));if(r.enumType)for(u=0;u<r.enumType.length;++u)i.add(a.fromDescriptor(r.enumType[u]));if(r.extension)for(u=0;u<r.extension.length;++u)i.add(l.fromDescriptor(r.extension[u]));if(r.service)for(u=0;u<r.service.length;++u)i.add(h.fromDescriptor(r.service[u]));var d=C(r.options,t.FileOptions);if(d){var f=Object.keys(d);for(u=0;u<f.length;++u)i.setOption(f[u],d[f[u]])}}return n},s.prototype.toDescriptor=function(e){var n=t.FileDescriptorSet.create();return f(this,n.file,e),n};var p=0;o.fromDescriptor=function(e,n){"number"==typeof e.length&&(e=t.DescriptorProto.decode(e));var r,i=new o(e.name.length?e.name:"Type"+p++,C(e.options,t.MessageOptions));if(e.oneofDecl)for(r=0;r<e.oneofDecl.length;++r)i.add(c.fromDescriptor(e.oneofDecl[r]));if(e.field)for(r=0;r<e.field.length;++r){var s=l.fromDescriptor(e.field[r],n);i.add(s),e.field[r].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[r].oneofIndex].add(s)}if(e.extension)for(r=0;r<e.extension.length;++r)i.add(l.fromDescriptor(e.extension[r],n));if(e.nestedType)for(r=0;r<e.nestedType.length;++r)i.add(o.fromDescriptor(e.nestedType[r],n)),e.nestedType[r].options&&e.nestedType[r].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(r=0;r<e.enumType.length;++r)i.add(a.fromDescriptor(e.enumType[r]));if(e.extensionRange&&e.extensionRange.length)for(r=0,i.extensions=[];r<e.extensionRange.length;++r)i.extensions.push([e.extensionRange[r].start,e.extensionRange[r].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(r=0;r<e.reservedRange.length;++r)i.reserved.push([e.reservedRange[r].start,e.reservedRange[r].end]);if(e.reservedName)for(r=0;r<e.reservedName.length;++r)i.reserved.push(e.reservedName[r])}return i},o.prototype.toDescriptor=function(e){var n,r,i=t.DescriptorProto.create({name:this.name});for(r=0;r<this.fieldsArray.length;++r)if(i.field.push(n=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof u){var s=w(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),c=w(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),h=11===c||14===c?this._fieldsArray[r].resolvedType&&I(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;i.nestedType.push(t.DescriptorProto.create({name:n.typeName,field:[t.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),t.FieldDescriptorProto.create({name:"value",number:2,label:1,type:c,typeName:h})],options:t.MessageOptions.create({mapEntry:!0})}))}for(r=0;r<this.oneofsArray.length;++r)i.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof l?i.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof o?i.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof a&&i.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)i.extensionRange.push(t.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)"string"==typeof this.reserved[r]?i.reservedName.push(this.reserved[r]):i.reservedRange.push(t.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return i.options=E(this.options,t.MessageOptions),i};var g=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,n){if("number"==typeof e.length&&(e=t.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(r=e.typeName&&e.typeName.length?e.typeName:S(e.type),e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var r,i,s=e.extendee;void 0!==e.extendee&&(s=s.length?s:void 0);var a=new l(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(a.options=C(e.options,t.FieldOptions),e.defaultValue&&e.defaultValue.length){var o=e.defaultValue;switch(o){case"true":case"TRUE":o=!0;break;case"false":case"FALSE":o=!1;break;default:g.exec(o)&&(o=parseInt(o))}a.setOption("default",o)}return T(e.type)&&("proto3"===n?e.options&&!e.options.packed&&a.setOption("packed",!1):e.options&&e.options.packed||a.setOption("packed",!1)),a},l.prototype.toDescriptor=function(e){var n=t.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)n.type=11,n.typeName=r.util.ucFirst(this.name),n.label=3;else{switch(n.type=w(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:n.typeName=this.resolvedType?I(this.parent,this.resolvedType):this.type}switch(this.rule){case"repeated":n.label=3;break;case"required":n.label=2;break;default:n.label=1}}if(n.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(n.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(n.options=E(this.options,t.FieldOptions),null!=this.options.default&&(n.defaultValue=String(this.options.default))),"proto3"===e?this.packed||((n.options||(n.options=t.FieldOptions.create())).packed=!1):this.packed&&((n.options||(n.options=t.FieldOptions.create())).packed=!0),n};var m=0;a.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.EnumDescriptorProto.decode(e));var n={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;n[i&&i.length?i:"NAME"+s]=s}return new a(e.name&&e.name.length?e.name:"Enum"+m++,n,C(e.options,t.EnumOptions))},a.prototype.toDescriptor=function(){for(var e=[],n=0,r=Object.keys(this.values);n<r.length;++n)e.push(t.EnumValueDescriptorProto.create({name:r[n],number:this.values[r[n]]}));return t.EnumDescriptorProto.create({name:this.name,value:e,options:E(this.options,t.EnumOptions)})};var y=0;c.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.OneofDescriptorProto.decode(e)),new c(e.name&&e.name.length?e.name:"oneof"+y++)},c.prototype.toDescriptor=function(){return t.OneofDescriptorProto.create({name:this.name})};var v=0;h.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.ServiceDescriptorProto.decode(e));var n=new h(e.name&&e.name.length?e.name:"Service"+v++,C(e.options,t.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)n.add(d.fromDescriptor(e.method[r]));return n},h.prototype.toDescriptor=function(){for(var e=[],n=0;n<this.methodsArray.length;++n)e.push(this._methodsArray[n].toDescriptor());return t.ServiceDescriptorProto.create({name:this.name,method:e,options:E(this.options,t.ServiceOptions)})};var b=0;function S(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function T(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function w(e,t){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof a)return 14;if(t instanceof o)return t.group?10:11;throw Error("illegal type: "+e)}function C(e,t){if(e){for(var n,i,s,o=[],l=0;l<t.fieldsArray.length;++l)"uninterpretedOption"!==(i=(n=t._fieldsArray[l]).name)&&e.hasOwnProperty(i)&&(s=e[i],n.resolvedType instanceof a&&"number"==typeof s&&void 0!==n.resolvedType.valuesById[s]&&(s=n.resolvedType.valuesById[s]),o.push(_(i),s));return o.length?r.util.toObject(o):void 0}}function E(e,t){if(e){for(var n,i,s=[],a=0,o=Object.keys(e);a<o.length;++a)if(i=e[n=o[a]],"default"!==n){var l=t.fields[n];(l||(l=t.fields[n=r.util.camelCase(n)]))&&s.push(n,i)}return s.length?t.fromObject(r.util.toObject(s)):void 0}}function I(e,t){var n=e.fullName.split("."),r=t.fullName.split("."),a=0,o=0,l=r.length-1;if(!(e instanceof s)&&t instanceof i)for(;a<n.length&&o<l&&n[a]===r[o];){var u=t.lookup(n[a++],!0);if(null!==u&&u!==t)break;++o}else for(;a<n.length&&o<l&&n[a]===r[o];++a,++o);return r.slice(o).join(".")}function _(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}d.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.MethodDescriptorProto.decode(e)),new d(e.name&&e.name.length?e.name:"Method"+b++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,C(e.options,t.MethodOptions))},d.prototype.toDescriptor=function(){return t.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:E(this.options,t.MethodOptions)})}},44487:(e,t,n)=>{"use strict";e.exports=n(415)},84979:e=>{"use strict";e.exports=r;var t,n=/\/|\./;function r(e,t){n.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),r[e]=t}r("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),r("duration",{Duration:t={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),r("timestamp",{Timestamp:t}),r("empty",{Empty:{fields:{}}}),r("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),r("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),r("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),r.get=function(e){return r[e]||null}},42741:(e,t,n)=>{"use strict";var r=t,i=n(20394),s=n(53133);function a(e,t,n,r){var s=!1;if(t.resolvedType){if(t.resolvedType instanceof i){e("switch(d%s){",r);for(var a=t.resolvedType.values,o=Object.keys(a),l=0;l<o.length;++l)a[o[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),t.repeated||e("break"),s=!0),e("case%j:",o[l])("case %i:",a[o[l]])("m%s=%j",r,a[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',r)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,n,r)}else{var u=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",r,r);break;case"uint64":u=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,u)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,u?"true":"");break;case"bytes":e('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":e("m%s=String(d%s)",r,r);break;case"bool":e("m%s=Boolean(d%s)",r,r)}}return e}function o(e,t,n,r){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,n,r,r,n,r,r):e("d%s=types[%i].toObject(m%s,o)",r,n,r);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,s?"true":"",r);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:e("d%s=m%s",r,r)}}return e}r.fromObject=function(e){var t=e.fieldsArray,n=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return n("return new this.ctor");n("var m=new this.ctor");for(var r=0;r<t.length;++r){var o=t[r].resolve(),l=s.safeProp(o.name);o.map?(n("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(n,o,r,l+"[ks[i]]")("}")("}")):o.repeated?(n("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(n,o,r,l+"[i]")("}")("}")):(o.resolvedType instanceof i||n("if(d%s!=null){",l),a(n,o,r,l),o.resolvedType instanceof i||n("}"))}return n("return m")},r.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var n=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],a=[],l=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?r:t[u].map?a:l).push(t[u]);if(r.length){for(n("if(o.arrays||o.defaults){"),u=0;u<r.length;++u)n("d%s=[]",s.safeProp(r[u].name));n("}")}if(a.length){for(n("if(o.objects||o.defaults){"),u=0;u<a.length;++u)n("d%s={}",s.safeProp(a[u].name));n("}")}if(l.length){for(n("if(o.defaults){"),u=0;u<l.length;++u){var c=l[u],h=s.safeProp(c.name);if(c.resolvedType instanceof i)n("d%s=o.enums===String?%j:%j",h,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)n("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var d="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";n("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else n("d%s=%j",h,c.typeDefault)}n("}")}var f=!1;for(u=0;u<t.length;++u){var c=t[u],p=e._fieldsArray.indexOf(c),h=s.safeProp(c.name);c.map?(f||(f=!0,n("var ks2")),n("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),o(n,c,p,h+"[ks2[j]]")("}")):c.repeated?(n("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),o(n,c,p,h+"[j]")("}")):(n("if(m%s!=null&&m.hasOwnProperty(%j)){",h,c.name),o(n,c,p,h),c.partOf&&n("if(o.oneofs)")("d%s=%j",s.safeProp(c.partOf.name),c.name)),n("}")}return n("return d")}},5606:(e,t,n)=>{"use strict";e.exports=o;var r=n(20394),i=n(6530),s=n(53133);function a(e){return"missing required '"+e.name+"'"}function o(e){var t=s.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var n=0;n<e.fieldsArray.length;++n){var o=e._fieldsArray[n].resolve(),l=o.resolvedType instanceof r?"int32":o.type,u="m"+s.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",n):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),t(void 0!==i.long[o.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",u)):o.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,l)("}else"),void 0===i.basic[l]?t(o.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,n):t("%s.push(r.%s())",u,l)):void 0===i.basic[l]?t(o.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,n):t("%s=r.%s()",u,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var c=e._fieldsArray[n];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",a(c))}return t("return m")}},84812:(e,t,n)=>{"use strict";e.exports=o;var r=n(20394),i=n(6530),s=n(53133);function a(e,t,n,r){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,r,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,r,(t.id<<3|2)>>>0)}function o(e){for(var t,n,o=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var u=l[t].resolve(),c=e._fieldsArray.indexOf(u),h=u.resolvedType instanceof r?"int32":u.type,d=i.basic[h];n="m"+s.safeProp(u.name),u.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",n,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",n)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===d?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,n):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,n),o("}")("}")):u.repeated?(o("if(%s!=null&&%s.length){",n,n),u.packed&&void 0!==i.packed[h]?o("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",n)("w.%s(%s[i])",h,n)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",n),void 0===d?a(o,u,c,n+"[i]"):o("w.uint32(%i).%s(%s[i])",(u.id<<3|d)>>>0,h,n)),o("}")):(u.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",n,u.name),void 0===d?a(o,u,c,n):o("w.uint32(%i).%s(%s)",(u.id<<3|d)>>>0,h,n))}return o("return w")}},20394:(e,t,n)=>{"use strict";e.exports=a;var r=n(23790);((a.prototype=Object.create(r.prototype)).constructor=a).className="Enum";var i=n(76946),s=n(53133);function a(e,t,n,i,s,a){if(r.call(this,e,n),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=a,this.reserved=void 0,t)for(var o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.fromJSON=function(e,t){var n=new a(e,t.values,t.options,t.comment,t.comments);return n.reserved=t.reserved,n},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,n,r){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return r&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=r||null),this.comments[e]=n||null,this},a.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},90233:(e,t,n)=>{"use strict";e.exports=u;var r,i=n(23790);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";var s=n(20394),a=n(6530),o=n(53133),l=/^required|optional|repeated$/;function u(e,t,n,r,s,u,c){if(o.isObject(r)?(c=s,u=r,r=s=void 0):o.isObject(s)&&(c=u,u=s,s=void 0),i.call(this,e,u),!o.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!o.isString(n))throw TypeError("type must be a string");if(void 0!==r&&!l.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");"proto3_optional"===r&&(r="optional"),this.rule=r&&"optional"!==r?r:void 0,this.type=n,this.id=t,this.extend=s||void 0,this.required="required"===r,this.optional=!this.required,this.repeated="repeated"===r,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==a.long[n],this.bytes="bytes"===n,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=c}u.fromJSON=function(e,t){return new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(e,t,n){return"packed"===e&&(this._packed=null),i.prototype.setOption.call(this,e,t,n)},u.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return o.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof r?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;o.base64.test(this.typeDefault)?o.base64.decode(this.typeDefault,e=o.newBuffer(o.base64.length(this.typeDefault)),0):o.utf8.write(this.typeDefault,e=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof r&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.d=function(e,t,n,r){return"function"==typeof t?t=o.decorateType(t).name:t&&"object"==typeof t&&(t=o.decorateEnum(t).name),function(i,s){o.decorateType(i.constructor).add(new u(s,e,t,n,{default:r}))}},u._configure=function(e){r=e}},11758:(e,t,n)=>{"use strict";var r=e.exports=n(3487);function i(e,t,n){return"function"==typeof t?(n=t,t=new r.Root):t||(t=new r.Root),t.load(e,n)}function s(e,t){return t||(t=new r.Root),t.loadSync(e)}r.build="light",r.load=i,r.loadSync=s,r.encoder=n(84812),r.decoder=n(5606),r.verifier=n(73922),r.converter=n(42741),r.ReflectionObject=n(23790),r.Namespace=n(76946),r.Root=n(19504),r.Enum=n(20394),r.Type=n(66024),r.Field=n(90233),r.OneOf=n(59687),r.MapField=n(47271),r.Service=n(70739),r.Method=n(45410),r.Message=n(46469),r.wrappers=n(60329),r.types=n(6530),r.util=n(53133),r.ReflectionObject._configure(r.Root),r.Namespace._configure(r.Type,r.Service,r.Enum),r.Root._configure(r.Type),r.Field._configure(r.Type)},3487:(e,t,n)=>{"use strict";var r=t;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(76555),r.BufferWriter=n(37081),r.Reader=n(1881),r.BufferReader=n(29012),r.util=n(60313),r.rpc=n(40996),r.roots=n(94881),r.configure=i,i()},415:(e,t,n)=>{"use strict";var r=e.exports=n(11758);r.build="full",r.tokenize=n(66303),r.parse=n(93023),r.common=n(84979),r.Root._configure(r.Type,r.parse,r.common)},47271:(e,t,n)=>{"use strict";e.exports=a;var r=n(90233);((a.prototype=Object.create(r.prototype)).constructor=a).className="MapField";var i=n(6530),s=n(53133);function a(e,t,n,i,a,o){if(r.call(this,e,t,i,void 0,void 0,a,o),!s.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return r.prototype.resolve.call(this)},a.d=function(e,t,n){return"function"==typeof n?n=s.decorateType(n).name:n&&"object"==typeof n&&(n=s.decorateEnum(n).name),function(r,i){s.decorateType(r.constructor).add(new a(i,e,t,n))}}},46469:(e,t,n)=>{"use strict";e.exports=i;var r=n(60313);function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)this[t[n]]=e[t[n]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,r.toJSONOptions)}},45410:(e,t,n)=>{"use strict";e.exports=s;var r=n(23790);((s.prototype=Object.create(r.prototype)).constructor=s).className="Method";var i=n(53133);function s(e,t,n,s,a,o,l,u,c){if(i.isObject(a)?(l=a,a=o=void 0):i.isObject(o)&&(l=o,o=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(n))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");r.call(this,e,l),this.type=t||"rpc",this.requestType=n,this.requestStream=!!a||void 0,this.responseType=s,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=c}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),r.prototype.resolve.call(this))}},76946:(e,t,n)=>{"use strict";e.exports=h;var r,i,s,a=n(23790);((h.prototype=Object.create(a.prototype)).constructor=h).className="Namespace";var o=n(90233),l=n(53133),u=n(59687);function c(e,t){if(e&&e.length){for(var n={},r=0;r<e.length;++r)n[e[r].name]=e[r].toJSON(t);return n}}function h(e,t){a.call(this,e,t),this.nested=void 0,this._nestedArray=null}function d(e){return e._nestedArray=null,e}h.fromJSON=function(e,t){return new h(e,t.options).addJSON(t.nested)},h.arrayToJSON=c,h.isReservedId=function(e,t){if(e){for(var n=0;n<e.length;++n)if("string"!=typeof e[n]&&e[n][0]<=t&&e[n][1]>t)return!0}return!1},h.isReservedName=function(e,t){if(e){for(var n=0;n<e.length;++n)if(e[n]===t)return!0}return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),h.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",c(this.nestedArray,e)])},h.prototype.addJSON=function(e){var t=this;if(e)for(var n,a=Object.keys(e),l=0;l<a.length;++l)n=e[a[l]],t.add((void 0!==n.fields?r.fromJSON:void 0!==n.values?s.fromJSON:void 0!==n.methods?i.fromJSON:void 0!==n.id?o.fromJSON:h.fromJSON)(a[l],n));return this},h.prototype.get=function(e){return this.nested&&this.nested[e]||null},h.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},h.prototype.add=function(e){if(!(e instanceof o&&void 0!==e.extend||e instanceof r||e instanceof u||e instanceof s||e instanceof i||e instanceof h))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(t instanceof h&&e instanceof h&&!(t instanceof r||t instanceof i)){for(var n=t.nestedArray,a=0;a<n.length;++a)e.add(n[a]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),d(this)},h.prototype.remove=function(e){if(!(e instanceof a))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),d(this)},h.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var n=this;e.length>0;){var r=e.shift();if(n.nested&&n.nested[r]){if(!((n=n.nested[r])instanceof h))throw Error("path conflicts with non-namespace objects")}else n.add(n=new h(r))}return t&&n.addJSON(t),n},h.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof h?e[t++].resolveAll():e[t++].resolve();return this.resolve()},h.prototype.lookup=function(e,t,n){if("boolean"==typeof t?(n=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var r=this.get(e[0]);if(r){if(1===e.length){if(!t||t.indexOf(r.constructor)>-1)return r}else if(r instanceof h&&(r=r.lookup(e.slice(1),t,!0)))return r}else for(var i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof h&&(r=this._nestedArray[i].lookup(e,t,!0)))return r;return null===this.parent||n?null:this.parent.lookup(e,t)},h.prototype.lookupType=function(e){var t=this.lookup(e,[r]);if(!t)throw Error("no such type: "+e);return t},h.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},h.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[r,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},h.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},h._configure=function(e,t,n){r=e,i=t,s=n}},23790:(e,t,n)=>{"use strict";e.exports=s,s.className="ReflectionObject";var r,i=n(53133);function s(e,t){if(!i.isString(e))throw TypeError("name must be a string");if(t&&!i.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(s.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),s.prototype.toJSON=function(){throw Error()},s.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof r&&t._handleAdd(this)},s.prototype.onRemove=function(e){var t=e.root;t instanceof r&&t._handleRemove(this),this.parent=null,this.resolved=!1},s.prototype.resolve=function(){return this.resolved||this.root instanceof r&&(this.resolved=!0),this},s.prototype.getOption=function(e){if(this.options)return this.options[e]},s.prototype.setOption=function(e,t,n){return n&&this.options&&void 0!==this.options[e]||((this.options||(this.options={}))[e]=t),this},s.prototype.setParsedOption=function(e,t,n){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(n){var s=r.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(s){var a=s[e];i.setProperty(a,n,t)}else(s={})[e]=i.setProperty({},n,t),r.push(s)}else{var o={};o[e]=t,r.push(o)}return this},s.prototype.setOptions=function(e,t){if(e)for(var n=Object.keys(e),r=0;r<n.length;++r)this.setOption(n[r],e[n[r]],t);return this},s.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},s._configure=function(e){r=e}},59687:(e,t,n)=>{"use strict";e.exports=a;var r=n(23790);((a.prototype=Object.create(r.prototype)).constructor=a).className="OneOf";var i=n(90233),s=n(53133);function a(e,t,n,i){if(Array.isArray(t)||(n=t,t=void 0),r.call(this,e,n),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function o(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,o(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){r.prototype.onAdd.call(this,e);for(var t=this,n=0;n<this.oneof.length;++n){var i=e.get(this.oneof[n]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}o(this)},a.prototype.onRemove=function(e){for(var t,n=0;n<this.fieldsArray.length;++n)(t=this.fieldsArray[n]).parent&&t.parent.remove(t);r.prototype.onRemove.call(this,e)},a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,n){s.decorateType(t.constructor).add(new a(n,e)),Object.defineProperty(t,n,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},93023:(e,t,n)=>{"use strict";e.exports=E,E.filename=null,E.defaults={keepCase:!1};var r=n(66303),i=n(19504),s=n(66024),a=n(90233),o=n(47271),l=n(59687),u=n(20394),c=n(70739),h=n(45410),d=n(6530),f=n(53133),p=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,m=/^0[x][0-9a-fA-F]+$/,y=/^-?0[x][0-9a-fA-F]+$/,v=/^0[0-7]+$/,b=/^-?0[0-7]+$/,S=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,T=/^[a-zA-Z_][a-zA-Z_0-9]*$/,w=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,C=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function E(e,t,n){t instanceof i||(n=t,t=new i),n||(n=E.defaults);var I,_,k,D,R,A=n.preferTrailingComment||!1,x=r(e,n.alternateCommentMode||!1),N=x.next,O=x.push,M=x.peek,P=x.skip,L=x.cmnt,B=!0,F=!1,j=t,U=n.keepCase?function(e){return e}:f.camelCase;function V(e,t,n){var r=E.filename;return n||(E.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(r?r+", ":"")+"line "+x.line+")")}function q(){var e,t=[];do{if('"'!==(e=N())&&"'"!==e)throw V(e);t.push(N()),P(e),e=M()}while('"'===e||"'"===e);return t.join("")}function z(e){var t=N();switch(t){case"'":case'"':return O(t),q();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return G(t,!0)}catch(n){if(e&&w.test(t))return t;throw V(t,"value")}}function $(e,t){var n,r;do t&&('"'===(n=M())||"'"===n)?e.push(q()):e.push([r=H(N()),P("to",!0)?H(N()):r]);while(P(",",!0));P(";")}function G(e,t){var n=1;switch("-"===e.charAt(0)&&(n=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*n;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(p.test(e))return n*parseInt(e,10);if(m.test(e))return n*parseInt(e,16);if(v.test(e))return n*parseInt(e,8);if(S.test(e))return n*parseFloat(e);throw V(e,"number",t)}function H(e,t){switch(e){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!t&&"-"===e.charAt(0))throw V(e,"id");if(g.test(e))return parseInt(e,10);if(y.test(e))return parseInt(e,16);if(b.test(e))return parseInt(e,8);throw V(e,"id")}function K(){if(void 0!==_)throw V("package");if(_=N(),!w.test(_))throw V(_,"name");j=j.define(_),P(";")}function W(){var e,t=M();switch(t){case"weak":e=D||(D=[]),N();break;case"public":N();default:e=k||(k=[])}t=q(),P(";"),e.push(t)}function Q(){if(P("="),!(F="proto3"===(R=q()))&&"proto2"!==R)throw V(R,"syntax");P(";")}function Y(e,t){switch(t){case"option":return es(e,t),P(";"),!0;case"message":return X(e,t),!0;case"enum":return er(e,t),!0;case"service":return ec(e,t),!0;case"extend":return ed(e,t),!0}return!1}function J(e,t,n){var r,i=x.line;if(e&&("string"!=typeof e.comment&&(e.comment=L()),e.filename=E.filename),P("{",!0)){for(;"}"!==(r=N());)t(r);P(";",!0)}else n&&n(),P(";"),e&&("string"!=typeof e.comment||A)&&(e.comment=L(i)||e.comment)}function X(e,t){if(!T.test(t=N()))throw V(t,"type name");var n=new s(t);J(n,function(e){if(!Y(n,e))switch(e){case"map":et(n,e);break;case"required":case"repeated":Z(n,e);break;case"optional":F?Z(n,"proto3_optional"):Z(n,"optional");break;case"oneof":en(n,e);break;case"extensions":$(n.extensions||(n.extensions=[]));break;case"reserved":$(n.reserved||(n.reserved=[]),!0);break;default:if(!F||!w.test(e))throw V(e);O(e),Z(n,"optional")}}),e.add(n)}function Z(e,t,n){var r=N();if("group"===r){ee(e,t);return}for(;r.endsWith(".")||M().startsWith(".");)r+=N();if(!w.test(r))throw V(r,"type");var i=N();if(!T.test(i))throw V(i,"name");i=U(i),P("=");var s=new a(i,H(N()),r,t,n);if(J(s,function(e){if("option"===e)es(s,e),P(";");else throw V(e)},function(){eu(s)}),"proto3_optional"===t){var o=new l("_"+i);s.setOption("proto3_optional",!0),o.add(s),e.add(o)}else e.add(s);!F&&s.repeated&&(void 0!==d.packed[r]||void 0===d.basic[r])&&s.setOption("packed",!1,!0)}function ee(e,t){var n=N();if(!T.test(n))throw V(n,"name");var r=f.lcFirst(n);n===r&&(n=f.ucFirst(n)),P("=");var i=H(N()),o=new s(n);o.group=!0;var l=new a(r,i,n,t);l.filename=E.filename,J(o,function(e){switch(e){case"option":es(o,e),P(";");break;case"required":case"repeated":Z(o,e);break;case"optional":F?Z(o,"proto3_optional"):Z(o,"optional");break;case"message":X(o,e);break;case"enum":er(o,e);break;default:throw V(e)}}),e.add(o).add(l)}function et(e){P("<");var t=N();if(void 0===d.mapKey[t])throw V(t,"type");P(",");var n=N();if(!w.test(n))throw V(n,"type");P(">");var r=N();if(!T.test(r))throw V(r,"name");P("=");var i=new o(U(r),H(N()),t,n);J(i,function(e){if("option"===e)es(i,e),P(";");else throw V(e)},function(){eu(i)}),e.add(i)}function en(e,t){if(!T.test(t=N()))throw V(t,"name");var n=new l(U(t));J(n,function(e){"option"===e?(es(n,e),P(";")):(O(e),Z(n,"optional"))}),e.add(n)}function er(e,t){if(!T.test(t=N()))throw V(t,"name");var n=new u(t);J(n,function(e){switch(e){case"option":es(n,e),P(";");break;case"reserved":$(n.reserved||(n.reserved=[]),!0);break;default:ei(n,e)}}),e.add(n)}function ei(e,t){if(!T.test(t))throw V(t,"name");P("=");var n=H(N(),!0),r={options:void 0};r.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},J(r,function(e){if("option"===e)es(r,e),P(";");else throw V(e)},function(){eu(r)}),e.add(t,n,r.comment,r.options)}function es(e,t){var n,r=P("(",!0);if(!w.test(t=N()))throw V(t,"name");var i=t,s=i;r&&(P(")"),s=i="("+i+")",t=M(),C.test(t)&&(n=t.slice(1),i+=t,N())),P("=");var a=ea(e,i);el(e,s,a,n)}function ea(e,t){if(P("{",!0)){for(var n={};!P("}",!0);){if(!T.test(I=N()))throw V(I,"name");if(null===I)throw V(I,"end of input");var r,i,s=I;if(P(":",!0),"{"===M())r=ea(e,t+"."+I);else if("["===M()){if(r=[],P("[",!0)){do i=z(!0),r.push(i);while(P(",",!0));P("]"),void 0!==i&&eo(e,t+"."+I,i)}}else r=z(!0),eo(e,t+"."+I,r);var a=n[s];a&&(r=[].concat(a).concat(r)),n[s]=r,P(",",!0),P(";",!0)}return n}var o=z(!0);return eo(e,t,o),o}function eo(e,t,n){e.setOption&&e.setOption(t,n)}function el(e,t,n,r){e.setParsedOption&&e.setParsedOption(t,n,r)}function eu(e){if(P("[",!0)){do es(e,"option");while(P(",",!0));P("]")}return e}function ec(e,t){if(!T.test(t=N()))throw V(t,"service name");var n=new c(t);J(n,function(e){if(!Y(n,e)){if("rpc"===e)eh(n,e);else throw V(e)}}),e.add(n)}function eh(e,t){var n=L(),r=t;if(!T.test(t=N()))throw V(t,"name");var i,s,a,o,l=t;if(P("("),P("stream",!0)&&(s=!0),!w.test(t=N())||(i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(o=!0),!w.test(t=N())))throw V(t);a=t,P(")");var u=new h(l,r,i,a,s,o);u.comment=n,J(u,function(e){if("option"===e)es(u,e),P(";");else throw V(e)}),e.add(u)}function ed(e,t){if(!w.test(t=N()))throw V(t,"reference");var n=t;J(null,function(t){switch(t){case"required":case"repeated":Z(e,t,n);break;case"optional":F?Z(e,"proto3_optional",n):Z(e,"optional",n);break;default:if(!F||!w.test(t))throw V(t);O(t),Z(e,"optional",n)}})}for(;null!==(I=N());)switch(I){case"package":if(!B)throw V(I);K();break;case"import":if(!B)throw V(I);W();break;case"syntax":if(!B)throw V(I);Q();break;case"option":es(j,I),P(";");break;default:if(Y(j,I)){B=!1;continue}throw V(I)}return E.filename=null,{package:_,imports:k,weakImports:D,syntax:R,root:t}}},1881:(e,t,n)=>{"use strict";e.exports=l;var r,i=n(60313),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},c=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new r(e):u(e)})(e)}:u};function h(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw o(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=c(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw o(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,n);if(t===n){var r=i.Buffer;return r?r.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,n)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){r=e,l.create=c(),r._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},29012:(e,t,n)=>{"use strict";e.exports=s;var r=n(1881);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(60313);function s(e){r.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},19504:(e,t,n)=>{"use strict";e.exports=h;var r,i,s,a=n(76946);((h.prototype=Object.create(a.prototype)).constructor=h).className="Root";var o=n(90233),l=n(20394),u=n(59687),c=n(53133);function h(e){a.call(this,"",e),this.deferred=[],this.files=[]}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},h.prototype.resolvePath=c.path.resolve,h.prototype.fetch=c.fetch,h.prototype.load=function e(t,n,r){"function"==typeof n&&(r=n,n=void 0);var a=this;if(!r)return c.asPromise(e,a,t,n);var o=r===d;function l(e,t){if(r){var n=r;if(r=null,o)throw e;n(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var n=e.substring(t);if(n in s)return n}return null}function h(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){i.filename=e;var r,s=i(t,a,n),h=0;if(s.imports)for(;h<s.imports.length;++h)(r=u(s.imports[h])||a.resolvePath(e,s.imports[h]))&&f(r);if(s.weakImports)for(h=0;h<s.weakImports.length;++h)(r=u(s.weakImports[h])||a.resolvePath(e,s.weakImports[h]))&&f(r,!0)}else a.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}o||p||l(null,a)}function f(e,t){if(e=u(e)||e,!(a.files.indexOf(e)>-1)){if(a.files.push(e),e in s){o?h(e,s[e]):(++p,setTimeout(function(){--p,h(e,s[e])}));return}if(o){var n;try{n=c.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}h(e,n)}else++p,a.fetch(e,function(n,i){if(--p,r){if(n){t?p||l(null,a):l(n);return}h(e,i)}})}}var p=0;c.isString(t)&&(t=[t]);for(var g,m=0;m<t.length;++m)(g=a.resolvePath("",t[m]))&&f(g);if(o)return a;p||l(null,a)},h.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return a.prototype.resolveAll.call(this)};var f=/^[A-Z]/;function p(e,t){var n=t.parent.lookup(t.extend);if(n){var r=new o(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!n.get(r.name)||(r.declaringField=t,t.extensionField=r,n.add(r),!0)}return!1}h.prototype._handleAdd=function(e){if(e instanceof o)void 0===e.extend||e.extensionField||p(this,e)||this.deferred.push(e);else if(e instanceof l)f.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof r)for(var t=0;t<this.deferred.length;)p(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var n=0;n<e.nestedArray.length;++n)this._handleAdd(e._nestedArray[n]);f.test(e.name)&&(e.parent[e.name]=e)}},h.prototype._handleRemove=function(e){if(e instanceof o){if(void 0!==e.extend){if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}}else if(e instanceof l)f.test(e.name)&&delete e.parent[e.name];else if(e instanceof a){for(var n=0;n<e.nestedArray.length;++n)this._handleRemove(e._nestedArray[n]);f.test(e.name)&&delete e.parent[e.name]}},h._configure=function(e,t,n){r=e,i=t,s=n}},94881:e=>{"use strict";e.exports={}},40996:(e,t,n)=>{"use strict";t.Service=n(65646)},65646:(e,t,n)=>{"use strict";e.exports=i;var r=n(60313);function i(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,n,i,s,a){if(!s)throw TypeError("request must be specified");var o=this;if(!a)return r.asPromise(e,o,t,n,i,s);if(!o.rpcImpl){setTimeout(function(){a(Error("already ended"))},0);return}try{return o.rpcImpl(t,n[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,n){if(e)return o.emit("error",e,t),a(e);if(null===n){o.end(!0);return}if(!(n instanceof i))try{n=i[o.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",n,t),a(null,n)})}catch(e){o.emit("error",e,t),setTimeout(function(){a(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},70739:(e,t,n)=>{"use strict";e.exports=o;var r=n(76946);((o.prototype=Object.create(r.prototype)).constructor=o).className="Service";var i=n(45410),s=n(53133),a=n(40996);function o(e,t){r.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}o.fromJSON=function(e,t){var n=new o(e,t.options);if(t.methods)for(var r=Object.keys(t.methods),s=0;s<r.length;++s)n.add(i.fromJSON(r[s],t.methods[r[s]]));return t.nested&&n.addJSON(t.nested),n.comment=t.comment,n},o.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&!!e.keepComments;return s.toObject(["options",t&&t.options||void 0,"methods",r.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),o.prototype.get=function(e){return this.methods[e]||r.prototype.get.call(this,e)},o.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return r.prototype.resolve.call(this)},o.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):r.prototype.add.call(this,e)},o.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return r.prototype.remove.call(this,e)},o.prototype.create=function(e,t,n){for(var r,i=new a.Service(e,t,n),o=0;o<this.methodsArray.length;++o){var l=s.lcFirst((r=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:r,q:r.resolvedRequestType.ctor,s:r.resolvedResponseType.ctor})}return i}},66303:e=>{"use strict";e.exports=h;var t=/[\s{}=;:[\],'"()<>]/g,n=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,r=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,i=/^ *[*/]+ */,s=/^\s*\*?\/*/,a=/\n/g,o=/\s/,l=/\\(.?)/g,u={0:"\0",r:"\r",n:"\n",t:"	"};function c(e){return e.replace(l,function(e,t){switch(t){case"\\":case"":return t;default:return u[t]||""}})}function h(e,l){e=e.toString();var u=0,h=e.length,d=1,f=0,p={},g=[],m=null;function y(e){return Error("illegal "+e+" (line "+d+")")}function v(){var t="'"===m?r:n;t.lastIndex=u-1;var i=t.exec(e);if(!i)throw y("string");return u=t.lastIndex,E(m),m=null,c(i[1])}function b(t){return e.charAt(t)}function S(t,n,r){var o,u,c={type:e.charAt(t++),lineEmpty:!1,leading:r},h=t-(o=l?2:3);do if(--h<0||"\n"===(u=e.charAt(h))){c.lineEmpty=!0;break}while(" "===u||"	"===u);for(var g=e.substring(t,n).split(a),m=0;m<g.length;++m)g[m]=g[m].replace(l?s:i,"").trim();c.text=g.join("\n").trim(),p[d]=c,f=d}function T(t){var n=w(t),r=e.substring(t,n);return/^\s*\/\//.test(r)}function w(e){for(var t=e;t<h&&"\n"!==b(t);)t++;return t}function C(){if(g.length>0)return g.shift();if(m)return v();var n,r,i,s,a,c=0===u;do{if(u===h)return null;for(n=!1;o.test(i=b(u));)if("\n"===i&&(c=!0,++d),++u===h)return null;if("/"===b(u)){if(++u===h)throw y("comment");if("/"===b(u)){if(l){if(s=u,a=!1,T(u-1)){a=!0;do if((u=w(u))===h||(u++,!c))break;while(T(u))}else u=Math.min(h,w(u)+1);a&&(S(s,u,c),c=!0),d++,n=!0}else{for(a="/"===b(s=u+1);"\n"!==b(++u);)if(u===h)return null;++u,a&&(S(s,u-1,c),c=!0),++d,n=!0}}else{if("*"!==(i=b(u)))return"/";s=u+1,a=l||"*"===b(s);do{if("\n"===i&&++d,++u===h)throw y("comment");r=i,i=b(u)}while("*"!==r||"/"!==i);++u,a&&(S(s,u-2,c),c=!0),n=!0}}}while(n);var f=u;if(t.lastIndex=0,!t.test(b(f++)))for(;f<h&&!t.test(b(f));)++f;var p=e.substring(u,u=f);return('"'===p||"'"===p)&&(m=p),p}function E(e){g.push(e)}function I(){if(!g.length){var e=C();if(null===e)return null;E(e)}return g[0]}function _(e,t){var n=I();if(n===e)return C(),!0;if(!t)throw y("token '"+n+"', '"+e+"' expected");return!1}function k(e){var t,n=null;return void 0===e?(t=p[d-1],delete p[d-1],t&&(l||"*"===t.type||t.lineEmpty)&&(n=t.leading?t.text:null)):(f<e&&I(),t=p[e],delete p[e],t&&!t.lineEmpty&&(l||"/"===t.type)&&(n=t.leading?null:t.text)),n}return Object.defineProperty({next:C,peek:I,push:E,skip:_,cmnt:k},"line",{get:function(){return d}})}h.unescape=c},66024:(e,t,n)=>{"use strict";e.exports=v;var r=n(76946);((v.prototype=Object.create(r.prototype)).constructor=v).className="Type";var i=n(20394),s=n(59687),a=n(90233),o=n(47271),l=n(70739),u=n(46469),c=n(1881),h=n(76555),d=n(53133),f=n(84812),p=n(5606),g=n(73922),m=n(42741),y=n(60329);function v(e,t){r.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var n=this.fields[e[t]],r=n.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=n}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,u,!0),this._ctor=e;for(var n=0;n<this.fieldsArray.length;++n)this._fieldsArray[n].resolve();var r={};for(n=0;n<this.oneofsArray.length;++n)r[this._oneofsArray[n].resolve().name]={get:d.oneOfGetter(this._oneofsArray[n].oneof),set:d.oneOfSetter(this._oneofsArray[n].oneof)};n&&Object.defineProperties(e.prototype,r)}}}),v.generateConstructor=function(e){for(var t,n=d.codegen(["p"],e.name),r=0;r<e.fieldsArray.length;++r)(t=e._fieldsArray[r]).map?n("this%s={}",d.safeProp(t.name)):t.repeated&&n("this%s=[]",d.safeProp(t.name));return n("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var n=new v(e,t.options);n.extensions=t.extensions,n.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)n.add((void 0!==t.fields[u[c]].keyType?o.fromJSON:a.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)n.add(s.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){var h=t.nested[u[c]];n.add((void 0!==h.id?a.fromJSON:void 0!==h.fields?v.fromJSON:void 0!==h.values?i.fromJSON:void 0!==h.methods?l.fromJSON:r.fromJSON)(u[c],h))}return t.extensions&&t.extensions.length&&(n.extensions=t.extensions),t.reserved&&t.reserved.length&&(n.reserved=t.reserved),t.group&&(n.group=!0),t.comment&&(n.comment=t.comment),n},v.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&!!e.keepComments;return d.toObject(["options",t&&t.options||void 0,"oneofs",r.arrayToJSON(this.oneofsArray,e),"fields",r.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},v.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var n=this.oneofsArray;for(t=0;t<n.length;)n[t++].resolve();return r.prototype.resolveAll.call(this)},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):r.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return r.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return r.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return r.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],n=0;n<this.fieldsArray.length;++n)t.push(this._fieldsArray[n].resolve().resolvedType);this.encode=f(this)({Writer:h,types:t,util:d}),this.decode=p(this)({Reader:c,types:t,util:d}),this.verify=g(this)({types:t,util:d}),this.fromObject=m.fromObject(this)({types:t,util:d}),this.toObject=m.toObject(this)({types:t,util:d});var r=y[e];if(r){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(i),i.toObject=this.toObject,this.toObject=r.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){d.decorateType(t,e)}}},6530:(e,t,n)=>{"use strict";var r=t,i=n(53133),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var n=0,r={};for(t|=0;n<e.length;)r[s[n+t]]=e[n++];return r}r.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),r.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),r.long=a([0,0,0,1,1],7),r.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),r.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},53133:(e,t,n)=>{"use strict";var r,i,s=e.exports=n(60313),a=n(94881);s.codegen=n(97117),s.fetch=n(92066),s.path=n(65111),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),n=Array(t.length),r=0;r<t.length;)n[r]=e[t[r++]];return n}return[]},s.toObject=function(e){for(var t={},n=0;n<e.length;){var r=e[n++],i=e[n++];void 0!==i&&(t[r]=i)}return t};var o=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(o,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(s.decorateRoot.remove(e.$type),e.$type.name=t,s.decorateRoot.add(e.$type)),e.$type;r||(r=n(66024));var i=new r(t||e.name);return s.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var c=0;s.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=n(20394));var t=new i("Enum"+c++,e);return s.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},s.setProperty=function(e,t,n){function r(e,t,n){var i=t.shift();if("__proto__"===i||"prototype"===i)return e;if(t.length>0)e[i]=r(e[i]||{},t,n);else{var s=e[i];s&&(n=[].concat(s).concat(n)),e[i]=n}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return r(e,t=t.split("."),n)},Object.defineProperty(s,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(n(19504)))}})},14597:(e,t,n)=>{"use strict";e.exports=i;var r=n(60313);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new i(n,r)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(r.isString(e)){if(!r.Long)return i.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},60313:function(e,t,n){"use strict";var r=t;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function s(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),n&&i(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}r.asPromise=n(35623),r.base64=n(53779),r.EventEmitter=n(78068),r.float=n(41894),r.inquire=n(21018),r.utf8=n(5481),r.pool=n(53173),r.LongBits=n(14597),r.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),r.global=r.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!!(null!=n&&e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(!!t)},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=s,r.ProtocolError=s("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;if(!e){r._Buffer_from=r._Buffer_allocUnsafe=null;return}r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},73922:(e,t,n)=>{"use strict";e.exports=l;var r=n(20394),i=n(53133);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,n,i){if(t.resolvedType){if(t.resolvedType instanceof r){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),o=0;o<a.length;++o)e("case %i:",t.resolvedType.values[a[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",n,i)("if(e)")("return%j+e",t.name+".")("}")}else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function o(e,t,n){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",n)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",n)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",n)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),n=e.oneofsArray,r={};n.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var u=e._fieldsArray[l].resolve(),c="m"+i.safeProp(u.name);if(u.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,u.name),u.map)t("if(!util.isObject(%s))",c)("return%j",s(u,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),o(t,u,"k[i]"),a(t,u,l,c+"[k[i]]")("}");else if(u.repeated)t("if(!Array.isArray(%s))",c)("return%j",s(u,"array"))("for(var i=0;i<%s.length;++i){",c),a(t,u,l,c+"[i]")("}");else{if(u.partOf){var h=i.safeProp(u.partOf.name);1===r[u.partOf.name]&&t("if(p%s===1)",h)("return%j",u.partOf.name+": multiple values"),r[u.partOf.name]=1,t("p%s=1",h)}a(t,u,l,c)}u.optional&&t("}")}return t("return null")}},60329:(e,t,n)=>{"use strict";var r=t,i=n(46469);r[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),n=this.lookup(t);if(n){var r="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===r.indexOf("/")&&(r="/"+r),this.create({type_url:r,value:n.encode(n.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var n="type.googleapis.com/",r="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),r=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var a=this.lookup(s);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var o=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===r&&(r=n),s=r+l,o["@type"]=s,o}return this.toObject(e,t)}}},76555:(e,t,n)=>{"use strict";e.exports=h;var r,i=n(60313),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function f(e,t,n){t[n]=255&e}function p(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e}function g(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function y(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new l(e,t,n),this.len+=t,this},g.prototype=Object.create(l.prototype),g.prototype.fn=p,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new g((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(m,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(m,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(m,t.length(),t)},h.prototype.bool=function(e){return this._push(f,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(i.isString(e)){var n=h.alloc(t=a.length(e));a.decode(e,n,0),e=n}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(f,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=d(),r._configure()}},37081:(e,t,n)=>{"use strict";e.exports=s;var r=n(76555);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(60313);function s(){r.call(this)}function a(e,t,n){e.length<40?i.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},29143:(e,t)=>{var n,r=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;/**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   */var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var s={},a={};function o(e,t){var n,r,i;return t?(e>>>=0,(i=0<=e&&e<256)&&(r=a[e]))?r:(n=u(e,0,!0),i&&(a[e]=n),n):(e|=0,(i=-128<=e&&e<128)&&(r=s[e]))?r:(n=u(e,e<0?-1:0,!1),i&&(s[e]=n),n)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=p)return C}else{if(e<=-g)return E;if(e+1>=g)return w}return e<0?l(-e,t).neg():u(e%f|0,e/f|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=l,n.fromBits=u;var c=Math.pow;function h(e,t,n){if(0===e.length)throw Error("empty string");if("number"==typeof t?(n=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((n=n||10)<2||36<n)throw RangeError("radix");if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return h(e.substring(1),t,n).neg();for(var r,i=l(c(n,8)),s=y,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),u=parseInt(e.substring(a,a+o),n);if(o<8){var d=l(c(n,o));s=s.mul(d).add(l(u))}else s=(s=s.mul(i)).add(l(u))}return s.unsigned=t,s}function d(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?h(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=h,n.fromValue=d;var f=4294967296,p=18446744073709552e3,g=0x7fffffffffffffff,m=o(16777216),y=o(0);n.ZERO=y;var v=o(0,!0);n.UZERO=v;var b=o(1);n.ONE=b;var S=o(1,!0);n.UONE=S;var T=o(-1);n.NEG_ONE=T;var w=u(-1,2147483647,!1);n.MAX_VALUE=w;var C=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=C;var E=u(0,-2147483648,!1);n.MIN_VALUE=E;var I=n.prototype;I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},I.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(E))return"-"+this.neg().toString(e);var t=l(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}for(var i=l(c(e,6),this.unsigned),s=this,a="";;){var o=s.div(i),u=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},I.isZero=function(){return 0===this.high&&0===this.low},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return(1&this.low)==1},I.isEven=function(){return(1&this.low)==0},I.equals=function(e){return r(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(e){return 0>this.comp(e)},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return 0>=this.comp(e)},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(e){if(r(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(b)},I.neg=I.negate,I.add=function(e){r(e)||(e=d(e));var t,n,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,l=e.high>>>16,c=65535&e.high,h=e.low>>>16,f=65535&e.low,p=0,g=0;return t=0+((n=0+(o+f))>>>16),n&=65535,t+=a+h,g+=t>>>16,t&=65535,g+=s+c,p+=g>>>16,g&=65535,p+=i+l,u(t<<16|n,(p&=65535)<<16|g,this.unsigned)},I.subtract=function(e){return r(e)||(e=d(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){if(this.isZero())return this;if(r(e)||(e=d(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(E))return e.isOdd()?E:y;if(e.eq(E))return this.isOdd()?E:y;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return l(this.toNumber()*e.toNumber(),this.unsigned);var n,i,s=this.high>>>16,a=65535&this.high,o=this.low>>>16,c=65535&this.low,h=e.high>>>16,f=65535&e.high,p=e.low>>>16,g=65535&e.low,b=0,S=0;return n=0+((i=0+c*g)>>>16),i&=65535,n+=o*g,S+=n>>>16,n&=65535,n+=c*p,S+=n>>>16,n&=65535,S+=a*g,b+=S>>>16,S&=65535,S+=o*p,b+=S>>>16,S&=65535,S+=c*f,b+=S>>>16,S&=65535,b+=s*g+a*p+o*f+c*h,u(n<<16|i,(b&=65535)<<16|S,this.unsigned)},I.mul=I.multiply,I.divide=function(e){if(r(e)||(e=d(e)),e.isZero())throw Error("division by zero");if(t){var n,i,s;return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return S;s=v}else{if(this.eq(E))return e.eq(b)||e.eq(T)?E:e.eq(E)?b:(n=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?b:T:(i=this.sub(e.mul(n)),s=n.add(i.div(e)));if(e.eq(E))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(n=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),o=a<=48?1:c(2,a-48),h=l(n),f=h.mul(e);f.isNegative()||f.gt(i);)n-=o,f=(h=l(n,this.unsigned)).mul(e);h.isZero()&&(h=b),s=s.add(h),i=i.sub(f)}return s},I.div=I.divide,I.modulo=function(e){return(r(e)||(e=d(e)),t)?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return u(~this.low,~this.high,this.unsigned)},I.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},I.clz=I.countLeadingZeros,I.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},I.ctz=I.countTrailingZeros,I.and=function(e){return r(e)||(e=d(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return r(e)||(e=d(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return r(e)||(e=d(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?u(this.high,0,this.unsigned):u(this.high>>>e-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.rotateLeft=function(e){var t;return(r(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,u(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},I.rotl=I.rotateLeft,I.rotateRight=function(e){var t;return(r(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,u(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},I.rotr=I.rotateRight,I.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},I.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var _=n;return e.default=_,"default"in e?e.default:e}({});void 0!==(n=(function(){return r}).apply(t,[]))&&(e.exports=n)},9932:e=>{"use strict";e.exports={i8:"1.9.9"}},38710:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},48311:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"FileDescriptorSet":{"fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}}},"FileDescriptorProto":{"fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10,"options":{"packed":false}},"weakDependency":{"rule":"repeated","type":"int32","id":11,"options":{"packed":false}},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12}}},"DescriptorProto":{"fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"FieldDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REQUIRED":2,"LABEL_REPEATED":3}}}},"OneofDescriptorProto":{"fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3}}},"EnumValueDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[38,38]],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[8,8]]},"FieldOptions":{"fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}}}},"OneofOptions":{"fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumValueOptions":{"fields":{"deprecated":{"type":"bool","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"UninterpretedOption":{"fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"SourceCodeInfo":{"fields":{"location":{"rule":"repeated","type":"Location","id":1}},"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"span":{"rule":"repeated","type":"int32","id":2},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4}}}}}}}}}}}')},57535:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},93255:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')}};var __webpack_require__=require("../../../../webpack-runtime.js");__webpack_require__.C(exports);var __webpack_exec__=e=>__webpack_require__(__webpack_require__.s=e),__webpack_exports__=__webpack_require__.X(0,[558,358,468],()=>__webpack_exec__(33526));module.exports=__webpack_exports__})();